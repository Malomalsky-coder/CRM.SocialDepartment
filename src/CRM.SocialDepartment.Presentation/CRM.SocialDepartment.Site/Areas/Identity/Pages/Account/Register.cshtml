@page
@model RegisterModel

@{
    ViewData["Title"] = "Регистрация";
    Layout = "_LayoutWithoutContainer";
}

<div class="auth-card">
    <div class="text-center mb-4">
        <i class="fa fa-user-plus fa-3x text-primary mb-3"></i>
        <h1 class="h3 mb-2">Создать аккаунт</h1>
        <p class="text-muted">Зарегистрируйтесь в системе управления</p>
    </div>

    <form id="registerForm" asp-route-returnUrl="@Model.ReturnUrl" method="post">
        <div asp-validation-summary="ModelOnly" class="text-danger mb-3" role="alert"></div>

        <div class="mb-3">
            <div class="input-group">
                <span class="input-group-text">
                    <i class="fa fa-user text-primary"></i>
                </span>
                <input asp-for="Input.LastName" class="form-control" autocomplete="family-name" aria-required="true" placeholder="Фамилия" />
            </div>
            <span asp-validation-for="Input.LastName" class="invalid-feedback d-block"></span>
        </div>

        <div class="mb-3">
            <div class="input-group">
                <span class="input-group-text">
                    <i class="fa fa-user text-primary"></i>
                </span>
                <input asp-for="Input.FirstName" class="form-control" autocomplete="given-name" aria-required="true" placeholder="Имя" />
            </div>
            <span asp-validation-for="Input.FirstName" class="invalid-feedback d-block"></span>
        </div>
        
        <div class="mb-3">
            <div class="input-group">
                <span class="input-group-text">
                    <i class="fa fa-envelope text-primary"></i>
                </span>
                <input asp-for="Input.Email" class="form-control" autocomplete="username" aria-required="true" placeholder="Электронная почта" />
            </div>
            <span asp-validation-for="Input.Email" class="invalid-feedback d-block"></span>
        </div>
        
        <div class="mb-3">
            <div class="input-group">
                <span class="input-group-text">
                    <i class="fa fa-lock text-primary"></i>
                </span>
                <input asp-for="Input.Password" class="form-control" autocomplete="new-password" aria-required="true" placeholder="Пароль" />
            </div>
            <span asp-validation-for="Input.Password" class="invalid-feedback d-block"></span>
            <small class="text-muted">Минимум 6 символов</small>
        </div>
        
        <div class="mb-3">
            <div class="input-group">
                <span class="input-group-text">
                    <i class="fa fa-check text-primary"></i>
                </span>
                <input asp-for="Input.ConfirmPassword" class="form-control" autocomplete="new-password" aria-required="true" placeholder="Подтверждение пароля" />
            </div>
            <span asp-validation-for="Input.ConfirmPassword" class="invalid-feedback d-block"></span>
        </div>
        
        <div class="d-grid mb-3">
            <button id="registerSubmit" type="submit" class="btn btn-primary btn-lg">
                <i class="fa fa-user-plus me-2"></i>Создать аккаунт
            </button>
        </div>
        
        <div class="text-center">
            <span class="text-muted">Уже есть аккаунт?</span>
            <a asp-page="./Login" asp-route-returnUrl="@Model.ReturnUrl">
                <i class="fa fa-sign-in me-1"></i>Войти
            </a>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Добавляем плавную анимацию появления
        document.addEventListener('DOMContentLoaded', function() {
            const authCard = document.querySelector('.auth-card');
            authCard.style.opacity = '0';
            authCard.style.transform = 'translateY(30px)';
            
            setTimeout(() => {
                authCard.style.transition = 'all 0.6s ease-out';
                authCard.style.opacity = '1';
                authCard.style.transform = 'translateY(0)';
            }, 100);
        });

        // Фокус на поле имени при загрузке
        document.querySelector('input[name="Input.FirstName"]').focus();
        
        // Валидация паролей в реальном времени
        const passwordInput = document.querySelector('input[name="Input.Password"]');
        const confirmPasswordInput = document.querySelector('input[name="Input.ConfirmPassword"]');
        
        function validatePasswords() {
            if (confirmPasswordInput.value && passwordInput.value !== confirmPasswordInput.value) {
                confirmPasswordInput.setCustomValidity('Пароли не совпадают');
                confirmPasswordInput.classList.add('is-invalid');
            } else {
                confirmPasswordInput.setCustomValidity('');
                confirmPasswordInput.classList.remove('is-invalid');
                if (confirmPasswordInput.value && passwordInput.value === confirmPasswordInput.value) {
                    confirmPasswordInput.classList.add('is-valid');
                }
            }
        }
        
        passwordInput.addEventListener('input', validatePasswords);
        confirmPasswordInput.addEventListener('input', validatePasswords);
        
        // Анимация кнопки при отправке
        document.getElementById('registerSubmit').addEventListener('click', function() {
            const btn = this;
            const icon = btn.querySelector('i');
            
            // Показываем спиннер
            icon.classList.remove('fa-user-plus');
            icon.classList.add('fa-spinner', 'fa-spin');
            btn.disabled = true;
            
            // Возвращаем обратно через 3 секунды (если форма не отправилась)
            setTimeout(() => {
                icon.classList.remove('fa-spinner', 'fa-spin');
                icon.classList.add('fa-user-plus');
                btn.disabled = false;
            }, 3000);
        });
    </script>
}
