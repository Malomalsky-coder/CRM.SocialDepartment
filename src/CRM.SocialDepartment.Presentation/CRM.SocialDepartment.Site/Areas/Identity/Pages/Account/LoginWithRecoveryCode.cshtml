@page
@model LoginWithRecoveryCodeModel
@{
    ViewData["Title"] = "Вход с кодом восстановления";
    Layout = "_LayoutWithoutContainer";
}

<div class="auth-card">
    <div class="text-center mb-4">
        <i class="fa fa-life-ring fa-3x text-warning mb-3"></i>
        <h1 class="h3 mb-2">Код восстановления</h1>
        <p class="text-muted">Введите код восстановления для завершения входа</p>
    </div>

    <form method="post" asp-route-returnUrl="@Model.ReturnUrl">
        <div asp-validation-summary="ModelOnly" class="text-danger mb-3" role="alert"></div>
        
        <div class="mb-3">
            <label class="form-label text-center w-100 mb-2">
                <i class="fa fa-key me-2"></i>Код восстановления
            </label>
            <div class="input-group">
                <span class="input-group-text">
                    <i class="fa fa-unlock-alt text-primary"></i>
                </span>
                <input asp-for="Input.RecoveryCode" class="form-control text-center" 
                       autocomplete="off" placeholder="XXXX-XXXX-XXXX" 
                       style="font-family: monospace; font-size: 1.1rem; letter-spacing: 0.1em;" />
            </div>
            <span asp-validation-for="Input.RecoveryCode" class="invalid-feedback d-block"></span>
            <small class="text-muted text-center d-block mt-2">
                <i class="fa fa-info-circle me-1"></i>
                Введите один из ваших кодов восстановления
            </small>
        </div>
        
        <div class="d-grid mb-3">
            <button id="recoverySubmit" type="submit" class="btn btn-primary btn-lg">
                <i class="fa fa-sign-in me-2"></i>Войти в систему
            </button>
        </div>
        
        <div class="text-center">
            <p class="text-muted mb-2">Есть доступ к аутентификатору?</p>
            <a asp-page="./LoginWith2fa" asp-route-returnUrl="@Model.ReturnUrl" class="text-decoration-none">
                <i class="fa fa-mobile me-1"></i>Использовать код аутентификатора
            </a>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Добавляем плавную анимацию появления
        document.addEventListener('DOMContentLoaded', function() {
            const authCard = document.querySelector('.auth-card');
            authCard.style.opacity = '0';
            authCard.style.transform = 'translateY(30px)';
            
            setTimeout(() => {
                authCard.style.transition = 'all 0.6s ease-out';
                authCard.style.opacity = '1';
                authCard.style.transform = 'translateY(0)';
            }, 100);
        });

        const recoveryInput = document.querySelector('input[name="Input.RecoveryCode"]');
        if (recoveryInput) {
            recoveryInput.focus();
            
            // Форматирование ввода кода восстановления
            recoveryInput.addEventListener('input', function(e) {
                // Убираем все, кроме букв, цифр и дефисов
                this.value = this.value.toUpperCase().replace(/[^A-Z0-9-]/g, '');
            });

            // Обработка вставки из буфера обмена
            recoveryInput.addEventListener('paste', function(e) {
                setTimeout(() => {
                    this.value = this.value.toUpperCase().replace(/[^A-Z0-9-]/g, '');
                }, 10);
            });
        }
        
        // Анимация кнопки при отправке
        document.getElementById('recoverySubmit').addEventListener('click', function() {
            const btn = this;
            const icon = btn.querySelector('i');
            
            // Показываем спиннер
            icon.classList.remove('fa-sign-in');
            icon.classList.add('fa-spinner', 'fa-spin');
            btn.disabled = true;
            
            // Возвращаем обратно через 3 секунды (если форма не отправилась)
            setTimeout(() => {
                icon.classList.remove('fa-spinner', 'fa-spin');
                icon.classList.add('fa-sign-in');
                btn.disabled = false;
            }, 3000);
        });
    </script>
}