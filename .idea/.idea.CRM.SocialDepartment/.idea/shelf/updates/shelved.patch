Index: src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/ViewModels/Assignment/CreateAssignmentViewModel.cs
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/ViewModels/Assignment/CreateAssignmentViewModel.cs b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/ViewModels/Assignment/CreateAssignmentViewModel.cs
new file mode 100644
--- /dev/null	(date 1756839163703)
+++ b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/ViewModels/Assignment/CreateAssignmentViewModel.cs	(date 1756839163703)
@@ -0,0 +1,42 @@
+using System.ComponentModel;
+using System.ComponentModel.DataAnnotations;
+
+namespace CRM.SocialDepartment.Site.ViewModels.Assignment;
+
+public class CreateAssignmentViewModel : IValidatableObject
+{
+    [Required(ErrorMessage = "–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è")]
+    [DisplayName("–ù–∞–∑–≤–∞–Ω–∏–µ")]
+    public string Name { get; init; } = string.Empty;
+
+    [Required(ErrorMessage = "–î–∞—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è")]
+    [DisplayName("–î–∞—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∏—è –∑–∞–¥–∞–Ω–∏—è")]
+    [DisplayFormat(DataFormatString = "{0:dd.MM.yyyy}", ApplyFormatInEditMode = true)]
+    public DateTime AcceptDate { get; init; }
+
+    [Required(ErrorMessage = "–û–ø–∏—Å–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è")]
+    [DisplayName("–û–ø–∏—Å–∞–Ω–∏–µ")]
+    public string Description { get; init; } = string.Empty;
+
+    [Required(ErrorMessage = "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è")]
+    [DisplayName("–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å")]
+    public string Assignee { get; set; } = string.Empty;
+
+    [Required(ErrorMessage = "–ü–∞—Ü–∏–µ–Ω—Ç –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è")]
+    [DisplayName("–ü–∞—Ü–∏–µ–Ω—Ç")]
+    public Domain.Entities.Patients.Patient Patient { get; set; }
+
+    public IEnumerable<ValidationResult> Validate(ValidationContext validationContext)
+    {
+        var resultList = new List<ValidationResult>();
+
+        if (string.IsNullOrEmpty(Name))
+            resultList.Add(new("–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º", [nameof(Name)]));
+        if (string.IsNullOrEmpty(Description))
+            resultList.Add(new("–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º", [nameof(Description)]));
+        if (string.IsNullOrEmpty(Assignee))
+            resultList.Add(new("–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å", [nameof(Assignee)]));
+
+        return resultList;
+    }
+}
\ No newline at end of file
Index: src/CRM.SocialDepartment.Core/CRM.SocialDepartment.Application/Assignments/AssignmentService.cs
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>using System.Globalization;\r\nusing System.Linq.Expressions;\r\nusing CRM.SocialDepartment.Application.Common;\r\nusing CRM.SocialDepartment.Application.DTOs;\r\nusing CRM.SocialDepartment.Application.Patients;\r\nusing CRM.SocialDepartment.Domain.Common;\r\nusing CRM.SocialDepartment.Domain.Entities;\r\nusing CRM.SocialDepartment.Domain.Exceptions;\r\nusing CRM.SocialDepartment.Domain.Repositories;\r\nusing DDD.Events;\r\nusing Microsoft.Extensions.DependencyInjection;\r\n\r\nnamespace CRM.SocialDepartment.Application.Assignments;\r\n\r\npublic class AssignmentService(IUnitOfWork unitOfWork, IDomainEventDispatcher? domainEventDispatcher = null)\r\n{\r\n    private readonly IUnitOfWork _unitOfWork = unitOfWork;\r\n    private readonly IDomainEventDispatcher? _domainEventDispatcher = domainEventDispatcher;\r\n\r\n    public async Task<Assignment?> GetAssignmentByIdAsync(Guid assignmentId,\r\n        CancellationToken cancellationToken = default)\r\n    {\r\n        return await _unitOfWork.Assignments.GetAsync(e => e.Id == assignmentId, cancellationToken);\r\n    }\r\n\r\n    public async Task<IEnumerable<Assignment>> GetAllAssignmentsAsync(Expression<Func<Assignment, bool>>? predicate,\r\n        CancellationToken cancellationToken = default)\r\n    {\r\n        return await _unitOfWork.Assignments.GetAllAsync(predicate, cancellationToken);\r\n    }\r\n\r\n    /// <summary>\r\n    /// –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)\r\n    /// </summary>\r\n    public async Task<Guid> CreateAssignmentAsync(CreateOrEditAssignmentDto dto,\r\n        CancellationToken cancellationToken = default)\r\n    {\r\n        var patient = await _unitOfWork.Patients.GetAsync(p => p.Id == dto.PatientId, cancellationToken) ??\r\n                      throw new EntityNotFoundException(\"–ü–∞—Ü–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω\");\r\n\r\n        var assignment = new Assignment(\r\n            dto.AcceptDate,\r\n            dto.DepartmentNumber,\r\n            dto.Description,\r\n            dto.ForwardDate,\r\n            dto.ForwardDepartment,\r\n            new()\r\n            {\r\n                { DateTime.Now.ToString(CultureInfo.InvariantCulture), \"–°–æ–∑–¥–∞–Ω–æ\" }\r\n            },\r\n            dto.DepartmentForwardDate,\r\n            dto.Assignee,\r\n            dto.Note,\r\n            DateTime.Now,\r\n            patient\r\n        );\r\n\r\n        await _unitOfWork.Assignments.InsertAsync(assignment, cancellationToken);\r\n\r\n        // –ü—É–±–ª–∏–∫—É–µ–º –¥–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è\r\n        await DomainEventPublisher.PublishAndClearEventsAsync(assignment, _domainEventDispatcher, cancellationToken);\r\n\r\n        return assignment.Id;\r\n    }\r\n\r\n    /// <summary>\r\n    /// –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π (–ø—Ä–∏–º–µ—Ä)\r\n    /// </summary>\r\n    public async Task<Guid> CreateAssignmentWithTransactionAsync(CreateOrEditAssignmentDto dto,\r\n        CancellationToken cancellationToken = default)\r\n    {\r\n        try\r\n        {\r\n            // –ù–∞—á–∏–Ω–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é\r\n            await _unitOfWork.BeginTransactionAsync(cancellationToken);\r\n\r\n            var patient = await _unitOfWork.Patients.GetAsync(p => p.Id == dto.PatientId, cancellationToken) ??\r\n                          throw new EntityNotFoundException(\"–ü–∞—Ü–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω\");\r\n\r\n            var assignment = new Assignment(\r\n                dto.AcceptDate,\r\n                dto.DepartmentNumber,\r\n                dto.Description,\r\n                dto.ForwardDate,\r\n                dto.ForwardDepartment,\r\n                new()\r\n                {\r\n                    { DateTime.Now.ToString(CultureInfo.InvariantCulture), \"–°–æ–∑–¥–∞–Ω–æ\" }\r\n                },\r\n                dto.DepartmentForwardDate,\r\n                dto.Assignee,\r\n                dto.Note,\r\n                DateTime.Now,\r\n                patient\r\n            );\r\n\r\n            // –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏\r\n            await _unitOfWork.Assignments.InsertAsync(assignment, cancellationToken);\r\n\r\n            // –ü—É–±–ª–∏–∫—É–µ–º –¥–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è\r\n            await DomainEventPublisher.PublishAndClearEventsAsync(assignment, _domainEventDispatcher, cancellationToken);\r\n\r\n            // –ú–æ–∂–µ–º —Ç–∞–∫–∂–µ –æ–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–∞ –≤ —Ä–∞–º–∫–∞—Ö —Ç–æ–π –∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏\r\n            // patient.SomeProperty = \"Updated\";\r\n            // await _unitOfWork.Patients.UpdateAsync(patient, cancellationToken);\r\n\r\n            // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é\r\n            await _unitOfWork.CommitTransactionAsync(cancellationToken);\r\n\r\n            return assignment.Id;\r\n        }\r\n        catch\r\n        {\r\n            // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é\r\n            if (_unitOfWork.HasActiveTransaction)\r\n            {\r\n                await _unitOfWork.RollbackTransactionAsync(cancellationToken);\r\n            }\r\n            throw;\r\n        }\r\n    }\r\n\r\n    public async Task EditAssignmentAsync(Guid id, CreateOrEditAssignmentDto dto,\r\n        CancellationToken cancellationToken = default)\r\n    {\r\n        var assignment = await GetAssignmentByIdAsync(id, cancellationToken) ?? throw new EntityNotFoundException();\r\n\r\n        assignment.StatusLog.Add(DateTime.Now.ToString(CultureInfo.InvariantCulture), \"–û–±–Ω–æ–≤–ª–µ–Ω–æ\");\r\n\r\n        if (!dto.Description.Equals(assignment.Description)) assignment.UpdateDescription(dto.Description);\r\n        if (dto.AcceptDate != assignment.AcceptDate) assignment.UpdateAcceptDate(dto.AcceptDate);\r\n        if (!dto.Assignee.Equals(assignment.Assignee)) assignment.UpdateAssignee(dto.Assignee);\r\n        if (dto.ForwardDate != assignment.ForwardDate) assignment.UpdateForwardDate(dto.ForwardDate);\r\n        if (dto.ForwardDepartment.Equals(assignment.ForwardDepartment))\r\n            assignment.UpdateForwardDepartment(dto.ForwardDepartment);\r\n        if (dto.DepartmentNumber != assignment.DepartmentNumber)\r\n            assignment.UpdateDepartmentNumber(dto.DepartmentNumber);\r\n        if (dto.DepartmentForwardDate != assignment.DepartmentForwardDate)\r\n            assignment.UpdateDepartmentForwardDate(dto.DepartmentForwardDate);\r\n        if (dto.Note != assignment.Note) assignment.UpdateNote(dto.Note ?? string.Empty);\r\n\r\n        await _unitOfWork.Assignments.UpdateAsync(assignment, cancellationToken);\r\n\r\n        // –ü—É–±–ª–∏–∫—É–µ–º –¥–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è\r\n        await DomainEventPublisher.PublishAndClearEventsAsync(assignment, _domainEventDispatcher, cancellationToken);\r\n    }\r\n\r\n    public async Task DeleteAssignmentAsync(Guid id, CancellationToken cancellationToken = default)\r\n    {\r\n        var assignment = await GetAssignmentByIdAsync(id, cancellationToken) ?? throw new EntityNotFoundException();\r\n        // –í—ã–∑—ã–≤–∞–µ–º –¥–æ–º–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –º—è–≥–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è\r\n        assignment.SoftDelete();\r\n        \r\n        await _unitOfWork.Assignments.UpdateAsync(assignment, cancellationToken);\r\n\r\n        // –ü—É–±–ª–∏–∫—É–µ–º –¥–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è\r\n        await DomainEventPublisher.PublishAndClearEventsAsync(assignment, _domainEventDispatcher, cancellationToken);\r\n    }\r\n\r\n    /// <summary>\r\n    /// –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è DataTables —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏\r\n    /// </summary>\r\n    public async Task<DataTableResult<Assignment>> GetActiveAssignmentsForDataTableAsync(DataTableParameters parameters, CancellationToken cancellationToken = default)\r\n    {\r\n        return await _unitOfWork.Assignments.GetActiveAssignmentsForDataTableAsync(parameters, cancellationToken);\r\n    }\r\n\r\n    /// <summary>\r\n    /// –ü–æ–ª—É—á–∏—Ç—å –∞—Ä—Ö–∏–≤–Ω—ã–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è DataTables —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏\r\n    /// </summary>\r\n    public async Task<DataTableResult<Assignment>> GetArchivedAssignmentsForDataTableAsync(DataTableParameters parameters, CancellationToken cancellationToken = default)\r\n    {\r\n        return await _unitOfWork.Assignments.GetArchivedAssignmentsForDataTableAsync(parameters, cancellationToken);\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/CRM.SocialDepartment.Core/CRM.SocialDepartment.Application/Assignments/AssignmentService.cs b/src/CRM.SocialDepartment.Core/CRM.SocialDepartment.Application/Assignments/AssignmentService.cs
--- a/src/CRM.SocialDepartment.Core/CRM.SocialDepartment.Application/Assignments/AssignmentService.cs	(revision d026a00c98f869bf4ad419ed96c9d8f1e1cd9520)
+++ b/src/CRM.SocialDepartment.Core/CRM.SocialDepartment.Application/Assignments/AssignmentService.cs	(date 1756839163676)
@@ -39,6 +39,7 @@
                       throw new EntityNotFoundException("–ü–∞—Ü–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω");
 
         var assignment = new Assignment(
+            dto.Name,
             dto.AcceptDate,
             dto.DepartmentNumber,
             dto.Description,
@@ -78,6 +79,7 @@
                           throw new EntityNotFoundException("–ü–∞—Ü–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω");
 
             var assignment = new Assignment(
+                dto.Name,
                 dto.AcceptDate,
                 dto.DepartmentNumber,
                 dto.Description,
Index: src/CRM.SocialDepartment.Core/CRM.SocialDepartment.Application/DTOs/CreateOrEditAssignmentDto.cs
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>namespace CRM.SocialDepartment.Application.DTOs\r\n{\r\n    public class CreateOrEditAssignmentDto\r\n    {\r\n        public Guid Id { get; init; }\r\n        public string Description { get; init; } = string.Empty;\r\n        public DateTime CreatedDate { get; init; }\r\n        public string ForwardDepartment { get; init; } = string.Empty;\r\n        public DateTime DueDate { get; init; }\r\n        public string Assignee { get; init; } = string.Empty;\r\n        public DateTime AcceptDate { get; init; }\r\n        public DateTime ForwardDate { get; init; }\r\n        public int DepartmentNumber { get; init; }\r\n        public DateTime DepartmentForwardDate { get; init; }\r\n        public string? Note { get; init; }\r\n        public Guid PatientId { get; init; }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/CRM.SocialDepartment.Core/CRM.SocialDepartment.Application/DTOs/CreateOrEditAssignmentDto.cs b/src/CRM.SocialDepartment.Core/CRM.SocialDepartment.Application/DTOs/CreateOrEditAssignmentDto.cs
--- a/src/CRM.SocialDepartment.Core/CRM.SocialDepartment.Application/DTOs/CreateOrEditAssignmentDto.cs	(revision d026a00c98f869bf4ad419ed96c9d8f1e1cd9520)
+++ b/src/CRM.SocialDepartment.Core/CRM.SocialDepartment.Application/DTOs/CreateOrEditAssignmentDto.cs	(date 1756839163684)
@@ -3,6 +3,7 @@
     public class CreateOrEditAssignmentDto
     {
         public Guid Id { get; init; }
+        public string Name { get; init; }
         public string Description { get; init; } = string.Empty;
         public DateTime CreatedDate { get; init; }
         public string ForwardDepartment { get; init; } = string.Empty;
Index: src/CRM.SocialDepartment.Core/CRM.SocialDepartment.Domain/Entities/Assignment.cs
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>using CRM.SocialDepartment.Domain.Entities.Patients;\r\nusing CRM.SocialDepartment.Domain.Events;\r\nusing CRM.SocialDepartment.Domain.Exceptions;\r\nusing DDD.Entities;\r\n\r\nnamespace CRM.SocialDepartment.Domain.Entities;\r\n\r\npublic class Assignment : AggregateRoot<Guid>, IArchive, ISoftDelete\r\n{\r\n    public Assignment(DateTime acceptDate, int departmentNumber, string description, DateTime forwardDate, string forwardDepartment, Dictionary<string, string> statusLog, DateTime departmentForwardDate, string assignee, string? note, DateTime creationDate, Patient patient)\r\n    {\r\n        AcceptDate = acceptDate;\r\n        DepartmentNumber = departmentNumber;\r\n        Description = description;\r\n        ForwardDate = forwardDate;\r\n        ForwardDepartment = forwardDepartment;\r\n        StatusLog = statusLog;\r\n        DepartmentForwardDate = departmentForwardDate;\r\n        Assignee = assignee;\r\n        Note = note;\r\n        CreationDate = creationDate;\r\n        Patient = patient;\r\n\r\n        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è\r\n        AddDomainEvent(new AssignmentCreatedEvent(this));\r\n    }\r\n\r\n    /// <summary>\r\n    /// –î–∞—Ç–∞ –ø—Ä–∏–µ–º–∞ –∑–∞—è–≤–∫–∏ –æ—Ç –æ—Ç–¥–µ–ª–µ–Ω–∏—è\r\n    /// </summary>\r\n    public DateTime AcceptDate { get; private set; }\r\n\r\n    /// <summary>\r\n    /// –ù–æ–º–µ—Ä –æ—Ç–¥–µ–ª–µ–Ω–∏—è\r\n    /// </summary>\r\n    public int DepartmentNumber { get; private set; }\r\n\r\n    /// <summary>\r\n    /// –û–ø–∏—Å–∞–Ω–∏–µ\r\n    /// </summary>\r\n    public string Description { get; private set; }\r\n\r\n    /// <summary>\r\n    /// –î–∞—Ç–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è\r\n    /// </summary>\r\n    public DateTime ForwardDate { get; private set; }\r\n\r\n    /// <summary>\r\n    /// –ö—É–¥–∞ –Ω–∞–ø—Ä–∞–≤–∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã\r\n    /// </summary>\r\n    public string ForwardDepartment { get; private set; } /* TODO: replace string with Department datatype */\r\n\r\n    /// <summary>\r\n    /// –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ\r\n    /// </summary>\r\n    public Dictionary<string, string> StatusLog { get; private set; }\r\n\r\n    /// <summary>\r\n    /// –î–∞—Ç–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ\r\n    /// </summary>\r\n    public DateTime DepartmentForwardDate { get; private set; }\r\n\r\n    /// <summary>\r\n    /// –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å\r\n    /// </summary>\r\n    public string Assignee { get; private set; } /* TODO: replace string with User datatype or something like that */\r\n\r\n    /// <summary>\r\n    /// –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ\r\n    /// </summary>\r\n    public string? Note { get; private set; }\r\n\r\n    /// <summary>\r\n    /// –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏\r\n    /// </summary>\r\n    public DateTime CreationDate { get; private set; }\r\n    \r\n    /// <summary>\r\n    /// –ü–∞—Ü–∏–µ–Ω—Ç\r\n    /// </summary>\r\n    public Patient Patient { get; private set; }\r\n\r\n    /// <summary>\r\n    /// –ü–æ–º–µ—á–µ–Ω –∫–∞–∫ –≤ –∞—Ä—Ö–∏–≤–µ (–ø–∞—Ü–∏–µ–Ω—Ç –≤—ã–ø–∏—Å–∞–Ω)\r\n    /// </summary>\r\n    public bool IsArchive { get; set; }\r\n\r\n    /// <summary>\r\n    /// –ü–æ–º–µ—á–µ–Ω –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω—ã–π\r\n    /// </summary>\r\n    public bool SoftDeleted { get; set; }\r\n\r\n    public void UpdateDescription(string description)\r\n    {\r\n        Description = description;\r\n        AddDomainEvent(new AssignmentUpdatedEvent(this));\r\n    }\r\n\r\n    public void UpdateAcceptDate(DateTime acceptDate)\r\n    {\r\n        AcceptDate = acceptDate;\r\n        AddDomainEvent(new AssignmentUpdatedEvent(this));\r\n    }\r\n\r\n    public void UpdateForwardDate(DateTime forwardDate)\r\n    {\r\n        ForwardDate = forwardDate;\r\n        AddDomainEvent(new AssignmentUpdatedEvent(this));\r\n    }\r\n\r\n    public void UpdateForwardDepartment(string department)\r\n    {\r\n        ForwardDepartment = department;\r\n        AddDomainEvent(new AssignmentUpdatedEvent(this));\r\n    }\r\n\r\n    public void UpdateDepartmentNumber(int departmentNumber)\r\n    {\r\n        var oldDepartmentNumber = DepartmentNumber;\r\n        DepartmentNumber = departmentNumber;\r\n        \r\n        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ —Å–º–µ–Ω—ã –æ—Ç–¥–µ–ª–µ–Ω–∏—è\r\n        AddDomainEvent(new AssignmentDepartmentChangedEvent(this, oldDepartmentNumber, departmentNumber));\r\n        AddDomainEvent(new AssignmentUpdatedEvent(this));\r\n    }\r\n\r\n    public void UpdateDepartmentForwardDate(DateTime forwardDate)\r\n    {\r\n        DepartmentForwardDate = forwardDate;\r\n        AddDomainEvent(new AssignmentUpdatedEvent(this));\r\n    }\r\n\r\n    public void UpdateAssignee(string assignee)\r\n    {\r\n        Assignee = assignee;\r\n        \r\n        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è\r\n        AddDomainEvent(new AssignmentAssignedEvent(this, assignee));\r\n        AddDomainEvent(new AssignmentUpdatedEvent(this));\r\n    }\r\n\r\n    public void UpdateNote(string note)\r\n    {\r\n        if (string.IsNullOrEmpty(note)) throw new ArgumentNullException(nameof(note));\r\n        Note = note;\r\n        AddDomainEvent(new AssignmentUpdatedEvent(this));\r\n    }\r\n\r\n    /// <summary>\r\n    /// –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ\r\n    /// </summary>\r\n    /// <param name=\"reason\">–ü—Ä–∏—á–∏–Ω–∞ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è</param>\r\n    public void Archive(string? reason = null)\r\n    {\r\n        if (IsArchive)\r\n            throw new DomainException(\"–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —É–∂–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∞—Ä—Ö–∏–≤–µ\");\r\n\r\n        IsArchive = true;\r\n        \r\n        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è\r\n        AddDomainEvent(new AssignmentArchivedEvent(this, reason));\r\n    }\r\n\r\n    /// <summary>\r\n    /// –ü–æ–º–µ—Ç–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω–æ–µ (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)\r\n    /// </summary>\r\n    public void SoftDelete()\r\n    {\r\n        if (SoftDeleted)\r\n            throw new DomainException(\"–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —É–∂–µ –ø–æ–º–µ—á–µ–Ω–æ –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω–æ–µ\");\r\n\r\n        SoftDeleted = true;\r\n        \r\n        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è\r\n        AddDomainEvent(new AssignmentDeletedEvent(Id, Description, Patient.Id));\r\n    }\r\n\r\n    /// <summary>\r\n    /// –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ –∂—É—Ä–Ω–∞–ª\r\n    /// </summary>\r\n    /// <param name=\"status\">–ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å</param>\r\n    public void AddStatus(string status)\r\n    {\r\n        if (string.IsNullOrEmpty(status)) \r\n            throw new ArgumentNullException(nameof(status));\r\n\r\n        var timestamp = DateTime.Now.ToString(\"yyyy-MM-dd HH:mm:ss\");\r\n        StatusLog[timestamp] = status;\r\n        \r\n        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞\r\n        AddDomainEvent(new AssignmentStatusAddedEvent(this, status));\r\n        AddDomainEvent(new AssignmentUpdatedEvent(this));\r\n    }\r\n    \r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/CRM.SocialDepartment.Core/CRM.SocialDepartment.Domain/Entities/Assignment.cs b/src/CRM.SocialDepartment.Core/CRM.SocialDepartment.Domain/Entities/Assignment.cs
--- a/src/CRM.SocialDepartment.Core/CRM.SocialDepartment.Domain/Entities/Assignment.cs	(revision d026a00c98f869bf4ad419ed96c9d8f1e1cd9520)
+++ b/src/CRM.SocialDepartment.Core/CRM.SocialDepartment.Domain/Entities/Assignment.cs	(date 1756839163640)
@@ -7,7 +7,9 @@
 
 public class Assignment : AggregateRoot<Guid>, IArchive, ISoftDelete
 {
-    public Assignment(DateTime acceptDate, int departmentNumber, string description, DateTime forwardDate, string forwardDepartment, Dictionary<string, string> statusLog, DateTime departmentForwardDate, string assignee, string? note, DateTime creationDate, Patient patient)
+    public Assignment(string name, DateTime acceptDate, int departmentNumber, string description, DateTime forwardDate,
+        string forwardDepartment, Dictionary<string, string> statusLog, DateTime departmentForwardDate, string assignee,
+        string? note, DateTime creationDate, Patient patient)
     {
         AcceptDate = acceptDate;
         DepartmentNumber = departmentNumber;
@@ -20,11 +22,17 @@
         Note = note;
         CreationDate = creationDate;
         Patient = patient;
+        Name = name;
 
         // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
         AddDomainEvent(new AssignmentCreatedEvent(this));
     }
 
+    ///<summary>
+    /// –ù–∞–∑–≤–∞–Ω–∏–µ
+    /// </summary>
+    public string Name { get; private set; }
+
     /// <summary>
     /// –î–∞—Ç–∞ –ø—Ä–∏–µ–º–∞ –∑–∞—è–≤–∫–∏ –æ—Ç –æ—Ç–¥–µ–ª–µ–Ω–∏—è
     /// </summary>
@@ -74,7 +82,7 @@
     /// –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
     /// </summary>
     public DateTime CreationDate { get; private set; }
-    
+
     /// <summary>
     /// –ü–∞—Ü–∏–µ–Ω—Ç
     /// </summary>
@@ -118,7 +126,7 @@
     {
         var oldDepartmentNumber = DepartmentNumber;
         DepartmentNumber = departmentNumber;
-        
+
         // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ —Å–º–µ–Ω—ã –æ—Ç–¥–µ–ª–µ–Ω–∏—è
         AddDomainEvent(new AssignmentDepartmentChangedEvent(this, oldDepartmentNumber, departmentNumber));
         AddDomainEvent(new AssignmentUpdatedEvent(this));
@@ -133,7 +141,7 @@
     public void UpdateAssignee(string assignee)
     {
         Assignee = assignee;
-        
+
         // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
         AddDomainEvent(new AssignmentAssignedEvent(this, assignee));
         AddDomainEvent(new AssignmentUpdatedEvent(this));
@@ -156,7 +164,7 @@
             throw new DomainException("–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —É–∂–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∞—Ä—Ö–∏–≤–µ");
 
         IsArchive = true;
-        
+
         // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
         AddDomainEvent(new AssignmentArchivedEvent(this, reason));
     }
@@ -170,7 +178,7 @@
             throw new DomainException("–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —É–∂–µ –ø–æ–º–µ—á–µ–Ω–æ –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω–æ–µ");
 
         SoftDeleted = true;
-        
+
         // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
         AddDomainEvent(new AssignmentDeletedEvent(Id, Description, Patient.Id));
     }
@@ -181,15 +189,14 @@
     /// <param name="status">–ù–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å</param>
     public void AddStatus(string status)
     {
-        if (string.IsNullOrEmpty(status)) 
+        if (string.IsNullOrEmpty(status))
             throw new ArgumentNullException(nameof(status));
 
         var timestamp = DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss");
         StatusLog[timestamp] = status;
-        
+
         // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
         AddDomainEvent(new AssignmentStatusAddedEvent(this, status));
         AddDomainEvent(new AssignmentUpdatedEvent(this));
     }
-    
 }
\ No newline at end of file
Index: src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/wwwroot/js/assignment.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/wwwroot/js/assignment.js b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/wwwroot/js/assignment.js
new file mode 100644
--- /dev/null	(date 1756839163696)
+++ b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/wwwroot/js/assignment.js	(date 1756839163696)
@@ -0,0 +1,658 @@
+console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫:');
+console.log('jQuery:', typeof $ !== 'undefined' ? '‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ' : '‚ùå –ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ');
+console.log('DataTables:', typeof $.fn.DataTable !== 'undefined' ? '‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ' : '‚ùå –ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ');
+if (typeof $.fn.DataTable !== 'undefined') {
+    console.log('DataTables –≤–µ—Ä—Å–∏—è:', $.fn.dataTable.version);
+}
+
+function showMessage(type, title, message) {
+    if (window.malomalsky?.message?.[type] && typeof window.malomalsky.message[type] === 'function') {
+        try {
+            malomalsky.message[type](title, message);
+            return;
+        } catch (error) {
+            console.error('–û—à–∏–±–∫–∞ –≤ malomalsky.message:', error);
+        }
+    }
+
+    if (window.Swal) {
+        const config = {
+            title: title,
+            text: message,
+            confirmButtonText: 'OK'
+        };
+
+        switch (type) {
+            case 'success': config.icon = 'success'; break;
+            case 'error': config.icon = 'error'; break;
+            case 'warning': config.icon = 'warning'; break;
+            case 'info': config.icon = 'info'; break;
+        }
+
+        Swal.fire(config);
+    } else {
+        console.log(`${title}: ${message}`);
+    }
+}
+
+function addPatient() {
+    GetFormModal('/Assignment/modal/create', '–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É');
+}
+
+function editPatient(patientId) {
+    $.get(`/Assignment/Edit/${patientId}`, function (data) {
+        $('#edit-patient-modal .modal-body').html(data);
+        $('#edit-patient-modal').modal('show');
+    }).fail(function () {
+        showMessage('error', '–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
+    });
+}
+
+function archivePatient(patientId) {
+    Swal.fire({
+        title: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ',
+        text: '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É?',
+        icon: 'warning',
+        showCancelButton: true,
+        confirmButtonColor: '#d33',
+        cancelButtonColor: '#3085d6',
+        confirmButtonText: '–î–∞, –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å',
+        cancelButtonText: '–û—Ç–º–µ–Ω–∞'
+    }).then((result) => {
+        if (result.isConfirmed) {
+            $.post(`/Patient/Archive/${patientId}`)
+                .done(function (response) {
+                    if (response.success) {
+                        showMessage('success', '–£—Å–ø–µ—à–Ω–æ!', '–ü–∞—Ü–∏–µ–Ω—Ç –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω.');
+                        if (window.patientDataTable) {
+                            window.patientDataTable.ajax.reload();
+                        }
+                    } else {
+                        showMessage('error', '–û—à–∏–±–∫–∞!', response.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–∞.');
+                    }
+                })
+                .fail(function () {
+                    showMessage('error', '–û—à–∏–±–∫–∞!', '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–∞—Ü–∏–µ–Ω—Ç–∞.');
+                });
+        }
+    });
+}
+
+// –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
+function updateConnectionStatus() {
+    const isConnected = true; // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
+    $('#connection-status').html(
+        isConnected
+            ? '<i class="fa fa-circle text-success"></i><small>–ü–æ–¥–∫–ª—é—á–µ–Ω–æ</small>'
+            : '<i class="fa fa-circle text-warning"></i><small>Polling —Ä–µ–∂–∏–º</small>'
+    );
+}
+
+// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
+function updateLastUpdateTime() {
+    const now = new Date();
+    const timeString = now.toLocaleTimeString('ru-RU', {
+        hour: '2-digit',
+        minute: '2-digit',
+        second: '2-digit'
+    });
+    $('#last-update').text(timeString);
+}
+
+// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∑–∞–ø–∏—Å–µ–π
+function updateRecordsCount(count) {
+    $('#records-badge').text(count || 0);
+}
+
+// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö
+let autoRefreshInterval;
+function startAutoRefresh() {
+    if ($('#auto-refresh-setting').is(':checked') && window.patientDataTable) {
+        stopAutoRefresh();
+        autoRefreshInterval = setInterval(() => {
+            window.patientDataTable.ajax.reload(null, false);
+            updateLastUpdateTime();
+        }, 30000);
+    }
+}
+
+function stopAutoRefresh() {
+    if (autoRefreshInterval) {
+        clearInterval(autoRefreshInterval);
+        autoRefreshInterval = null;
+    }
+}
+
+// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
+function loadSettings() {
+    const savedSettings = localStorage.getItem('patientTableSettings');
+    if (savedSettings) {
+        try {
+            const settings = JSON.parse(savedSettings);
+            $('#page-length-setting').val(settings.pageLength || '50');
+            $('#auto-refresh-setting').prop('checked', settings.autoRefresh !== false);
+            $('#compact-mode-setting').prop('checked', settings.compactMode || false);
+            $('#save-state-setting').prop('checked', settings.saveState !== false);
+        } catch (e) {
+            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', e);
+        }
+    }
+}
+
+// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DataTable –¥–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤
+function initializePatientDataTable() {
+    console.log('üîß –ù–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é DataTable');
+
+    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ DOM
+    const $table = $('#table');
+    console.log('üìã –¢–∞–±–ª–∏—Ü–∞ –Ω–∞–π–¥–µ–Ω–∞ –≤ DOM:', $table.length > 0);
+    if ($table.length === 0) {
+        console.error('‚ùå –¢–∞–±–ª–∏—Ü–∞ —Å id="table" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ DOM');
+        return null;
+    }
+
+    if ($.fn.DataTable.isDataTable('#table')) {
+        console.log('üîÑ DataTable —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —É–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—É—é');
+        $('#table').DataTable().destroy();
+        $('#table').empty();
+    }
+
+    // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
+    const url = '/api/patients/active';
+    console.log('üì° URL –¥–ª—è AJAX –∑–∞–ø—Ä–æ—Å–∞:', url);
+
+    try {
+        const dataTable = $('#table').DataTable({
+            processing: true,
+            serverSide: true,
+            ajax: {
+                url: url,
+                type: 'POST',
+                dataType: 'json',
+                headers: {
+                    'X-Requested-With': 'XMLHttpRequest'
+                },
+                data: function(d) {
+                    console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ DataTable:', d);
+                    return d;
+                },
+                beforeSend: function(xhr) {
+                    console.log('üöÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX –∑–∞–ø—Ä–æ—Å –Ω–∞:', url);
+                    console.log('üîç –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:', this.data);
+                },
+                dataSrc: function (json) {
+                    console.log('üì¶ –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', json);
+
+                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ json —è–≤–ª—è–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç–æ–º
+                    if (!json || typeof json !== 'object') {
+                        console.error('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
+                        return [];
+                    }
+
+                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–∫–∏ –≤ –æ—Ç–≤–µ—Ç–µ
+                    if (json.error) {
+                        console.error('‚ùå –°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É:', json.error);
+                        showMessage('error', '–û—à–∏–±–∫–∞', json.error);
+                        return [];
+                    }
+
+                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ
+                    if (json.data && Array.isArray(json.data)) {
+                        console.log('‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {Count} –∑–∞–ø–∏—Å–µ–π', json.data.length);
+                        updateRecordsCount(json.recordsTotal || 0);
+                        updateLastUpdateTime();
+                        return json.data;
+                    }
+
+                    console.log('üì≠ –ü–æ–ª—É—á–µ–Ω –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
+                    updateRecordsCount(0);
+                    updateLastUpdateTime();
+                    return [];
+                },
+                error: function (xhr, status, error) {
+                    console.error('‚ùå –û—à–∏–±–∫–∞ AJAX –∑–∞–ø—Ä–æ—Å–∞:', {xhr, status, error});
+
+                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
+                    if (status !== 'abort') {
+                        showMessage('error', '–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤');
+                    }
+
+                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ—à–∏–±–æ–∫ DataTable
+                    return [];
+                }
+            },
+            columns: [
+                {
+                    data: 'id',
+                    title: '–î–µ–π—Å—Ç–≤–∏—è',
+                    orderable: false,
+                    searchable: false,
+                    render: function (data, type, row) {
+                        return `
+                        <div class="dropdown">
+                            <button class="btn btn-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
+                                –î–µ–π—Å—Ç–≤–∏–µ
+                            </button>
+                            <ul class="dropdown-menu">
+                                <li><a class="dropdown-item btn-view-patient" href="#" data-patient-id="${data}">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å</a></li>
+                                <li><a class="dropdown-item btn-edit-patient" href="#" data-patient-id="${data}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a></li>
+                                <li><a class="dropdown-item btn-archive-patient" href="#" data-patient-id="${data}">–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å</a></li>
+                            </ul>
+                        </div>
+                    `;
+                    }
+                },
+                {
+                    data: 'id',
+                    title: 'ID',
+                    visible: false,
+                    searchable: false
+                },
+                { data: 'hospitalizationType', className: 'text-center' },
+                { data: 'resolution', className: 'text-center' },
+                { data: 'medicalHistoryNumber', className: 'text-center' },
+                { data: 'dateOfReceipt', className: 'text-center' },
+                { data: 'department', className: 'text-center' },
+                { data: 'fullName', className: 'fw-medium' },
+                { data: 'birthday', className: 'text-center' },
+                { data: 'isChildren', className: 'text-center' },
+                { data: 'citizenship', className: 'text-center' },
+                { data: 'country', className: 'text-center' },
+                { data: 'registration', className: 'fw-medium' },
+                { data: 'notRegistered', className: 'text-center' },
+                { data: 'earlyRegistration', className: 'fw-medium' },
+                { data: 'placeOfBirth', className: 'text-center' },
+                {
+                    data: 'IsCapable',
+                    className: 'text-center',
+                    render: function (data) {
+                        return data ?
+                            '<span class="badge bg-success">–î–µ–µ—Å–ø–æ—Å–æ–±–µ–Ω</span>' :
+                            '<span class="badge bg-warning">–ù–µ–¥–µ–µ—Å–ø–æ—Å–æ–±–µ–Ω</span>';
+                    }
+                },
+                { data: 'ReceivesPension', className: 'text-center' },
+                { data: 'DisabilityGroup', className: 'text-center' },
+                { data: 'Note', className: 'fw-medium' }
+            ],
+            order: [[7, 'asc']],
+            pageLength: 100,
+            lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, '–í—Å–µ']],
+            language: {
+                url: '/lib/datatables.net-bs5/language/ru.json'
+            },
+            dom: '<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>' +
+                '<"row"<"col-sm-12"tr>>' +
+                '<"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>',
+            responsive: true,
+            initComplete: function () {
+                console.log('‚úÖ DataTable –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
+
+                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø–æ–∏—Å–∫–∞
+                this.api().on('search.dt', function () {
+                    console.log('üîç –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–∏—Å–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ');
+                });
+
+                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—É—Å—Ç—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
+                this.api().on('xhr.dt', function () {
+                    console.log('üìä XHR –∑–∞–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–µ–Ω');
+                });
+            }
+        });
+
+        window.patientDataTable = dataTable;
+        console.log('üíæ DataTable —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ window.patientDataTable');
+        console.log('üîç DataTable –æ–±—ä–µ–∫—Ç:', dataTable);
+        return dataTable;
+    } catch (error) {
+        console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ DataTable:', error);
+        showMessage('error', '–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤.');
+        return null;
+    }
+}
+
+// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç dd.MM.yyyy
+function formatDate(date) {
+    if (!date) return '';
+
+    const d = new Date(date);
+    if (isNaN(d.getTime())) return '';
+
+    const day = String(d.getDate()).padStart(2, '0');
+    const month = String(d.getMonth() + 1).padStart(2, '0');
+    const year = d.getFullYear();
+
+    return `${day}.${month}.${year}`;
+}
+
+// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ dd.MM.yyyy –≤ ISO —Ñ–æ—Ä–º–∞—Ç –¥–ª—è input type="date"
+function formatDateForInput(dateString) {
+    if (!dateString) return '';
+
+    const parts = dateString.split('.');
+    if (parts.length !== 3) return '';
+
+    const day = parts[0];
+    const month = parts[1];
+    const year = parts[2];
+
+    return `${year}-${month}-${day}`;
+}
+
+// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
+$(document).ready(function () {
+    console.log('üöÄ Document ready, –Ω–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é');
+
+    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
+    if (typeof $ === 'undefined') {
+        console.error('‚ùå jQuery –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
+        return;
+    }
+
+    if (typeof $.fn.DataTable === 'undefined') {
+        console.error('‚ùå DataTables –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
+        return;
+    }
+
+    console.log('‚úÖ –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
+
+    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
+    loadSettings();
+    updateConnectionStatus();
+    updateLastUpdateTime();
+
+    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DataTable
+    console.log('üìä –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º DataTable');
+    const dataTableResult = initializePatientDataTable();
+    if (dataTableResult) {
+        console.log('‚úÖ DataTable —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
+        startAutoRefresh();
+    } else {
+        console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å DataTable');
+    }
+
+    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–∞"
+    $(document).on('click', '#add-patient', function (e) {
+        e.preventDefault();
+        addPatient();
+    });
+
+    //–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞: –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–∞
+    $('#form-modal').on('submit', '#create-patient', function (e) {
+        e.preventDefault();
+
+        $this = $(this);
+        var url = $this.attr('action');
+
+        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞—Ç –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
+        var formData = new FormData($this[0]);
+        var data = new URLSearchParams();
+
+        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º FormData –≤ URLSearchParams —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –¥–∞—Ç
+        for (var pair of formData.entries()) {
+            var key = pair[0];
+            var value = pair[1];
+
+            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ–ª—è —Å –¥–∞—Ç–∞–º–∏
+            if (key === 'Birthday' || key === 'MedicalHistory.DateOfReceipt' ||
+                key === 'CitizenshipInfo.PlaceOfBirth' || key === 'Capable.TrialDate') {
+                if (value) {
+                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞—Ç—É –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞
+                    var date = new Date(value);
+                    if (!isNaN(date.getTime())) {
+                        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –≤ ISO —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞
+                        var year = date.getFullYear();
+                        var month = String(date.getMonth() + 1).padStart(2, '0');
+                        var day = String(date.getDate()).padStart(2, '0');
+                        value = `${year}-${month}-${day}`;
+                    }
+                }
+            }
+
+            data.append(key, value);
+        }
+
+        var headers = {
+            "CSRF-TOKEN": $this.find('input[name="__RequestVerificationToken"]').val()
+        };
+
+        // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ—à–∏–±–∫–∏
+        window.AddPatientFormValidation.clearValidationErrors();
+
+        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
+        $.ajax({
+            url: url,
+            type: 'POST',
+            data: data.toString(),
+            contentType: 'application/x-www-form-urlencoded',
+            headers: headers,
+            beforeSend: function () {
+                $("#form-modal").find(':submit').attr('disabled', true);
+                $("#form-modal").find(':submit').html('<div class="spinner-border spinner-border-sm" role="status"></div>');
+            },
+            success: function (response) {
+                $('#form-modal').modal('hide');
+
+                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
+                if (typeof malomalsky !== 'undefined' && malomalsky.message && malomalsky.message.success) {
+                    malomalsky.message.success('–£—Å–ø–µ—à–Ω–æ!', '–ü–∞—Ü–∏–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω');
+                } else {
+                    showMessage('success', '–£—Å–ø–µ—à–Ω–æ!', '–ü–∞—Ü–∏–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω');
+                }
+
+                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É
+                if (window.patientDataTable) {
+                    window.patientDataTable.ajax.reload();
+                }
+            },
+            error: function (xhr) {
+                $("#form-modal").find(':submit').html('–°–æ—Ö—Ä–∞–Ω–∏—Ç—å');
+                $("#form-modal").find(':submit').attr('disabled', false);
+
+                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (400)
+                if (xhr.status === 400) {
+                    try {
+                        var response = JSON.parse(xhr.responseText);
+                        console.log('üìã –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç —Å –æ—à–∏–±–∫–∞–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:', response);
+
+                        if (response && response.Data && response.Data.Errors && Array.isArray(response.Data.Errors)) {
+                            console.log('üîç –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:', response.Data.Errors);
+
+                            // –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤—Å–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
+                            AddPatientFormValidation.testAllFormFields();
+
+                            AddPatientFormValidation.showValidationErrors(response.Data.Errors);
+                            return;
+                        }
+                    } catch (parseError) {
+                        console.log('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç —Å –æ—à–∏–±–∫–∞–º–∏:', parseError);
+                    }
+                }
+
+                // –û–±—â–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
+                var errorMessage = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–∞—Ü–∏–µ–Ω—Ç–∞';
+                if (xhr.responseText) {
+                    try {
+                        var response = JSON.parse(xhr.responseText);
+                        if (response && response.ErrorMessage) {
+                            errorMessage = response.ErrorMessage;
+                        }
+                    } catch (e) {
+                        // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
+                    }
+                }
+
+                if (typeof malomalsky !== 'undefined' && malomalsky.message && malomalsky.message.error) {
+                    malomalsky.message.error('–û—à–∏–±–∫–∞!', errorMessage);
+                } else {
+                    showMessage('error', '–û—à–∏–±–∫–∞!', errorMessage);
+                }
+            }
+        });
+    });
+
+    // –û—á–∏—Å—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ –≤ –ø–æ–ª—è
+    $(document).on('input focus', '.form-control.is-invalid, .form-select.is-invalid', function() {
+        $(this).removeClass('is-invalid');
+        $(this).siblings('.invalid-feedback, .text-danger.field-validation-error').remove();
+    });
+
+    // –û—á–∏—Å—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏—è select
+    $(document).on('change', '.form-select.is-invalid', function() {
+        $(this).removeClass('is-invalid');
+        $(this).siblings('.invalid-feedback, .text-danger.field-validation-error').remove();
+    });
+
+    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"
+    $(document).on('click', '#reload-data', function (e) {
+        e.preventDefault();
+        if (window.patientDataTable) {
+            window.patientDataTable.ajax.reload(function () {
+                updateLastUpdateTime();
+            }, false); // false - —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É
+        }
+    });
+
+    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º"
+    $(document).on('click', '#fullscreen-toggle', function (e) {
+        e.preventDefault();
+        e.stopPropagation();
+
+        const $container = $('.modern-datatable-container');
+        const $icon = $(this).find('i');
+
+        if (!$container.hasClass('fullscreen-mode')) {
+            $container.addClass('fullscreen-mode');
+            $('body').addClass('datatable-fullscreen');
+            $icon.removeClass('fa-expand').addClass('fa-compress');
+
+            // –§–∏–∫—Å–∏—Ä—É–µ–º –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
+            $container.css({
+                'position': 'fixed',
+                'top': '0',
+                'left': '0',
+                'right': '0',
+                'bottom': '0',
+                'z-index': '1040',
+                'background': '#fff'
+            });
+
+            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
+            if (window.patientDataTable) {
+                setTimeout(function () {
+                    window.patientDataTable.columns.adjust().draw();
+                }, 200);
+            }
+        } else {
+            $container.removeClass('fullscreen-mode');
+            $('body').removeClass('datatable-fullscreen');
+            $icon.removeClass('fa-compress').addClass('fa-expand');
+
+            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
+            $container.css({
+                'position': '',
+                'top': '',
+                'left': '',
+                'right': '',
+                'bottom': '',
+                'z-index': '',
+                'background': ''
+            });
+
+            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
+            if (window.patientDataTable) {
+                setTimeout(function () {
+                    window.patientDataTable.columns.adjust();
+                    window.patientDataTable.draw();
+                }, 300);
+            }
+        }
+    });
+
+    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–î–µ–π—Å—Ç–≤–∏–µ"
+    $(document).on('click', '.dropdown-toggle', function (e) {
+        e.preventDefault();
+        e.stopPropagation();
+
+        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ dropdown
+        $('.dropdown-menu').not($(this).next('.dropdown-menu')).hide();
+
+        // –û—Ç–∫—Ä—ã–≤–∞–µ–º/–∑–∞–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π dropdown
+        $(this).next('.dropdown-menu').toggle();
+    });
+
+    // –ó–∞–∫—Ä—ã—Ç–∏–µ dropdown –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
+    $(document).on('click', function (e) {
+        if (!$(e.target).closest('.dropdown').length) {
+            $('.dropdown-menu').hide();
+        }
+    });
+
+    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π –≤ —Ç–∞–±–ª–∏—Ü–µ (–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π)
+    $(document).on('click', '.btn-view-patient', function () {
+        const patientId = $(this).data('patient-id');
+        window.location.href = `/Patient/Card/${patientId}`;
+    });
+
+    $(document).on('click', '.btn-edit-patient', function () {
+        const patientId = $(this).data('patient-id');
+        editPatient(patientId);
+    });
+
+    $(document).on('click', '.btn-archive-patient', function () {
+        const patientId = $(this).data('patient-id');
+        archivePatient(patientId);
+    });
+
+    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
+    $('#apply-settings').on('click', function () {
+        const pageLength = $('#page-length-setting').val();
+        const autoRefresh = $('#auto-refresh-setting').is(':checked');
+        const compactMode = $('#compact-mode-setting').is(':checked');
+
+        if (window.patientDataTable) {
+            $('#table').toggleClass('table-sm', compactMode);
+
+            const settings = {
+                pageLength: pageLength,
+                autoRefresh: autoRefresh,
+                compactMode: compactMode
+            };
+            localStorage.setItem('patientTableSettings', JSON.stringify(settings));
+
+            window.patientDataTable.page.len(pageLength === '-1' ? -1 : parseInt(pageLength)).draw();
+
+            if (autoRefresh) {
+                startAutoRefresh();
+            } else {
+                stopAutoRefresh();
+            }
+        }
+
+        $('#table-settings-modal').modal('hide');
+    });
+
+    // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
+    $(document).on('keydown', function (e) {
+        if (!$(e.target).is('input, textarea, select')) {
+            if (e.ctrlKey && e.key === 'n') {
+                e.preventDefault();
+                $('#add-patient').click();
+            } else if (e.key === 'F5') {
+                e.preventDefault();
+                $('#reload-data').click();
+            } else if (e.key === 'F11') {
+                e.preventDefault();
+                $('#fullscreen-toggle').click();
+            } else if (e.key === 'Escape' && $('.modern-datatable-container').hasClass('fullscreen-mode')) {
+                e.preventDefault();
+                $('#fullscreen-toggle').click();
+            }
+        }
+    });
+
+    console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
+    console.log('DataTable instance:', window.patientDataTable);
+    console.log('AJAX URL:', window.patientDataTable?.ajax?.url());
+
+});
\ No newline at end of file
Index: src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/Views/Assignment/Index.cshtml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>@{\r\n    ViewData[\"Title\"] = \"–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á\";\r\n}\r\n\r\n@section Styles\r\n{\r\n    <link href=\"~/lib/datatables.net-bs5/css/jquery.datatables.css\" rel=\"stylesheet\" />\r\n    <link href=\"~/lib/datatables.net-bs5/css/datatables.bootstrap5.min.css\" rel=\"stylesheet\" />\r\n    <link href=\"~/lib/datatables.net-bs5/css/searchpanes.bootstrap5.min.css\" rel=\"stylesheet\" />\r\n    <link href=\"~/lib/datatables.net-bs5/css/fixedheader.bootstrap5.min.css\" rel=\"stylesheet\" />\r\n    <link href=\"~/lib/datatables.net-bs5/css/scroller.bootstrap5.min.css\" rel=\"stylesheet\" />\r\n}\r\n\r\n@section Scripts\r\n{\r\n    <script src=\"~/lib/datatables.net-bs5/js/jquery.datatables.min.js\"></script>\r\n    <script src=\"~/lib/datatables.net-bs5/js/datatables.bootstrap5.min.js\"></script>\r\n    <script src=\"~/lib/datatables.net-bs5/js/searchpanes.bootstrap5.min.js\"></script>\r\n    <script src=\"~/lib/datatables.net-bs5/js/fixedheader.bootstrap5.min.js\"></script>\r\n    <script src=\"~/lib/datatables.net-bs5/js/scroller.bootstrap5.min.js\"></script>\r\n    <script src=\"~/js/patient.js\" asp-append-version=\"true\"></script>\r\n    @await Html.PartialAsync(\"_ValidationScriptsPartial\")\r\n}\r\n\r\n<div id=\"form-modal\" class=\"modal fade\" tabindex=\"-1\" role=\"dialog\" data-backdrop=\"static\" data-keyboard=\"false\">\r\n    <div class=\"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg\" role=\"document\">\r\n        <div class=\"modal-content\">\r\n            <div class=\"modal-header\">\r\n                <h5 class=\"modal-title\"></h5>\r\n                <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\r\n            </div>\r\n            <div class=\"modal-body\">\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<div class=\"card\" style=\"margin: 10px;\">\r\n    <div class=\"col-sm-12\" style=\"padding:20px\">\r\n        <!-- –ú–µ–Ω—é -->\r\n        <a id=\"add-assignment\" class=\"btn btn-primary\"><i class=\"fa fa-plus\"></i> –ó–∞–¥–∞—á–∞</a>\r\n        <a id=\"reload\" class=\"btn btn-outline-info\"><i class=\"fa fa-refresh\"></i> —Å–ø–∏—Å–æ–∫</a>\r\n        <a onclick=\"\" class=\"btn btn-outline-danger\"><i class=\"fa fa-bitbucket\"></i> (2)</a>\r\n        <!-- onclick=\"printModalShow()\" -->\r\n    </div>\r\n    <div class=\"card-body table-responsive\">\r\n        <div style=\"width: 100%; overflow-x: auto;\">\r\n            <table id=\"table\" class=\"table table-custom table-bordered table-hover\">\r\n                <thead>\r\n                    <tr>\r\n                        <th></th>\r\n                        <th>ID</th>\r\n                        <th>–î–∞—Ç–∞ –ø—Ä–∏–µ–º–∞ –∑–∞—è–≤–∫–∏ –æ—Ç –æ—Ç–¥–µ–ª–µ–Ω–∏—è</th>\r\n                        <th>–ù–æ–º–µ—Ä –æ—Ç–¥–µ–ª–µ–Ω–∏—è</th>\r\n                        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>\r\n                        <th>–î–∞—Ç–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</th>\r\n                        <th>–ö—É–¥–∞ –Ω–∞–ø—Ä–∞–≤–∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã</th>\r\n                        <th>–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ</th>\r\n                        <th>–î–∞—Ç–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ</th>\r\n                        <th>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</th>\r\n                        <th>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th>\r\n                        <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏</th>\r\n                        <th>–ü–∞—Ü–∏–µ–Ω—Ç</th>\r\n                        @* <th>–ü–æ–º–µ—á–µ–Ω –∫–∞–∫ –≤ –∞—Ä—Ö–∏–≤–µ (–ø–∞—Ü–∏–µ–Ω—Ç –≤—ã–ø–∏—Å–∞–Ω)</th> *@\r\n                        @* <th>–ü–æ–º–µ—á–µ–Ω –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω—ã–π</th> *@\r\n                    </tr>\r\n                </thead>\r\n                <tbody id=\"viewAll\"></tbody>\r\n            </table>\r\n        </div>\r\n    </div>\r\n</div>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/Views/Assignment/Index.cshtml b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/Views/Assignment/Index.cshtml
--- a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/Views/Assignment/Index.cshtml	(revision d026a00c98f869bf4ad419ed96c9d8f1e1cd9520)
+++ b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/Views/Assignment/Index.cshtml	(date 1756839163667)
@@ -18,7 +18,7 @@
     <script src="~/lib/datatables.net-bs5/js/searchpanes.bootstrap5.min.js"></script>
     <script src="~/lib/datatables.net-bs5/js/fixedheader.bootstrap5.min.js"></script>
     <script src="~/lib/datatables.net-bs5/js/scroller.bootstrap5.min.js"></script>
-    <script src="~/js/patient.js" asp-append-version="true"></script>
+    <script src="~/js/assignment.js" asp-append-version="true"></script>
     @await Html.PartialAsync("_ValidationScriptsPartial")
 }
 
Index: src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/MappingProfile/ProjectMappingProfile.cs
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>using AutoMapper;\r\nusing CRM.SocialDepartment.Application.DTOs;\r\nusing CRM.SocialDepartment.Domain.Entities;\r\nusing CRM.SocialDepartment.Domain.Entities.Patients;\r\nusing CRM.SocialDepartment.Domain.Entities.Patients.Documents;\r\nusing CRM.SocialDepartment.Infrastructure.DataAccess.MongoDb.Data;\r\nusing CRM.SocialDepartment.Site.Models.Patient;\r\nusing CRM.SocialDepartment.Site.ViewModels.Patient;\r\nusing CRM.SocialDepartment.Site.ViewModels.User;\r\n\r\nnamespace CRM.SocialDepartment.Site.MappingProfile\r\n{\r\n    public class ProjectMappingProfile : Profile\r\n    {\r\n        public ProjectMappingProfile()\r\n        {\r\n            // Patient //////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<CreatePatientViewModel, CreatePatientDTO>()\r\n                .ForMember(dest => dest.Birthday, opt => opt.MapFrom(src => \r\n                    DateTime.SpecifyKind(src.Birthday, DateTimeKind.Utc)))\r\n                .ForMember(dest => dest.Documents, opt => opt.MapFrom(src =>\r\n                    src.Documents.ToDictionary(\r\n                        kvp => kvp.Key,\r\n                        kvp => new DocumentDTO\r\n                        {\r\n                            Type = kvp.Key,\r\n                            // –°–µ–ª–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤\r\n                            Number = FormatDocumentNumber(kvp.Key, kvp.Value.Number)\r\n                        }\r\n                    )))\r\n                // –í–ê–ñ–ù–û: –ï—Å–ª–∏ –ø–∞—Ü–∏–µ–Ω—Ç –ù–ï –ø–æ–ª—É—á–∞–µ—Ç –ø–µ–Ω—Å–∏—é, —Ç–æ –¥–∞–Ω–Ω—ã–µ –æ –ø–µ–Ω—Å–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å null\r\n                .ForMember(dest => dest.Pension, opt => opt.MapFrom(src => \r\n                    src.ReceivesPension ? src.Pension : null))\r\n                // –í–ê–ñ–ù–û: –ï—Å–ª–∏ –ø–∞—Ü–∏–µ–Ω—Ç –¥–µ–µ—Å–ø–æ—Å–æ–±–µ–Ω, —Ç–æ Capable –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å null\r\n                .ForMember(dest => dest.Capable, opt => opt.MapFrom(src => \r\n                    src.IsCapable ? null : src.Capable))\r\n                // –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥–∞–µ–º ReceivesPension –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏\r\n                .ForMember(dest => dest.ReceivesPension, opt => opt.MapFrom(src => src.ReceivesPension));\r\n\r\n            CreateMap<EditPatientViewModel, EditPatientDTO>()\r\n                //.ForMember(dest => dest.Birthday, opt => opt.MapFrom(src => \r\n                //    DateTime.SpecifyKind(src.Birthday, DateTimeKind.Utc)))\r\n                .ForMember(dest => dest.Documents, opt => opt.MapFrom(src =>\r\n                    src.Documents.ToDictionary(\r\n                        kvp => kvp.Key,\r\n                        kvp => new DocumentDTO\r\n                        {\r\n                            Type = kvp.Key,\r\n                            // –°–µ–ª–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤\r\n                            Number = FormatDocumentNumber(kvp.Key, kvp.Value.Number)\r\n                        }\r\n                    )));\r\n\r\n            CreateMap<Patient, EditPatientDTO>()\r\n                .ForMember(dest => dest.FullName, opt => opt.MapFrom(src => src.FullName))\r\n                //.ForMember(dest => dest.Birthday, opt => opt.MapFrom(src => \r\n                //    DateTime.SpecifyKind(src.Birthday, DateTimeKind.Utc)))\r\n                .ForMember(dest => dest.ActiveMedicalHistory, opt => opt.MapFrom(src => new MedicalHistoryDTO\r\n                {\r\n                    NumberDepartment = (sbyte)(src.ActiveHistory != null ? src.ActiveHistory.NumberDepartment : 0),\r\n                    HospitalizationType = new HospitalizationTypeDTO\r\n                    {\r\n                        Value = (byte)(src.ActiveHistory != null && src.ActiveHistory.HospitalizationType != null ? src.ActiveHistory.HospitalizationType.Value : 0),\r\n                        DisplayName = src.ActiveHistory != null && src.ActiveHistory.HospitalizationType != null ? src.ActiveHistory.HospitalizationType.DisplayName : string.Empty\r\n                    },\r\n                    Resolution = src.ActiveHistory != null ? src.ActiveHistory.Resolution : string.Empty,\r\n                    NumberDocument = src.ActiveHistory != null ? src.ActiveHistory.NumberDocument : string.Empty,\r\n                    DateOfReceipt = src.ActiveHistory != null ? DateTime.SpecifyKind(src.ActiveHistory.DateOfReceipt, DateTimeKind.Utc) : DateTime.MinValue,\r\n                    DateOfDischarge = src.ActiveHistory != null && src.ActiveHistory.DateOfDischarge.HasValue ? DateTime.SpecifyKind(src.ActiveHistory.DateOfDischarge.Value, DateTimeKind.Utc) : null,\r\n                    Note = src.ActiveHistory != null ? src.ActiveHistory.Note : null\r\n                }))\r\n                .ForMember(dest => dest.CitizenshipInfo, opt => opt.MapFrom(src => new CitizenshipInfoDTO\r\n                {\r\n                    Citizenship = src.CitizenshipInfo != null ? src.CitizenshipInfo.Citizenship : CitizenshipType.RussianFederation,\r\n                    Country = src.CitizenshipInfo != null ? src.CitizenshipInfo.Country : string.Empty,\r\n                    Registration = src.CitizenshipInfo != null ? src.CitizenshipInfo.Registration : string.Empty,\r\n                    EarlyRegistration = src.CitizenshipInfo != null ? src.CitizenshipInfo.EarlyRegistration : null,\r\n                    PlaceOfBirth = src.CitizenshipInfo != null ? src.CitizenshipInfo.PlaceOfBirth : null,\r\n                    DocumentAttached = src.CitizenshipInfo != null ? src.CitizenshipInfo.DocumentAttached : null\r\n                }))\r\n                .ForMember(dest => dest.Documents, opt => opt.MapFrom(src => \r\n                    src.Documents.ToDictionary(\r\n                        kvp => kvp.Key,\r\n                        kvp => new DocumentDTO\r\n                        {\r\n                            Type = kvp.Key,\r\n                            Number = ExtractDocumentNumber(kvp.Value)\r\n                        }\r\n                    )))\r\n                .ForMember(dest => dest.Capable, opt => opt.MapFrom(src => src.Capable != null ? new EditCapableDTO\r\n                {\r\n                    Guardian = src.Capable.Guardian != null ? src.Capable.Guardian : string.Empty,\r\n                    GuardianOrderAppointment = src.Capable.GuardianOrderAppointment != null ? src.Capable.GuardianOrderAppointment : string.Empty\r\n                } : null))\r\n                .ForMember(dest => dest.Pension, opt => opt.MapFrom(src => src.Pension != null ? new PensionDTO\r\n                {\r\n                    DisabilityGroup = src.Pension.DisabilityGroup,\r\n                    PensionStartDateTime = src.Pension.PensionStartDateTime.HasValue ? DateTime.SpecifyKind(src.Pension.PensionStartDateTime.Value, DateTimeKind.Utc) : null,\r\n                    PensionAddress = src.Pension.PensionAddress,\r\n                    SfrBranch = src.Pension.SfrBranch,\r\n                    SfrDepartment = src.Pension.SfrDepartment,\r\n                    Rsd = src.Pension.Rsd\r\n                } : null))\r\n                .ForMember(dest => dest.Note, opt => opt.MapFrom(src => src.Note));\r\n\r\n            CreateMap<Patient, CreatePatientDTO>()\r\n                .ForMember(dest => dest.FullName, opt => opt.MapFrom(src => src.FullName))\r\n                .ForMember(dest => dest.Birthday, opt => opt.MapFrom(src => \r\n                    DateTime.SpecifyKind(src.Birthday, DateTimeKind.Utc)))\r\n                .ForMember(dest => dest.MedicalHistory, opt => opt.MapFrom(src => new MedicalHistoryDTO\r\n                {\r\n                    NumberDepartment = (sbyte)(src.ActiveHistory != null ? src.ActiveHistory.NumberDepartment : 0),\r\n                    HospitalizationType = new HospitalizationTypeDTO\r\n                    {\r\n                        Value = (byte)(src.ActiveHistory != null && src.ActiveHistory.HospitalizationType != null ? src.ActiveHistory.HospitalizationType.Value : 0),\r\n                        DisplayName = src.ActiveHistory != null && src.ActiveHistory.HospitalizationType != null ? src.ActiveHistory.HospitalizationType.DisplayName : string.Empty\r\n                    },\r\n                    Resolution = src.ActiveHistory != null ? src.ActiveHistory.Resolution : string.Empty,\r\n                    NumberDocument = src.ActiveHistory != null ? src.ActiveHistory.NumberDocument : string.Empty,\r\n                    DateOfReceipt = src.ActiveHistory != null ? DateTime.SpecifyKind(src.ActiveHistory.DateOfReceipt, DateTimeKind.Utc) : DateTime.MinValue,\r\n                    DateOfDischarge = src.ActiveHistory != null && src.ActiveHistory.DateOfDischarge.HasValue ? DateTime.SpecifyKind(src.ActiveHistory.DateOfDischarge.Value, DateTimeKind.Utc) : null,\r\n                    Note = src.ActiveHistory != null ? src.ActiveHistory.Note : null\r\n                }))\r\n                .ForMember(dest => dest.CitizenshipInfo, opt => opt.MapFrom(src => new CitizenshipInfoDTO\r\n                {\r\n                    Citizenship = src.CitizenshipInfo != null ? src.CitizenshipInfo.Citizenship : CitizenshipType.RussianFederation,\r\n                    Country = src.CitizenshipInfo != null ? src.CitizenshipInfo.Country : string.Empty,\r\n                    Registration = src.CitizenshipInfo != null ? src.CitizenshipInfo.Registration : string.Empty,\r\n                    EarlyRegistration = src.CitizenshipInfo != null ? src.CitizenshipInfo.EarlyRegistration : null,\r\n                    PlaceOfBirth = src.CitizenshipInfo != null ? src.CitizenshipInfo.PlaceOfBirth : null,\r\n                    DocumentAttached = src.CitizenshipInfo != null ? src.CitizenshipInfo.DocumentAttached : null\r\n                }))\r\n                .ForMember(dest => dest.Documents, opt => opt.MapFrom(src => \r\n                    src.Documents.ToDictionary(\r\n                        kvp => kvp.Key,\r\n                        kvp => new DocumentDTO\r\n                        {\r\n                            Type = kvp.Key,\r\n                            Number = ExtractDocumentNumber(kvp.Value)\r\n                        }\r\n                    )))\r\n                .ForMember(dest => dest.IsCapable, opt => opt.MapFrom(src => src.IsCapable))\r\n                .ForMember(dest => dest.Capable, opt => opt.MapFrom(src => src.Capable != null ? new CreateCapableDTO\r\n                {\r\n                    CourtDecision = src.Capable.CourtDecision != null ? src.Capable.CourtDecision : string.Empty,\r\n                    TrialDate = src.Capable.TrialDate.HasValue ? DateTime.SpecifyKind(src.Capable.TrialDate.Value, DateTimeKind.Utc) : null,\r\n                    Guardian = src.Capable.Guardian != null ? src.Capable.Guardian : string.Empty,\r\n                    GuardianOrderAppointment = src.Capable.GuardianOrderAppointment != null ? src.Capable.GuardianOrderAppointment : string.Empty\r\n                } : null))\r\n                .ForMember(dest => dest.ReceivesPension, opt => opt.MapFrom(src => src.ReceivesPension))\r\n                .ForMember(dest => dest.Pension, opt => opt.MapFrom(src => src.Pension != null ? new PensionDTO\r\n                {\r\n                    DisabilityGroup = src.Pension.DisabilityGroup,\r\n                    PensionStartDateTime = src.Pension.PensionStartDateTime.HasValue ? DateTime.SpecifyKind(src.Pension.PensionStartDateTime.Value, DateTimeKind.Utc) : null,\r\n                    PensionAddress = src.Pension.PensionAddress,\r\n                    SfrBranch = src.Pension.SfrBranch,\r\n                    SfrDepartment = src.Pension.SfrDepartment,\r\n                    Rsd = src.Pension.Rsd\r\n                } : null))\r\n                .ForMember(dest => dest.Note, opt => opt.MapFrom(src => src.Note));\r\n\r\n            //–ü–æ –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º, –ø—Ä–æ—Ü–µ—Å—Å –º–∞–ø–ø–∏–Ω–≥–∞ –∏–∑ DTO -> Entity, –¥–æ–ª–∂–µ–Ω –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å—Å—è –≤ —Ä—É—á–Ω—É—é.\r\n            //CreateMap<EditPatientDTO, Patient>()\r\n            //.ForMember(dest => dest.Documents, opt => opt.MapFrom(src => \r\n            //    src.Documents.ToDictionary(\r\n            //        kvp => kvp.Key,\r\n            //        kvp => DocumentFactory.Create(\r\n            //            kvp.Value.Type,\r\n            //            kvp.Value.Number\r\n            //        )\r\n            //    )));\r\n\r\n            CreateMap<EditPatientViewModel, EditPatientDTO>();\r\n            CreateMap<CreateUserViewModel, CreateUserDTO>();\r\n            CreateMap<ApplicationUser, UserDTO>();\r\n\r\n            // –ú–∞–ø–ø–∏–Ω–≥ DTO –≤ ViewModels —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –¥–∞—Ç\r\n            CreateMap<CreatePatientDTO, CreatePatientViewModel>()\r\n                .ForMember(dest => dest.Birthday, opt => opt.MapFrom(src => \r\n                    DateTime.SpecifyKind(src.Birthday, DateTimeKind.Utc)));\r\n\r\n            CreateMap<EditPatientDTO, EditPatientViewModel>();\r\n                //.ForMember(dest => dest.Birthday, opt => opt.MapFrom(src => \r\n                //    DateTime.SpecifyKind(src.Birthday, DateTimeKind.Utc)));\r\n\r\n            // ‚ùó –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ï –ú–ê–ü–ü–ò–ù–ì–ò –î–õ–Ø ViewModel -> DTO ‚ùó //\r\n            \r\n            // MedicalHistory (ViewModel) -> MedicalHistoryDTO\r\n            CreateMap<MedicalHistoryModel, MedicalHistoryDTO>()\r\n                .ForMember(dest => dest.DateOfReceipt, opt => opt.MapFrom(src => \r\n                    DateTime.SpecifyKind(src.DateOfReceipt, DateTimeKind.Utc)))\r\n                .ForMember(dest => dest.DateOfDischarge, opt => opt.MapFrom(src => \r\n                    src.DateOfDischarge.HasValue ? DateTime.SpecifyKind(src.DateOfDischarge.Value, DateTimeKind.Utc) : (DateTime?)null))\r\n                .ForMember(dest => dest.HospitalizationType, opt => opt.MapFrom(src => \r\n                    src.HospitalizationType != null \r\n                        ? new HospitalizationTypeDTO\r\n                        {\r\n                            Value = src.HospitalizationType.Value,\r\n                            DisplayName = src.HospitalizationType.DisplayName\r\n                        }\r\n                        : new HospitalizationTypeDTO  // –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\r\n                        {\r\n                            Value = 1,  // Force\r\n                            DisplayName = \"–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ\"\r\n                        }));\r\n\r\n            // CitizenshipInfo (ViewModel) -> CitizenshipInfoDTO\r\n            CreateMap<CitizenshipInfoModel, CitizenshipInfoDTO>()\r\n                .ForMember(dest => dest.Citizenship, opt => opt.MapFrom(src => \r\n                    src.Citizenship != null ? src.Citizenship : CitizenshipType.RussianFederation)) // –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\r\n                .ForMember(dest => dest.Country, opt => opt.MapFrom(src => src.Country))\r\n                .ForMember(dest => dest.Registration, opt => opt.MapFrom(src => src.Registration))\r\n                .ForMember(dest => dest.EarlyRegistration, opt => opt.MapFrom(src => src.EarlyRegistration))\r\n                .ForMember(dest => dest.PlaceOfBirth, opt => opt.MapFrom(src => src.PlaceOfBirth))\r\n                .ForMember(dest => dest.DocumentAttached, opt => opt.MapFrom(src => src.DocumentAttached));\r\n\r\n            // Capable (ViewModel) -> CreateCapableDTO/EditCapableDTO\r\n            CreateMap<CapableModel, CreateCapableDTO>()\r\n                .ForMember(dest => dest.TrialDate, opt => opt.MapFrom(src => \r\n                    src.TrialDate.HasValue ? DateTime.SpecifyKind(src.TrialDate.Value, DateTimeKind.Utc) : (DateTime?)null));\r\n            CreateMap<CapableModel, EditCapableDTO>()\r\n                .ForMember(dest => dest.TrialDate, opt => opt.MapFrom(src => \r\n                    src.TrialDate.HasValue ? DateTime.SpecifyKind(src.TrialDate.Value, DateTimeKind.Utc) : (DateTime?)null));\r\n\r\n            // Pension (ViewModel) -> PensionDTO\r\n            CreateMap<PensionModel, PensionDTO>()\r\n                .ForMember(dest => dest.PensionStartDateTime, opt => opt.MapFrom(src => \r\n                    src.PensionStartDateTime.HasValue ? DateTime.SpecifyKind(src.PensionStartDateTime.Value, DateTimeKind.Utc) : (DateTime?)null));\r\n\r\n            // HospitalizationType //////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<byte, HospitalizationType>().ConvertUsing(value => HospitalizationType.FromValue(value));\r\n            CreateMap<HospitalizationType, byte>().ConvertUsing(hospitalizationType => hospitalizationType.Value);\r\n\r\n            // CitizenshipInfo ///////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<CitizenshipInfoDTO, CitizenshipInfo>().ReverseMap();\r\n\r\n            // CitizenshipType ///////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<byte, CitizenshipType>().ConvertUsing(value => CitizenshipType.FromValue(value));\r\n            CreateMap<CitizenshipType, byte>().ConvertUsing(citizenshipType => citizenshipType.Value);\r\n\r\n            // Capable //////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<CreateCapableDTO, Capable>()\r\n                .ConstructUsing(src => new Capable(\r\n                    src.CourtDecision,\r\n                    src.TrialDate.HasValue ? DateTime.SpecifyKind(src.TrialDate.Value, DateTimeKind.Utc) : null,\r\n                    src.Guardian,\r\n                    src.GuardianOrderAppointment));\r\n\r\n            CreateMap<EditCapableDTO, Capable>()\r\n                .ForMember(dest => dest.CourtDecision, opt => opt.Ignore())\r\n                .ForMember(dest => dest.TrialDate, opt => opt.Ignore())\r\n                .ConstructUsing((src, ctx) =>\r\n                {\r\n                    var existingCapable = ctx.Items[\"ExistingCapable\"] as Capable;\r\n                    return new Capable(\r\n                        existingCapable!.CourtDecision,\r\n                        existingCapable!.TrialDate.HasValue ? DateTime.SpecifyKind(existingCapable.TrialDate.Value, DateTimeKind.Utc) : null,\r\n                        src.Guardian,\r\n                        src.GuardianOrderAppointment);\r\n                });\r\n\r\n            // City //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<byte, CityType>().ConvertUsing(value => CityType.FromValue(value));\r\n            CreateMap<CityType, byte>().ConvertUsing(city => city.Value);\r\n\r\n            // DisabilityGroup ///////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<byte, DisabilityGroupType>().ConvertUsing(value => DisabilityGroupType.FromValue(value));\r\n            CreateMap<DisabilityGroupType, byte>().ConvertUsing(disabilityGroup => disabilityGroup.Value);\r\n\r\n            // Pension ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<PensionDTO, Pension>()\r\n                .ForMember(dest => dest.PensionStartDateTime, opt => opt.MapFrom(src => \r\n                    src.PensionStartDateTime.HasValue ? DateTime.SpecifyKind(src.PensionStartDateTime.Value, DateTimeKind.Utc) : (DateTime?)null));\r\n\r\n            // PensionAddress ////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<byte, PensionAddressType>().ConvertUsing(value => PensionAddressType.FromValue(value));\r\n            CreateMap<PensionAddressType, byte>().ConvertUsing(pensionAddress => pensionAddress.Value);\r\n\r\n            // Assignment ////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<Assignment, EditPatientDTO>();\r\n\r\n            CreateMap<Patient, ActivePatientDTO>()\r\n                .ForMember(dest => dest.HospitalizationType, opt => opt.MapFrom(src =>\r\n                    src.ActiveHistory != null && src.ActiveHistory.HospitalizationType != null\r\n                        ? src.ActiveHistory.HospitalizationType.DisplayName\r\n                        : \"‚Äî\"))\r\n                .ForMember(dest => dest.CourtDecision, opt => opt.MapFrom(src =>\r\n                    src.Capable != null && !string.IsNullOrEmpty(src.Capable.CourtDecision)\r\n                        ? src.Capable.CourtDecision\r\n                        : \"‚Äî\"))\r\n                .ForMember(dest => dest.NumberDocument, opt => opt.MapFrom(src =>\r\n                    src.ActiveHistory != null && !string.IsNullOrEmpty(src.ActiveHistory.NumberDocument)\r\n                        ? src.ActiveHistory.NumberDocument\r\n                        : \"‚Äî\"))\r\n                .ForMember(dest => dest.DateOfReceipt, opt => opt.MapFrom(src =>\r\n                    src.ActiveHistory != null ? DateTime.SpecifyKind(src.ActiveHistory.DateOfReceipt, DateTimeKind.Utc) : DateTime.MinValue))\r\n                .ForMember(dest => dest.Department, opt => opt.MapFrom(src =>\r\n                    src.ActiveHistory != null && src.ActiveHistory.NumberDepartment.HasValue\r\n                        ? src.ActiveHistory.NumberDepartment.Value.ToString()\r\n                        : \"‚Äî\"))\r\n                .ForMember(dest => dest.IsChildren, opt => opt.MapFrom(src => src.IsChildren))\r\n                .ForMember(dest => dest.Citizenship, opt => opt.MapFrom(src =>\r\n                    src.CitizenshipInfo != null && src.CitizenshipInfo.Citizenship != null\r\n                        ? src.CitizenshipInfo.Citizenship.DisplayName\r\n                        : \"‚Äî\"))\r\n                .ForMember(dest => dest.Country, opt => opt.MapFrom(src =>\r\n                    src.CitizenshipInfo != null && !string.IsNullOrEmpty(src.CitizenshipInfo.Country)\r\n                        ? src.CitizenshipInfo.Country\r\n                        : \"‚Äî\"))\r\n                .ForMember(dest => dest.Registration, opt => opt.MapFrom(src =>\r\n                    src.CitizenshipInfo != null && !string.IsNullOrEmpty(src.CitizenshipInfo.Registration)\r\n                        ? src.CitizenshipInfo.Registration\r\n                        : \"‚Äî\"))\r\n                .ForMember(dest => dest.IsHomeless, opt => opt.MapFrom(src =>\r\n                    src.CitizenshipInfo != null && src.CitizenshipInfo.NotRegistered\r\n                        ? true\r\n                        : false))\r\n                .ForMember(dest => dest.EarlyRegistration, opt => opt.MapFrom(src =>\r\n                    src.CitizenshipInfo != null && src.CitizenshipInfo.EarlyRegistration != null\r\n                        ? src.CitizenshipInfo.EarlyRegistration.DisplayName\r\n                        : \"‚Äî\"))\r\n                .ForMember(dest => dest.PlaceOfBirth, opt => opt.MapFrom(src =>\r\n                    src.CitizenshipInfo != null && !string.IsNullOrEmpty(src.CitizenshipInfo.PlaceOfBirth)\r\n                        ? src.CitizenshipInfo.PlaceOfBirth\r\n                        : \"‚Äî\"))\r\n                .ForMember(dest => dest.IsCapable, opt => opt.MapFrom(src => src.IsCapable))\r\n                .ForMember(dest => dest.ReceivesPension, opt => opt.MapFrom(src => src.ReceivesPension))\r\n                .ForMember(dest => dest.DisabilityGroup, opt => opt.MapFrom(src =>\r\n                    src.Pension != null && src.Pension.DisabilityGroup != null && src.Pension.DisabilityGroup.Value > 0\r\n                        ? src.Pension.DisabilityGroup.Value.ToString()\r\n                        : \"‚Äî\"))\r\n                .ForMember(dest => dest.Note, opt => opt.MapFrom(src =>\r\n                    !string.IsNullOrEmpty(src.Note)\r\n                        ? src.Note\r\n                        : \"‚Äî\"));\r\n        }\r\n\r\n        /// <summary>\r\n        /// –ò–∑–≤–ª–µ–∫–∞–µ—Ç –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏–∑ object –≤ Dictionary\r\n        /// </summary>\r\n        /// <param name=\"document\">–î–æ–∫—É–º–µ–Ω—Ç –∫–∞–∫ object</param>\r\n        /// <returns>–ù–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞</returns>\r\n        private static string ExtractDocumentNumber(object document)\r\n        {\r\n            if (document == null) return string.Empty;\r\n            \r\n            if (document is PassportDocument passport)\r\n                return passport.Number != null ? passport.Number : string.Empty;\r\n            if (document is MedicalPolicyDocument policy)\r\n                return policy.Number != null ? policy.Number : string.Empty;\r\n            if (document is SnilsDocument snils)\r\n                return snils.Number != null ? snils.Number : string.Empty;\r\n            \r\n            return string.Empty;\r\n        }\r\n\r\n        /// <summary>\r\n        /// –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –µ–≥–æ —Ç–∏–ø–∞\r\n        /// </summary>\r\n        /// <param name=\"documentType\">–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞</param>\r\n        /// <param name=\"number\">–ù–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</param>\r\n        /// <returns>–û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ</returns>\r\n        private static string FormatDocumentNumber(DocumentType documentType, string? number)\r\n        {\r\n            if (string.IsNullOrEmpty(number))\r\n                return string.Empty;\r\n\r\n            return documentType switch\r\n            {\r\n                var dt when dt == DocumentType.Passport => number,\r\n                var dt when dt == DocumentType.MedicalPolicy => number.Replace(\" \", \"\"),\r\n                var dt when dt == DocumentType.Snils => number,\r\n                _ => number\r\n            };\r\n        }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/MappingProfile/ProjectMappingProfile.cs b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/MappingProfile/ProjectMappingProfile.cs
--- a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/MappingProfile/ProjectMappingProfile.cs	(revision d026a00c98f869bf4ad419ed96c9d8f1e1cd9520)
+++ b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/MappingProfile/ProjectMappingProfile.cs	(date 1756839163658)
@@ -5,6 +5,7 @@
 using CRM.SocialDepartment.Domain.Entities.Patients.Documents;
 using CRM.SocialDepartment.Infrastructure.DataAccess.MongoDb.Data;
 using CRM.SocialDepartment.Site.Models.Patient;
+using CRM.SocialDepartment.Site.ViewModels.Assignment;
 using CRM.SocialDepartment.Site.ViewModels.Patient;
 using CRM.SocialDepartment.Site.ViewModels.User;
 
@@ -278,6 +279,7 @@
 
             // Assignment ////////////////////////////////////////////////////////////////////////////////////////////////////////////////
             CreateMap<Assignment, EditPatientDTO>();
+            CreateMap<CreateAssignmentViewModel, CreateOrEditAssignmentDto>();
 
             CreateMap<Patient, ActivePatientDTO>()
                 .ForMember(dest => dest.HospitalizationType, opt => opt.MapFrom(src =>
