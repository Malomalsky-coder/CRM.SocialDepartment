Index: src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/ViewModels/Assignment/EditAssignmentViewModel.Validation.cs
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/ViewModels/Assignment/EditAssignmentViewModel.Validation.cs b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/ViewModels/Assignment/EditAssignmentViewModel.Validation.cs
new file mode 100644
--- /dev/null	(date 1756983949502)
+++ b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/ViewModels/Assignment/EditAssignmentViewModel.Validation.cs	(date 1756983949502)
@@ -0,0 +1,26 @@
+using System.ComponentModel.DataAnnotations;
+
+namespace CRM.SocialDepartment.Site.ViewModels.Assignment
+{
+    public partial class EditAssignmentViewModel : IValidatableObject
+    {
+        public IEnumerable<ValidationResult> Validate(ValidationContext validationContext)
+        {
+            var resultList = new List<ValidationResult>();
+
+            if (string.IsNullOrEmpty(Name))
+                resultList.Add(new("–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º", new[] { nameof(Name) }));
+
+            if (string.IsNullOrEmpty(Description))
+                resultList.Add(new("–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º", new[] { nameof(Description) }));
+
+            if (string.IsNullOrEmpty(Assignee))
+                resultList.Add(new("–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å", new[] { nameof(Assignee) }));
+
+            if (PatientId == Guid.Empty)
+                resultList.Add(new("–ü–∞—Ü–∏–µ–Ω—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω", new[] { nameof(PatientId) }));
+
+            return resultList;
+        }
+    }
+}
Index: src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/Controllers/AssignmentController.cs
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>using System.ComponentModel.DataAnnotations;\r\nusing AutoMapper;\r\nusing CRM.SocialDepartment.Application.Assignments;\r\nusing CRM.SocialDepartment.Application.DTOs;\r\nusing CRM.SocialDepartment.Domain.Common;\r\nusing CRM.SocialDepartment.Site.Models;\r\nusing CRM.SocialDepartment.Site.Services;\r\nusing CRM.SocialDepartment.Site.ViewModels.Assignment;\r\nusing Microsoft.AspNetCore.Mvc;\r\n\r\nnamespace CRM.SocialDepartment.Site.Controllers;\r\n\r\npublic class AssignmentController(\r\n    AssignmentService assignmentService,\r\n    ILogger<AssignmentController> logger,\r\n    IMapper mapper)\r\n    : Controller\r\n{\r\n    [HttpGet]\r\n    [Route(\"assignments\")]\r\n    public IActionResult Index()\r\n    {\r\n        return View(\"~/Views/Assignment/Index.cshtml\");\r\n    }\r\n\r\n    [HttpGet]\r\n    [Route(\"assignments/archive\")]\r\n    public IActionResult Archive()\r\n    {\r\n        return View(\"~/Views/Assignment/Archive.cshtml\");\r\n    }\r\n\r\n    [HttpGet]\r\n    [Route(\"[controller]/modal/create\")]\r\n    public IActionResult CreateModal([FromQuery] Guid? patientId = null)\r\n    {\r\n        ViewData.Model = new CreateAssignmentViewModel()\r\n        {\r\n            Name = \"–ù–∞–∑–≤–∞–Ω–∏–µ\",\r\n            AcceptDate = DateTime.UtcNow,\r\n            Description = \"–û–ø–∏—Å–∞–Ω–∏–µ\",\r\n            Assignee = \"–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å\",\r\n            PatientId = patientId ?? Guid.Empty\r\n        };\r\n\r\n        return new PartialViewResult\r\n        {\r\n            ViewName = \"~/Views/Assignment/_CreateAssignmentModal.cshtml\",\r\n            ViewData = ViewData\r\n        };\r\n    }\r\n\r\n    [HttpGet]\r\n    [Route(\"[controller]/modal/edit\")]\r\n    public async Task<IActionResult> EditModal([FromQuery] Guid id, CancellationToken cancellationToken)\r\n    {\r\n        var dto = await assignmentService.GetAssignmentByIdAsync(id, cancellationToken);\r\n        if (dto == null)\r\n            return NotFound();\r\n\r\n        ViewData.Model = new EditAssignmentViewModel\r\n        {\r\n            Id = dto.Id,\r\n            Name = dto.Name,\r\n            Description = dto.Description,\r\n            CreatedDate = dto.CreationDate,\r\n            ForwardDepartment = dto.ForwardDepartment,\r\n            Assignee = dto.Assignee,\r\n            AcceptDate = dto.AcceptDate,\r\n            ForwardDate = dto.ForwardDate,\r\n            DepartmentNumber = dto.DepartmentNumber,\r\n            DepartmentForwardDate = dto.DepartmentForwardDate,\r\n            Note = dto.Note,\r\n            PatientId = dto.PatientId\r\n        };\r\n\r\n        return new PartialViewResult\r\n        {\r\n            ViewName = \"~/Views/Assignment/_EditAssignmentModal.cshtml\",\r\n            ViewData = ViewData\r\n        };\r\n    }\r\n\r\n    [HttpPost]\r\n    [Route(\"api/assignments/active\")]\r\n    public async Task<JsonResult> GetActiveForDataTableAsync([FromServices] DataTableNetService dataTableNetService,\r\n        CancellationToken cancellationToken = default)\r\n    {\r\n        var input = dataTableNetService.Parse(Request);\r\n\r\n        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –¥–æ–º–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã\r\n        var parameters = new DataTableParameters\r\n        {\r\n            Skip = input.Skip,\r\n            PageSize = input.PageSize,\r\n            SearchTerm = input.SearchTerm,\r\n        };\r\n\r\n        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–æ–º–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è\r\n        var result = await assignmentService.GetActiveAssignmentsForDataTableAsync(parameters, cancellationToken);\r\n\r\n        // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (–ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –ø–æ–ª–µ–π, –æ–∂–∏–¥–∞–µ–º—ã—Ö —Ç–∞–±–ª–∏—Ü–µ–π)\r\n        var dataResult = result.Data.Select(x => new\r\n            {\r\n                id = x.Id,\r\n                acceptDate = x.AcceptDate,\r\n                departmentNumber = x.DepartmentNumber,\r\n                description = x.Description,\r\n                forwardDate = x.ForwardDate,\r\n                forwardDepartment = x.ForwardDepartment,\r\n                name = x.Name,\r\n                departmentForwardDate = x.DepartmentForwardDate,\r\n                assignee = x.Assignee,\r\n                note = x.Note,\r\n                createdDate = x.CreationDate,\r\n                patient = x.PatientId\r\n            }\r\n        );\r\n\r\n        return new JsonResult(new\r\n        {\r\n            draw = input.Draw,\r\n            recordsTotal = result.TotalRecords,\r\n            recordsFiltered = result.FilteredRecords,\r\n            data = dataResult\r\n        });\r\n    }\r\n\r\n    [HttpPost]\r\n    [Route(\"api/assignments/archive\")]\r\n    public async Task<JsonResult> GetArchivedForDataTableAsync([FromServices] DataTableNetService dataTableNetService,\r\n        CancellationToken cancellationToken = default)\r\n    {\r\n        var input = dataTableNetService.Parse(Request);\r\n\r\n        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –¥–æ–º–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã\r\n        var parameters = new DataTableParameters\r\n        {\r\n            Skip = input.Skip,\r\n            PageSize = input.PageSize,\r\n            SearchTerm = input.SearchTerm,\r\n        };\r\n\r\n        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–æ–º–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è\r\n        var result = await assignmentService.GetActiveAssignmentsForDataTableAsync(parameters, cancellationToken);\r\n\r\n        // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (–ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –ø–æ–ª–µ–π, –æ–∂–∏–¥–∞–µ–º—ã—Ö —Ç–∞–±–ª–∏—Ü–µ–π)\r\n        var dataResult = result.Data.Where(x => x.IsArchive).Select(x => new\r\n            {\r\n                id = x.Id,\r\n                acceptDate = x.AcceptDate,\r\n                departmentNumber = x.DepartmentNumber,\r\n                description = x.Description,\r\n                forwardDate = x.ForwardDate,\r\n                forwardDepartment = x.ForwardDepartment,\r\n                name = x.Name,\r\n                departmentForwardDate = x.DepartmentForwardDate,\r\n                assignee = x.Assignee,\r\n                note = x.Note,\r\n                createdDate = x.CreationDate,\r\n                patient = x.PatientId\r\n            }\r\n        );\r\n\r\n        return new JsonResult(new\r\n        {\r\n            draw = input.Draw,\r\n            recordsTotal = result.TotalRecords,\r\n            recordsFiltered = result.FilteredRecords,\r\n            data = dataResult\r\n        });\r\n    }\r\n\r\n    [HttpPost]\r\n    [Route(\"api/assignments\")]\r\n    [ValidateAntiForgeryToken]\r\n    public async Task<JsonResult> CreateAsync(CreateAssignmentViewModel input, CancellationToken cancellationToken)\r\n    {\r\n        var modelStateErrorsToRemove = ModelState.Select(modelError => modelError.Key).Where(fieldName =>\r\n                fieldName.StartsWith(\"Name.\") || fieldName.StartsWith(\"Description.\") ||\r\n                fieldName.StartsWith(\"Assignee.\") || fieldName.StartsWith(\"DepartmentNumber.\") ||\r\n                fieldName.StartsWith(\"Note\"))\r\n            .ToList();\r\n\r\n        foreach (var fieldName in modelStateErrorsToRemove)\r\n        {\r\n            ModelState.Remove(fieldName);\r\n        }\r\n\r\n        // –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ —Ä—É—á–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é\r\n        var validationResults = new List<ValidationResult>();\r\n        var validationContext = new ValidationContext(input);\r\n\r\n        // –í—ã–∑—ã–≤–∞–µ–º —Ä—É—á–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é\r\n        var manualValidationResults = input.Validate(validationContext);\r\n        validationResults.AddRange(manualValidationResults);\r\n\r\n        if (!ModelState.IsValid)\r\n        {\r\n            foreach (var modelError in ModelState)\r\n            {\r\n                foreach (var error in modelError.Value.Errors)\r\n                {\r\n                    var fieldName = modelError.Key;\r\n                    var errorMessage = error.ErrorMessage;\r\n\r\n                    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ –ø–æ–ª—è\r\n                    if (fieldName == \"Name\")\r\n                    {\r\n                        validationResults.Add(new ValidationResult(errorMessage, [fieldName]));\r\n                    }\r\n                    // –£–ª—É—á—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π\r\n                    else if (errorMessage == \"The value '' is invalid.\")\r\n                    {\r\n                        var improvedMessage = GetDetailedErrorMessage(fieldName);\r\n                        validationResults.Add(new ValidationResult(improvedMessage, [fieldName]));\r\n                    }\r\n                    else if (string.IsNullOrEmpty(errorMessage))\r\n                    {\r\n                        var improvedMessage = $\"–û—à–∏–±–∫–∞ –≤ –ø–æ–ª–µ '{fieldName}' (–±–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏—è)\";\r\n                        validationResults.Add(new ValidationResult(improvedMessage, [fieldName]));\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (validationResults.Count != 0)\r\n        {\r\n            var errors = validationResults.Select(vr => vr.ErrorMessage).ToList();\r\n\r\n            logger.LogWarning(\"‚ùå [AssignmentController] –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏: {Errors}\",\r\n                string.Join(\", \", errors));\r\n            return new JsonResult(ApiResponse<object>.Error(\"–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\", new\r\n            {\r\n                Errors = errors\r\n            }))\r\n            {\r\n                StatusCode = StatusCodes.Status400BadRequest\r\n            };\r\n        }\r\n\r\n        try\r\n        {\r\n            var dto = mapper.Map<CreateOrEditAssignmentDto>(input);\r\n\r\n            logger.LogInformation(\"\uD83D\uDCBE [AssignmentController] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö\");\r\n            var result = await assignmentService.CreateAssignmentAsync(dto, cancellationToken);\r\n\r\n            logger.LogInformation(\"‚úÖ [AssignmentController] –ó–∞–¥–∞—á–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞ —Å ID: {AssignmentId}\", result);\r\n            return new JsonResult(ApiResponse<Guid>.Ok(result));\r\n        }\r\n        catch (Exception ex)\r\n        {\r\n            logger.LogError(ex, \"\uD83D\uDEA8 [AssignmentController] –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏\");\r\n            throw;\r\n        }\r\n    }\r\n\r\n    private static string GetDetailedErrorMessage(string fieldName)\r\n    {\r\n        return fieldName switch\r\n        {\r\n            \"Name\" => \"–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –ø—É—Å—Ç–æ–µ –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ\",\r\n            \"Description\" => \"–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –ø—É—Å—Ç–æ–µ –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ\",\r\n            \"Assignee\" => \"–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω\",\r\n            \"DepartmentNumber\" => \"–ù–æ–º–µ—Ä –æ—Ç–¥–µ–ª–∞ –Ω–µ –≤–≤–µ–¥—ë–Ω\",\r\n            _ => $\"–í–≤–µ–¥–µ–Ω–æ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø–æ–ª–µ '{fieldName}'\"\r\n        };\r\n    }\r\n\r\n    [HttpDelete]\r\n    [Route(\"api/assignments/{id:guid}\")]\r\n    public async Task<JsonResult> DeleteAsync([FromRoute] Guid id, CancellationToken cancellationToken)\r\n    {\r\n        if (id == Guid.Empty)\r\n        {\r\n            HttpContext.Response.StatusCode = StatusCodes.Status400BadRequest;\r\n            return new JsonResult(new { error = \"Invalid id\" });\r\n        }\r\n\r\n        await assignmentService.DeleteAssignmentAsync(id, cancellationToken);\r\n        HttpContext.Response.StatusCode = StatusCodes.Status204NoContent;\r\n        return new JsonResult(new { });\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/Controllers/AssignmentController.cs b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/Controllers/AssignmentController.cs
--- a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/Controllers/AssignmentController.cs	(revision 1f8fee95001fe8134ec947ef163da438a8a34e5a)
+++ b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/Controllers/AssignmentController.cs	(date 1756984378961)
@@ -1,10 +1,11 @@
 using System.ComponentModel.DataAnnotations;
+using System.Linq;
 using AutoMapper;
 using CRM.SocialDepartment.Application.Assignments;
 using CRM.SocialDepartment.Application.DTOs;
 using CRM.SocialDepartment.Domain.Common;
 using CRM.SocialDepartment.Site.Models;
-using CRM.SocialDepartment.Site.Services;
+                    using CRM.SocialDepartment.Site.Services;
 using CRM.SocialDepartment.Site.ViewModels.Assignment;
 using Microsoft.AspNetCore.Mvc;
 
@@ -268,6 +269,85 @@
         };
     }
 
+    [HttpPatch]
+    [Route("api/assignments/{id:guid}")]
+    [ValidateAntiForgeryToken]
+    public async Task<JsonResult> UpdateAsync([FromRoute] Guid id, EditAssignmentViewModel input, CancellationToken cancellationToken)
+    {
+        if (id == Guid.Empty)
+        {
+            HttpContext.Response.StatusCode = StatusCodes.Status400BadRequest;
+            return new JsonResult(new { error = "Invalid id" });
+        }
+
+        // –†—É—á–Ω–∞—è , –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è Create
+        var validationResults = new List<ValidationResult>();
+        var validationContext = new ValidationContext(input);
+        var manualValidationResults = input.Validate(validationContext);
+        validationResults.AddRange(manualValidationResults);
+
+        if (!ModelState.IsValid)
+        {
+            foreach (var modelError in ModelState)
+            {
+                foreach (var error in modelError.Value.Errors)
+                {
+                    var fieldName = modelError.Key;
+                    var errorMessage = error.ErrorMessage;
+
+                    if (!string.IsNullOrWhiteSpace(errorMessage))
+                        validationResults.Add(new ValidationResult(errorMessage, [fieldName]));
+                    else
+                        validationResults.Add(new ValidationResult(GetDetailedErrorMessage(fieldName), [fieldName]));
+                }
+            }
+        }
+
+        if (validationResults.Count != 0)
+        {
+            var errors = validationResults.Select(vr => vr.ErrorMessage).ToList();
+            logger.LogWarning("‚ùå [AssignmentController] –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (update): {Errors}",
+                string.Join(", ", errors));
+
+            return new JsonResult(ApiResponse<object>.Error("–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ", new
+            {
+                Errors = errors
+            }))
+            {
+                StatusCode = StatusCodes.Status400BadRequest
+            };
+        }
+
+        try
+        {
+            var current = await assignmentService.GetAssignmentByIdAsync(id, cancellationToken);
+            if (current == null)
+            {
+                HttpContext.Response.StatusCode = StatusCodes.Status404NotFound;
+                return new JsonResult(new { error = "Not found" });
+            }
+
+            var dto = mapper.Map<CreateOrEditAssignmentDto>(input);
+
+            var statusLog = current.StatusLog != null
+                ? new Dictionary<string, string>(current.StatusLog)
+                : new Dictionary<string, string>();
+
+            statusLog[DateTime.UtcNow.ToString("s")] = "–æ–±–Ω–æ–≤–ª–µ–Ω–æ";
+
+            logger.LogInformation("üíæ [AssignmentController] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ {AssignmentId}", id);
+            await assignmentService.EditAssignmentAsync(id, dto, cancellationToken);
+
+            logger.LogInformation("‚úÖ [AssignmentController] –ó–∞–¥–∞—á–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞: {AssignmentId}", id);
+            return new JsonResult(ApiResponse<object>.Ok(null));
+        }
+        catch (Exception ex)
+        {
+            logger.LogError(ex, "üö® [AssignmentController] –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏");
+            throw;
+        }
+    }
+
     [HttpDelete]
     [Route("api/assignments/{id:guid}")]
     public async Task<JsonResult> DeleteAsync([FromRoute] Guid id, CancellationToken cancellationToken)
@@ -275,11 +355,75 @@
         if (id == Guid.Empty)
         {
             HttpContext.Response.StatusCode = StatusCodes.Status400BadRequest;
-            return new JsonResult(new { error = "Invalid id" });
+            return new JsonResult(ApiResponse<object>.Error("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä", new { id }));
         }
 
-        await assignmentService.DeleteAssignmentAsync(id, cancellationToken);
-        HttpContext.Response.StatusCode = StatusCodes.Status204NoContent;
-        return new JsonResult(new { });
+        try
+        {
+            await assignmentService.DeleteAssignmentAsync(id, cancellationToken);
+            HttpContext.Response.StatusCode = StatusCodes.Status204NoContent;
+            return new JsonResult(new { });
+        }
+        catch (KeyNotFoundException ex)
+        {
+            logger.LogWarning(ex, "–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å: –∑–∞–¥–∞–Ω–∏–µ {AssignmentId} –Ω–µ –Ω–∞–π–¥–µ–Ω–æ", id);
+            HttpContext.Response.StatusCode = StatusCodes.Status404NotFound;
+            return new JsonResult(ApiResponse<object>.Error("–ó–∞–¥–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ", new { id }));
+        }
+        catch (NullReferenceException ex)
+        {
+            // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º —Å–±–æ–π –¥–æ–º–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ SoftDelete/DomainEvent)
+            logger.LogError(ex, "–û—à–∏–±–∫–∞ –¥–æ–º–µ–Ω–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è {AssignmentId}", id);
+
+            try
+            {
+                // –û–±—Ö–æ–¥–Ω–æ–π –ø—É—Ç—å: –ø–µ—Ä–µ–Ω–æ—Å–∏–º –∑–∞–ø–∏—Å—å –≤ –∞—Ä—Ö–∏–≤ –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è
+                var current = await assignmentService.GetAssignmentByIdAsync(id, cancellationToken);
+                if (current is null)
+                {
+                    HttpContext.Response.StatusCode = StatusCodes.Status404NotFound;
+                    return new JsonResult(ApiResponse<object>.Error("–ó–∞–¥–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ", new { id }));
+                }
+
+                var fallbackDto = new CreateOrEditAssignmentDto
+                {
+                    Name = current.Name,
+                    Description = current.Description,
+                    AcceptDate = current.AcceptDate,
+                    ForwardDate = current.ForwardDate,
+                    ForwardDepartment = current.ForwardDepartment,
+                    DepartmentForwardDate = current.DepartmentForwardDate,
+                    DepartmentNumber = current.DepartmentNumber,
+                    Assignee = current.Assignee,
+                    PatientId = current.PatientId,
+                    Note = current.Note,
+                };
+
+                // –î–æ–±–∞–≤–∏–º –∑–∞–ø–∏—Å—å –≤ —Å—Ç–∞—Ç—É—Å‚Äë–ª–æ–≥
+                var log = current.StatusLog != null
+                    ? new Dictionary<string, string>(current.StatusLog)
+                    : new Dictionary<string, string>();
+                log[DateTime.UtcNow.ToString("s")] = "–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–æ";
+
+                await assignmentService.EditAssignmentAsync(id, fallbackDto, cancellationToken);
+
+                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç ‚Äî –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ —Å—Ç—Ä–æ–∫–∞ —É–π–¥–µ—Ç –∏–∑ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
+                HttpContext.Response.StatusCode = StatusCodes.Status200OK;
+                return new JsonResult(ApiResponse<object>.Ok(new { archived = true }));
+            }
+            catch (Exception archiveEx)
+            {
+                // –ï—Å–ª–∏ –¥–∞–∂–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç
+                logger.LogError(archiveEx, "–ù–µ —É–¥–∞–ª–æ—Å—å –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ {AssignmentId} –ø–æ—Å–ª–µ —Å–±–æ—è —É–¥–∞–ª–µ–Ω–∏—è", id);
+                HttpContext.Response.StatusCode = StatusCodes.Status409Conflict;
+                return new JsonResult(ApiResponse<object>.Error("–£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É –ø–æ–∑–∂–µ.", new { id }));
+            }
+        }
+        catch (Exception ex)
+        {
+            logger.LogError(ex, "–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è {AssignmentId}", id);
+            HttpContext.Response.StatusCode = StatusCodes.Status500InternalServerError;
+            return new JsonResult(ApiResponse<object>.Error("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è", new { id }));
+        }
     }
 }
\ No newline at end of file
Index: src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/Views/Assignment/_CreateAssignmentModal.cshtml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>@model CRM.SocialDepartment.Site.ViewModels.Assignment.CreateAssignmentViewModel\r\n\r\n<form id=\"create-assignment-form\" method=\"post\" action=\"/api/assignments\">\r\n    @Html.AntiForgeryToken()\r\n    <div class=\"modal-body\">\r\n        <div class=\"mb-3\">\r\n            <label asp-for=\"Name\" class=\"form-label\"></label>\r\n            <input asp-for=\"Name\" class=\"form-control\" />\r\n            <span asp-validation-for=\"Name\" class=\"text-danger\"></span>\r\n        </div>\r\n        <div class=\"mb-3\">\r\n            <label asp-for=\"Description\" class=\"form-label\"></label>\r\n            <textarea asp-for=\"Description\" class=\"form-control\"></textarea>\r\n            <span asp-validation-for=\"Description\" class=\"text-danger\"></span>\r\n        </div>\r\n        <div class=\"row g-3\">\r\n            <div class=\"col\">\r\n                <label asp-for=\"Assignee\" class=\"form-label\"></label>\r\n                <select id=\"assignee-select\" class=\"form-select\" name=\"Assignee\" required>\r\n                    <option value=\"\">-- –í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è --</option>\r\n                </select>\r\n                <span asp-validation-for=\"Assignee\" class=\"text-danger\"></span>\r\n                <div id=\"assignee-help\" class=\"form-text\">–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞.</div>\r\n            </div>\r\n        </div>\r\n        <div class=\"row g-3 mt-1\">\r\n            <div class=\"col\">\r\n                <label asp-for=\"DepartmentNumber\" class=\"form-label\"></label>\r\n                <input asp-for=\"DepartmentNumber\" type=\"number\" class=\"form-control\" />\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"mb-3 mt-2\">\r\n            <label asp-for=\"PatientId\" class=\"form-label\"></label>\r\n            <select id=\"patient-select\" class=\"form-select\">\r\n                <option value=\"\">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞ --</option>\r\n            </select>\r\n            <span asp-validation-for=\"PatientId\" class=\"text-danger\"></span>\r\n        </div>\r\n\r\n        <input type=\"hidden\" asp-for=\"PatientId\" />\r\n        <input type=\"hidden\" asp-for=\"Id\" value=\"00000000-0000-0000-0000-000000000000\" />\r\n        <input type=\"hidden\" asp-for=\"AcceptDate\" value=\"@DateTime.UtcNow.ToString(\"s\")\" />\r\n        <div class=\"mb-3 mt-2\">\r\n            <label asp-for=\"Note\" class=\"form-label\"></label>\r\n            <textarea asp-for=\"Note\" class=\"form-control\"></textarea>\r\n        </div>\r\n    </div>\r\n    <div class=\"modal-footer\">\r\n        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">–û—Ç–º–µ–Ω–∞</button>\r\n        <button type=\"submit\" class=\"btn btn-primary\">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>\r\n    </div>\r\n</form>\r\n\r\n<script>\r\n(async function initPatientSelect() {\r\n    const select = document.getElementById('patient-select');\r\n    const hidden = document.querySelector('input[name=\"PatientId\"]');\r\n\r\n    async function loadPatients(preselectId) {\r\n        try {\r\n            const resp = await fetch('/api/patients', { headers: { 'X-Requested-With': 'XMLHttpRequest' } });\r\n            if (!resp.ok) return;\r\n            const patients = await resp.json();\r\n\r\n            // –û—á–∏—Å—Ç–∏–º –∏ –¥–æ–±–∞–≤–∏–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä\r\n            select.innerHTML = '<option value=\"\">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞ --</option>';\r\n\r\n            const toText = (p) => {\r\n                const fullName = p.fullName ?? p.FullName ?? '';\r\n                const birthday = p.birthday ?? p.Birthday;\r\n                if (fullName && birthday) return `${fullName} (${birthday})`;\r\n                return fullName || (p.lastName && p.firstName ? `${p.lastName} ${p.firstName}` : `–ü–∞—Ü–∏–µ–Ω—Ç`);\r\n            };\r\n\r\n            patients.forEach(p => {\r\n                const id = p.id ?? p.Id;\r\n                if (!id) return;\r\n                const opt = document.createElement('option');\r\n                opt.value = id;\r\n                opt.textContent = toText(p);\r\n                select.appendChild(opt);\r\n            });\r\n\r\n            // –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∏–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ\r\n            if (preselectId) {\r\n                const exists = Array.from(select.options).some(o => o.value === preselectId);\r\n                if (exists) {\r\n                    select.value = preselectId;\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤', e);\r\n        }\r\n    }\r\n\r\n    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è select -> hidden\r\n    select.addEventListener('change', function () {\r\n        hidden.value = this.value || '';\r\n    });\r\n\r\n    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è\r\n    const currentId = hidden.value && hidden.value !== '00000000-0000-0000-0000-000000000000' ? hidden.value : '';\r\n    await loadPatients(currentId);\r\n\r\n    // –ï—Å–ª–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ select –≤—ã–±—Ä–∞–Ω ‚Äî —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ hidden —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω\r\n    if (select.value && !hidden.value) {\r\n        hidden.value = select.value;\r\n    }\r\n})();\r\n\r\n    (async function initAssigneeSelect() {\r\n        const form = document.getElementById('create-assignment-form');\r\n        const select = document.getElementById('assignee-select');\r\n        const help = document.getElementById('assignee-help');\r\n        const submitBtn = form.querySelector('button[type=\"submit\"]');\r\n\r\n        // –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞\r\n        if (submitBtn) submitBtn.disabled = true;\r\n\r\n        try {\r\n            const resp = await fetch('/api/users', { headers: { 'X-Requested-With': 'XMLHttpRequest' } });\r\n            if (!resp.ok) throw new Error('resp not ok');\r\n\r\n            const users = await resp.json();\r\n            if (!Array.isArray(users) || users.length === 0) throw new Error('empty list');\r\n\r\n            // –û—á–∏—Å—Ç–∏–º –∏ –¥–æ–±–∞–≤–∏–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä\r\n            select.innerHTML = '<option value=\"\">-- –í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è --</option>';\r\n\r\n            users.forEach(u => {\r\n                const id = u.id ?? u.Id ?? '';\r\n                const userName = u.userName ?? u.UserName ?? '';\r\n                const fullName = u.fullName ?? u.FullName ?? userName;\r\n                if (!userName) return;\r\n                const opt = document.createElement('option');\r\n                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –º–æ–¥–µ–ª—å —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Assignee)\r\n                opt.value = userName;\r\n                opt.textContent = fullName && fullName !== userName ? `${fullName} (${userName})` : userName;\r\n                select.appendChild(opt);\r\n            });\r\n\r\n            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ\r\n            if (submitBtn) submitBtn.disabled = false;\r\n            if (help) help.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞.';\r\n        } catch (e) {\r\n            console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', e);\r\n            // –°–æ–æ–±—â–∞–µ–º –æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤—ã–±–æ—Ä–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –∏ –∑–∞–ø—Ä–µ—â–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ\r\n            if (help) help.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É –ø–æ–∑–∂–µ.';\r\n            if (submitBtn) submitBtn.disabled = true;\r\n            // –î–æ–±–∞–≤–∏–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ–ø—Ü–∏—é —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º\r\n            select.innerHTML = '<option value=\"\">‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî</option>';\r\n            select.setAttribute('disabled', 'disabled');\r\n        }\r\n    })();\r\n\r\n    document.getElementById('create-assignment-form').addEventListener('submit', async function (e) {\r\n        e.preventDefault();\r\n        const form = e.target;\r\n        const formData = new FormData(form);\r\n        const resp = await fetch(form.action, {\r\n            method: 'POST',\r\n            body: formData,\r\n            headers: { 'X-Requested-With': 'XMLHttpRequest' }\r\n        });\r\n        if (resp.ok) {\r\n            bootstrap.Modal.getInstance(document.getElementById('form-modal')).hide();\r\n            if (window.assignmentTable) window.assignmentTable.ajax.reload(null, false);\r\n            if (window.assignmentDataTable) window.assignmentDataTable.ajax.reload(null, false);\r\n        if (window.assignmentDataTable) window.assignmentDataTable.ajax.reload(null, false);\r\n    } else {\r\n        const text = await resp.text();\r\n        console.error(text);\r\n        alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');\r\n    }\r\n});\r\n</script>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/Views/Assignment/_CreateAssignmentModal.cshtml b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/Views/Assignment/_CreateAssignmentModal.cshtml
--- a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/Views/Assignment/_CreateAssignmentModal.cshtml	(revision 1f8fee95001fe8134ec947ef163da438a8a34e5a)
+++ b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/Views/Assignment/_CreateAssignmentModal.cshtml	(date 1756982227183)
@@ -8,11 +8,25 @@
             <input asp-for="Name" class="form-control" />
             <span asp-validation-for="Name" class="text-danger"></span>
         </div>
-        <div class="mb-3">
+
+        <div class="row g-3">
+            <div class="col">
+                <label asp-for="AcceptDate" class="form-label"></label>
+                <input asp-for="AcceptDate" type="date" class="form-control" value="@Model.AcceptDate.ToString("yyyy-MM-dd")" />
+                <span asp-validation-for="AcceptDate" class="text-danger"></span>
+            </div>
+            <div class="col">
+                <label asp-for="DepartmentNumber" class="form-label"></label>
+                <input asp-for="DepartmentNumber" type="number" class="form-control" />
+            </div>
+        </div>
+
+        <div class="mb-3 mt-2">
             <label asp-for="Description" class="form-label"></label>
             <textarea asp-for="Description" class="form-control"></textarea>
             <span asp-validation-for="Description" class="text-danger"></span>
         </div>
+
         <div class="row g-3">
             <div class="col">
                 <label asp-for="Assignee" class="form-label"></label>
@@ -23,10 +37,25 @@
                 <div id="assignee-help" class="form-text">–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞.</div>
             </div>
         </div>
+
         <div class="row g-3 mt-1">
             <div class="col">
-                <label asp-for="DepartmentNumber" class="form-label"></label>
-                <input asp-for="DepartmentNumber" type="number" class="form-control" />
+                <label asp-for="ForwardDepartment" class="form-label"></label>
+                <input asp-for="ForwardDepartment" type="text" class="form-control" />
+                <span asp-validation-for="ForwardDepartment" class="text-danger"></span>
+            </div>
+            <div class="col">
+                <label asp-for="ForwardDate" class="form-label"></label>
+                <input asp-for="ForwardDate" type="date" class="form-control" value="@(Model.ForwardDate.HasValue ? Model.ForwardDate.Value.ToString("yyyy-MM-dd") : "")" />
+                <span asp-validation-for="ForwardDate" class="text-danger"></span>
+            </div>
+        </div>
+
+        <div class="row g-3 mt-1">
+            <div class="col">
+                <label asp-for="DepartmentForwardDate" class="form-label"></label>
+                <input asp-for="DepartmentForwardDate" type="date" class="form-control" value="@(Model.DepartmentForwardDate.HasValue ? Model.DepartmentForwardDate.Value.ToString("yyyy-MM-dd") : "")" />
+                <span asp-validation-for="DepartmentForwardDate" class="text-danger"></span>
             </div>
         </div>
 
@@ -40,7 +69,7 @@
 
         <input type="hidden" asp-for="PatientId" />
         <input type="hidden" asp-for="Id" value="00000000-0000-0000-0000-000000000000" />
-        <input type="hidden" asp-for="AcceptDate" value="@DateTime.UtcNow.ToString("s")" />
+
         <div class="mb-3 mt-2">
             <label asp-for="Note" class="form-label"></label>
             <textarea asp-for="Note" class="form-control"></textarea>
Index: src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/Views/Assignment/_EditAssignmentModal.cshtml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>@model CRM.SocialDepartment.Site.ViewModels.Assignment.EditAssignmentViewModel\r\n\r\n<div class=\"modal-header\">\r\n    <h5 class=\"modal-title\">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ</h5>\r\n    <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\r\n</div>\r\n<form id=\"edit-assignment-form\" method=\"post\" action=\"/api/assignments\">\r\n    @Html.AntiForgeryToken()\r\n    <div class=\"modal-body\">\r\n        <div class=\"mb-3\">\r\n            <label asp-for=\"Name\" class=\"form-label\"></label>\r\n            <input asp-for=\"Name\" class=\"form-control\" />\r\n            <span asp-validation-for=\"Name\" class=\"text-danger\"></span>\r\n        </div>\r\n        <div class=\"mb-3\">\r\n            <label asp-for=\"Description\" class=\"form-label\"></label>\r\n            <textarea asp-for=\"Description\" class=\"form-control\"></textarea>\r\n            <span asp-validation-for=\"Description\" class=\"text-danger\"></span>\r\n        </div>\r\n        <div class=\"row g-3\">\r\n            <div class=\"col\">\r\n                <label asp-for=\"Assignee\" class=\"form-label\"></label>\r\n                <input asp-for=\"Assignee\" class=\"form-control\" />\r\n            </div>\r\n        </div>\r\n        <div class=\"row g-3 mt-1\">\r\n            <div class=\"col\">\r\n                <label asp-for=\"DepartmentNumber\" class=\"form-label\"></label>\r\n                <input asp-for=\"DepartmentNumber\" type=\"number\" class=\"form-control\" />\r\n            </div>\r\n            <div class=\"col\">\r\n                <label asp-for=\"ForwardDepartment\" class=\"form-label\"></label>\r\n                <input asp-for=\"ForwardDepartment\" class=\"form-control\" />\r\n            </div>\r\n        </div>\r\n        <input type=\"hidden\" asp-for=\"PatientId\" />\r\n        <input type=\"hidden\" asp-for=\"Id\" />\r\n        <input type=\"hidden\" asp-for=\"CreatedDate\" />\r\n        <input type=\"hidden\" asp-for=\"AcceptDate\" />\r\n        <input type=\"hidden\" asp-for=\"ForwardDate\" />\r\n        <input type=\"hidden\" asp-for=\"DepartmentForwardDate\" />\r\n        <div class=\"mb-3 mt-2\">\r\n            <label asp-for=\"Note\" class=\"form-label\"></label>\r\n            <textarea asp-for=\"Note\" class=\"form-control\"></textarea>\r\n        </div>\r\n    </div>\r\n    <div class=\"modal-footer\">\r\n        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">–û—Ç–º–µ–Ω–∞</button>\r\n        <button type=\"submit\" class=\"btn btn-primary\">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>\r\n    </div>\r\n</form>\r\n\r\n<script>\r\ndocument.getElementById('edit-assignment-form').addEventListener('submit', async function (e) {\r\n    e.preventDefault();\r\n    const form = e.target;\r\n    const formData = new FormData(form);\r\n    const resp = await fetch(form.action, {\r\n        method: 'POST',\r\n        body: formData,\r\n        headers: { 'X-Requested-With': 'XMLHttpRequest' }\r\n    });\r\n    if (resp.ok) {\r\n        bootstrap.Modal.getInstance(document.getElementById('form-modal')).hide();\r\n        if (window.assignmentTable) window.assignmentTable.ajax.reload(null, false);\r\n    } else {\r\n        const text = await resp.text();\r\n        console.error(text);\r\n        alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');\r\n    }\r\n});\r\n</script>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/Views/Assignment/_EditAssignmentModal.cshtml b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/Views/Assignment/_EditAssignmentModal.cshtml
--- a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/Views/Assignment/_EditAssignmentModal.cshtml	(revision 1f8fee95001fe8134ec947ef163da438a8a34e5a)
+++ b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/Views/Assignment/_EditAssignmentModal.cshtml	(date 1756984468392)
@@ -1,9 +1,179 @@
 @model CRM.SocialDepartment.Site.ViewModels.Assignment.EditAssignmentViewModel
 
-<div class="modal-header">
-    <h5 class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ</h5>
-    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
-</div>
+<form id="edit-assignment-form" method="post" action="/api/assignments/@Model.Id">
+    @Html.AntiForgeryToken()
+    <div class="modal-body">
+        <div class="mb-3">
+            <label asp-for="Name" class="form-label"></label>
+            <input asp-for="Name" class="form-control" />
+            <span asp-validation-for="Name" class="text-danger"></span>
+        </div>
+
+        <div class="row g-3">
+            <div class="col">
+                <label asp-for="AcceptDate" class="form-label"></label>
+                <input asp-for="AcceptDate" type="date" class="form-control" value="@Model.AcceptDate.ToString("yyyy-MM-dd")" />
+                <span asp-validation-for="AcceptDate" class="text-danger"></span>
+            </div>
+            <div class="col">
+                <label asp-for="DepartmentNumber" class="form-label"></label>
+                <input asp-for="DepartmentNumber" type="number" class="form-control" />
+                <span asp-validation-for="DepartmentNumber" class="text-danger"></span>
+            </div>
+        </div>
+
+        <div class="mb-3 mt-2">
+            <label asp-for="Description" class="form-label"></label>
+            <textarea asp-for="Description" class="form-control"></textarea>
+            <span asp-validation-for="Description" class="text-danger"></span>
+        </div>
+
+        <div class="row g-3">
+            <div class="col">
+                <label asp-for="Assignee" class="form-label"></label>
+                <select id="assignee-select-edit" class="form-select" name="Assignee" required>
+                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è --</option>
+                </select>
+                <span asp-validation-for="Assignee" class="text-danger"></span>
+                <div id="assignee-help-edit" class="form-text">–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞.</div>
+            </div>
+        </div>
+
+        <div class="row g-3 mt-1">
+            <div class="col">
+                <label asp-for="ForwardDepartment" class="form-label"></label>
+                <input asp-for="ForwardDepartment" type="text" class="form-control" />
+                <span asp-validation-for="ForwardDepartment" class="text-danger"></span>
+            </div>
+            <div class="col">
+                <label asp-for="ForwardDate" class="form-label"></label>
+                <input asp-for="ForwardDate" type="date" class="form-control" />
+                <span asp-validation-for="ForwardDate" class="text-danger"></span>
+            </div>
+        </div>
+
+        <div class="row g-3 mt-1">
+            <div class="col">
+                <label asp-for="DepartmentForwardDate" class="form-label"></label>
+                <input asp-for="DepartmentForwardDate" type="date" class="form-control" />
+                <span asp-validation-for="DepartmentForwardDate" class="text-danger"></span>
+            </div>
+        </div>
+
+        <div class="mb-3 mt-2">
+            <label asp-for="PatientId" class="form-label"></label>
+            <select id="patient-select-edit" class="form-select">
+                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞ --</option>
+            </select>
+            <span asp-validation-for="PatientId" class="text-danger"></span>
+        </div>
+
+        <input type="hidden" asp-for="PatientId" />
+        <input type="hidden" asp-for="Id" />
+
+        <div class="mb-3 mt-2">
+            <label asp-for="Note" class="form-label"></label>
+            <textarea asp-for="Note" class="form-control"></textarea>
+            <span asp-validation-for="Note" class="text-danger"></span>
+        </div>
+    </div>
+    <div class="modal-footer">
+        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
+        <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
+    </div>
+</form>
+
+<script>
+(async function initPatientSelectEdit() {
+    const select = document.getElementById('patient-select-edit');
+    const hidden = document.querySelector('#edit-assignment-form input[name="PatientId"]');
+    const preselectedId = hidden.value && hidden.value !== '00000000-0000-0000-0000-000000000000' ? hidden.value : '';
+
+    async function loadPatients(preselectId) {
+        try {
+            const resp = await fetch('/api/patients', { headers: { 'X-Requested-With': 'XMLHttpRequest' } });
+            if (!resp.ok) return;
+            const patients = await resp.json();
+            select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞ --</option>';
+
+            const toText = (p) => {
+                const fullName = p.fullName ?? p.FullName ?? '';
+                const birthday = p.birthday ?? p.Birthday;
+                if (fullName && birthday) return `${fullName} (${birthday})`;
+                return fullName || (p.lastName && p.firstName ? `${p.lastName} ${p.firstName}` : `–ü–∞—Ü–∏–µ–Ω—Ç`);
+            };
+
+            patients.forEach(p => {
+                const id = p.id ?? p.Id;
+                if (!id) return;
+                const opt = document.createElement('option');
+                opt.value = id;
+                opt.textContent = toText(p);
+                select.appendChild(opt);
+            });
+
+            if (preselectId) {
+                const exists = Array.from(select.options).some(o => o.value === preselectId);
+                if (exists) {
+                    select.value = preselectId;
+                }
+            }
+        } catch (e) {
+            console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤', e);
+        }
+    }
+
+    select.addEventListener('change', function () {
+        hidden.value = this.value || '';
+    });
+
+    await loadPatients(preselectedId);
+    if (select.value && !hidden.value) {
+        hidden.value = select.value;
+    }
+})();
+
+(async function initAssigneeSelectEdit() {
+    const form = document.getElementById('edit-assignment-form');
+    const select = document.getElementById('assignee-select-edit');
+    const help = document.getElementById('assignee-help-edit');
+    const submitBtn = form.querySelector('button[type="submit"]');
+
+    if (submitBtn) submitBtn.disabled = true;
+    try {
+        const resp = await fetch('/api/users', { headers: { 'X-Requested-With': 'XMLHttpRequest' } });
+        if (!resp.ok) throw new Error('resp not ok');
+        const users = await resp.json();
+        select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è --</option>';
+
+        users.forEach(u => {
+            const userName = u.userName ?? u.UserName ?? '';
+            const fullName = u.fullName ?? u.FullName ?? userName;
+            if (!userName) return;
+            const opt = document.createElement('option');
+            opt.value = userName;
+            opt.textContent = fullName && fullName !== userName ? `${fullName} (${userName})` : userName;
+            select.appendChild(opt);
+        });
+
+        // –ü—Ä–µ–¥–≤—ã–±–æ—Ä —Ç–µ–∫—É—â–µ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
+        const current = '@Model.Assignee';
+        if (current) {
+            const exists = Array.from(select.options).some(o => o.value === current);
+            if (exists) select.value = current;
+        }
+
+        if (submitBtn) submitBtn.disabled = false;
+        if (help) help.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞.';
+    } catch (e) {
+        console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', e);
+        if (help) help.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É –ø–æ–∑–∂–µ.';
+        if (submitBtn) submitBtn.disabled = true;
+        select.innerHTML = '<option value="">‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî</option>';
+        select.setAttribute('disabled', 'disabled');
+    }
+})();
+</script>
 <form id="edit-assignment-form" method="post" action="/api/assignments">
     @Html.AntiForgeryToken()
     <div class="modal-body">
Index: src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/wwwroot/js/assignment.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>/*\r\n    –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –î–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á (assignments).\r\n    –í–µ—Ä—Å–∏—è: 1.0.0\r\n*/\r\n\r\n// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫\r\nconsole.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫:');\r\nconsole.log('jQuery:', typeof $ !== 'undefined' ? '–ó–∞–≥—Ä—É–∂–µ–Ω' : '–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω');\r\nconsole.log('DataTables:', typeof $.fn.DataTable !== 'undefined' ? '–ó–∞–≥—Ä—É–∂–µ–Ω' : '–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω');\r\nif (typeof $.fn.DataTable !== 'undefined') {\r\n    console.log('DataTables –≤–µ—Ä—Å–∏—è:', $.fn.dataTable.version);\r\n}\r\n\r\n// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π\r\nfunction showMessage(type, title, message) {\r\n    if (window.malomalsky?.message?.[type] && typeof window.malomalsky.message[type] === 'function') {\r\n        try {\r\n            malomalsky.message[type](title, message);\r\n            return;\r\n        } catch (error) {\r\n            console.error('–û—à–∏–±–∫–∞ –≤ malomalsky.message:', error);\r\n        }\r\n    }\r\n\r\n    if (window.Swal) {\r\n        const config = {\r\n            title: title,\r\n            text: message,\r\n            confirmButtonText: 'OK'\r\n        };\r\n\r\n        switch (type) {\r\n            case 'success': config.icon = 'success'; break;\r\n            case 'error': config.icon = 'error'; break;\r\n            case 'warning': config.icon = 'warning'; break;\r\n            case 'info': config.icon = 'info'; break;\r\n        }\r\n\r\n        Swal.fire(config);\r\n    } else {\r\n        console.log(title + ': ' + message);\r\n    }\r\n}\r\n\r\n// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API –∏ –º–∞–ø–ø–∏–Ω–≥ –∫–æ–ª–æ–Ω–æ–∫ DataTables\r\nconst ASSIGNMENT_API = {\r\n    listActive: '/api/assignments/active',   // POST\r\n    createOrUpdate: '/api/assignments',      // POST (Create/Update)\r\n    delete: (id) => `/api/assignments/${id}`,// DELETE\r\n    modalCreate: '/Assignment/modal/create', // GET (PartialView)\r\n    modalEdit: (id) => `/Assignment/modal/edit?id=${id}` // GET (PartialView)\r\n};\r\n\r\n// –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –ø–æ–ª–µ–π –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∫ —Å—Ç–æ–ª–±—Ü–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –≤–∏–¥–∏—Ç–µ –≤ Razor-—Ä–∞–∑–º–µ—Ç–∫–µ\r\n// –ó–∞–≥–æ–ª–æ–≤–∫–∏ (–ø–æ –ø–æ—Ä—è–¥–∫—É):\r\n//  0: ID\r\n//  1: –î–∞—Ç–∞ –ø—Ä–∏–µ–º–∞ –∑–∞—è–≤–∫–∏ –æ—Ç –æ—Ç–¥–µ–ª–µ–Ω–∏—è\r\n//  2: –ù–æ–º–µ—Ä –æ—Ç–¥–µ–ª–µ–Ω–∏—è\r\n//  3: –û–ø–∏—Å–∞–Ω–∏–µ\r\n//  4: –î–∞—Ç–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è\r\n//  5: –ö—É–¥–∞ –Ω–∞–ø—Ä–∞–≤–∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã\r\n//  6: –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ\r\n//  7: –î–∞—Ç–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ\r\n//  8: –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å\r\n//  9: –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ\r\n// 10: –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏\r\n// 11: –ü–∞—Ü–∏–µ–Ω—Ç\r\n//\r\n// –ù–∏–∂–µ —É–∫–∞–∂–∏—Ç–µ –∏–º–µ–Ω–∞ –ø–æ–ª–µ–π –∏–∑ JSON, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä.\r\n// –ü—Ä–∏–º–µ—Ä —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –±–∞–∑–µ —Ä–∞–Ω–µ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ (+ –≤–µ—Ä–æ—è—Ç–Ω—ã–µ –ø–æ–ª—è –¥–æ–º–µ–Ω–∞):\r\nconst COLUMNS_MAP = {\r\n    id: 'id',\r\n    acceptDate: 'acceptDate',                     // –î–∞—Ç–∞ –ø—Ä–∏–µ–º–∞ –∑–∞—è–≤–∫–∏ –æ—Ç –æ—Ç–¥–µ–ª–µ–Ω–∏—è\r\n    departmentNumber: 'departmentNumber',         // –ù–æ–º–µ—Ä –æ—Ç–¥–µ–ª–µ–Ω–∏—è\r\n    description: 'description',                   // –û–ø–∏—Å–∞–Ω–∏–µ\r\n    forwardDate: 'forwardDate',                   // –î–∞—Ç–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è\r\n    forwardDepartment: 'forwardDepartment',       // –ö—É–¥–∞ –Ω–∞–ø—Ä–∞–≤–∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã\r\n    name: 'name',                                 // –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ –Ω–∞ workDone)\r\n    departmentForwardDate: 'departmentForwardDate', // –î–∞—Ç–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ\r\n    assignee: 'assignee',                         // –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å\r\n    note: 'note',                                 // –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ\r\n    createdDate: 'createdDate',                   // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏\r\n    patient: 'patient'                            // –ü–∞—Ü–∏–µ–Ω—Ç (—Å—Ç—Ä–æ–∫–∞ –§–ò–û –∏–ª–∏ –∫–æ–¥)\r\n};\r\n\r\n// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏\r\nfunction updateConnectionStatus() {\r\n    const isConnected = true; // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è\r\n    $('#connection-status').html(\r\n        isConnected\r\n            ? '<i class=\"fa fa-circle text-success\"></i><small>–ü–æ–¥–∫–ª—é—á–µ–Ω–æ</small>'\r\n            : '<i class=\"fa fa-circle text-warning\"></i><small>Polling —Ä–µ–∂–∏–º</small>'\r\n    );\r\n}\r\n\r\nfunction updateLastUpdateTime() {\r\n    const now = new Date();\r\n    const timeString = now.toLocaleTimeString('ru-RU', {\r\n        hour: '2-digit',\r\n        minute: '2-digit',\r\n        second: '2-digit'\r\n    });\r\n    $('#last-update').text(timeString);\r\n}\r\n\r\nfunction updateRecordsCount(count) {\r\n    $('#records-badge').text(count || 0);\r\n}\r\n\r\n// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö\r\nlet assignmentAutoRefreshInterval;\r\nlet assignmentSubmitInProgress = false;\r\nfunction startAssignmentAutoRefresh() {\r\n    if ($('#auto-refresh-setting').is(':checked') && window.assignmentDataTable) {\r\n        stopAssignmentAutoRefresh();\r\n        assignmentAutoRefreshInterval = setInterval(() => {\r\n            window.assignmentDataTable.ajax.reload(null, false);\r\n            updateLastUpdateTime();\r\n        }, 30000);\r\n    }\r\n}\r\n\r\nfunction stopAssignmentAutoRefresh() {\r\n    if (assignmentAutoRefreshInterval) {\r\n        clearInterval(assignmentAutoRefreshInterval);\r\n        assignmentAutoRefreshInterval = null;\r\n    }\r\n}\r\n\r\n// –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã –∑–∞–¥–∞—á (–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ, —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –≤–∫–ª–∞–¥–æ–∫)\r\nfunction ensureAssignmentTableInitialized(forceReload = false) {\r\n    const tableExistsInDom = $('#table').length > 0;\r\n\r\n    // –£–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ ‚Äî –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º—è–≥–∫–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–º\r\n    if (window.assignmentDataTable && $.fn.DataTable.isDataTable('#table')) {\r\n        if (forceReload) {\r\n            window.assignmentDataTable.ajax.reload(null, false);\r\n        }\r\n        return;\r\n    }\r\n\r\n    // –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü—ã –µ—â—ë –Ω–µ—Ç –≤ DOM ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏ –ø–æ–∫–∞–∑–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –≤–∫–ª–∞–¥–∫–∏\r\n    if (!tableExistsInDom) {\r\n        $(document)\r\n            .off('shown.bs.tab.assignment', 'a[data-bs-toggle=\"tab\"]')\r\n            .on('shown.bs.tab.assignment', 'a[data-bs-toggle=\"tab\"]', function () {\r\n                if ($('#table').length > 0 && !$.fn.DataTable.isDataTable('#table')) {\r\n                    const dt = initializeAssignmentDataTable();\r\n                    if (dt) startAssignmentAutoRefresh();\r\n                }\r\n            });\r\n        return;\r\n    }\r\n\r\n    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å\r\n    const dt = initializeAssignmentDataTable();\r\n    if (dt) startAssignmentAutoRefresh();\r\n}\r\n\r\n// –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã –∑–∞–¥–∞—á (–æ–¥–∏–Ω —Ä–∞–∑)\r\nfunction ensureAssignmentTableInitialized(forceReload = false) {\r\n    const tableExistsInDom = $('#table').length > 0;\r\n\r\n    // –£–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ ‚Äî –ø–æ –∂–µ–ª–∞–Ω–∏—é —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–º\r\n    if (window.assignmentDataTable && $.fn.DataTable.isDataTable('#table')) {\r\n        if (forceReload) {\r\n            window.assignmentDataTable.ajax.reload(null, false);\r\n        }\r\n        return;\r\n    }\r\n\r\n    // –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü—ã –µ—â—ë –Ω–µ—Ç –≤ DOM ‚Äî –ø–æ–¥–æ–∂–¥—ë–º —Å–æ–±—ã—Ç–∏—è –ø–æ–∫–∞–∑–∞ —Ç–∞–±–∞\r\n    if (!tableExistsInDom) {\r\n        // –ü–æ–¥—Ü–µ–ø–∏–º—Å—è –∫ —Å–æ–±—ã—Ç–∏—é Bootstrap —Ç–∞–±–æ–≤ ‚Äî –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ–∫–∞–∑–µ –ø–æ–ø—Ä–æ–±—É–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å\r\n        $(document).off('shown.assignment.tab', 'a[data-bs-toggle=\"tab\"]').on('shown.assignment.tab', 'a[data-bs-toggle=\"tab\"]', function () {\r\n            if ($('#table').length > 0 && !$.fn.DataTable.isDataTable('#table')) {\r\n                const dt = initializeAssignmentDataTable();\r\n                if (dt) startAssignmentAutoRefresh();\r\n            }\r\n        });\r\n        return;\r\n    }\r\n\r\n    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å\r\n    const dt = initializeAssignmentDataTable();\r\n    if (dt) startAssignmentAutoRefresh();\r\n}\r\n\r\n// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫\r\nfunction loadAssignmentSettings() {\r\n    const savedSettings = localStorage.getItem('assignmentTableSettings');\r\n    if (savedSettings) {\r\n        try {\r\n            const settings = JSON.parse(savedSettings);\r\n            $('#page-length-setting').val(settings.pageLength || '50');\r\n            $('#auto-refresh-setting').prop('checked', settings.autoRefresh !== false);\r\n            $('#compact-mode-setting').prop('checked', settings.compactMode || false);\r\n            $('#save-state-setting').prop('checked', settings.saveState !== false);\r\n        } catch (e) {\r\n            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', e);\r\n        }\r\n    }\r\n}\r\n\r\n// –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\r\nfunction openCreateAssignment(patientId) {\r\n    const url = patientId ? (ASSIGNMENT_API.modalCreate + '?patientId=' + encodeURIComponent(patientId))\r\n        : ASSIGNMENT_API.modalCreate;\r\n\r\n    $.get(url, function (html) {\r\n        $('#form-modal .modal-title').text('–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É');\r\n        $('#form-modal .modal-body').html(html);\r\n        $('#form-modal').modal('show');\r\n        if (window.AddAssignmentFormValidation) {\r\n            AddAssignmentFormValidation.initErrorClearing();\r\n        }\r\n    }).fail(function () {\r\n        showMessage('error', '–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ä–º—É —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏');\r\n    });\r\n}\r\n\r\nfunction openEditAssignment(assignmentId) {\r\n    $.get(ASSIGNMENT_API.modalEdit(assignmentId), function (html) {\r\n        $('#form-modal .modal-title').text('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É');\r\n        $('#form-modal .modal-body').html(html);\r\n        $('#form-modal').modal('show');\r\n        if (window.AddAssignmentFormValidation) {\r\n            AddAssignmentFormValidation.initErrorClearing();\r\n        }\r\n    }).fail(function () {\r\n        showMessage('error', '–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');\r\n    });\r\n}\r\n\r\n// –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏\r\nfunction deleteAssignment(assignmentId) {\r\n    Swal.fire({\r\n        title: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ',\r\n        text: '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É?',\r\n        icon: 'warning',\r\n        showCancelButton: true,\r\n        confirmButtonColor: '#d33',\r\n        cancelButtonColor: '#3085d6',\r\n        confirmButtonText: '–î–∞, —É–¥–∞–ª–∏—Ç—å',\r\n        cancelButtonText: '–û—Ç–º–µ–Ω–∞'\r\n    }).then((result) => {\r\n        if (result.isConfirmed) {\r\n            $.ajax({\r\n                url: ASSIGNMENT_API.delete(assignmentId),\r\n                type: 'DELETE',\r\n                headers: { 'X-Requested-With': 'XMLHttpRequest' }\r\n            }).done(function (response, status, xhr) {\r\n                // –î–ª—è 204 No Content –Ω–µ—Ç —Ç–µ–ª–∞ ‚Äî —Å—á–∏—Ç–∞–µ–º —É—Å–ø–µ—Ö–æ–º\r\n                showMessage('success', '–£—Å–ø–µ—à–Ω–æ', '–ó–∞–¥–∞—á–∞ —É–¥–∞–ª–µ–Ω–∞.');\r\n                if (window.assignmentDataTable) {\r\n                    window.assignmentDataTable.ajax.reload();\r\n                }\r\n            }).fail(function (xhr) {\r\n                showMessage('error', '–û—à–∏–±–∫–∞', '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏.');\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\n// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DataTable –¥–ª—è –∑–∞–¥–∞—á\r\nfunction initializeAssignmentDataTable() {\r\n    console.log('–ù–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é DataTable (assignments)');\r\n\r\n    const $table = $('#table');\r\n    console.log('–¢–∞–±–ª–∏—Ü–∞ –Ω–∞–π–¥–µ–Ω–∞ –≤ DOM:', $table.length > 0);\r\n    if ($table.length === 0) {\r\n        console.error('–¢–∞–±–ª–∏—Ü–∞ —Å id=\"table\" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ DOM');\r\n        return null;\r\n    }\r\n\r\n    if ($.fn.DataTable.isDataTable('#table')) {\r\n        console.log('DataTable —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —É–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—É—é');\r\n        $('#table').DataTable().destroy();\r\n        $('#table').empty();\r\n    }\r\n\r\n    const url = ASSIGNMENT_API.listActive;\r\n    console.log('URL –¥–ª—è AJAX –∑–∞–ø—Ä–æ—Å–∞:', url);\r\n\r\n    try {\r\n        const dataTable = $('#table').DataTable({\r\n            processing: true,\r\n            serverSide: true,\r\n            rowId: COLUMNS_MAP.id,\r\n            ajax: {\r\n                url: url,\r\n                type: 'POST',\r\n                dataType: 'json',\r\n                headers: {\r\n                    'X-Requested-With': 'XMLHttpRequest'\r\n                },\r\n                data: function (d) {\r\n                    console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ DataTable:', d);\r\n                    return d;\r\n                },\r\n                beforeSend: function () {\r\n                    console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX –∑–∞–ø—Ä–æ—Å –Ω–∞:', url);\r\n                },\r\n                dataSrc: function (json) {\r\n                    console.log('–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', json);\r\n\r\n                    if (!json || typeof json !== 'object') {\r\n                        console.error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');\r\n                        return [];\r\n                    }\r\n\r\n                    if (json.error) {\r\n                        console.error('–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É:', json.error);\r\n                        showMessage('error', '–û—à–∏–±–∫–∞', json.error);\r\n                        return [];\r\n                    }\r\n\r\n                    if (json.data && Array.isArray(json.data)) {\r\n                        updateRecordsCount(json.recordsTotal || 0);\r\n                        updateLastUpdateTime();\r\n                        return json.data;\r\n                    }\r\n\r\n                    updateRecordsCount(0);\r\n                    updateLastUpdateTime();\r\n                    return [];\r\n                },\r\n                error: function (xhr, status, error) {\r\n                    console.error('–û—à–∏–±–∫–∞ AJAX –∑–∞–ø—Ä–æ—Å–∞:', { xhr, status, error });\r\n                    if (status !== 'abort') {\r\n                        showMessage('error', '–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á');\r\n                    }\r\n                    return [];\r\n                }\r\n            },\r\n            columns: [\r\n                // –î–µ–π—Å—Ç–≤–∏—è (–ø—Ä–æ—Å–º–æ—Ç—Ä/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ)\r\n                {\r\n                    data: COLUMNS_MAP.id,\r\n                    title: '–î–µ–π—Å—Ç–≤–∏—è',\r\n                    orderable: false,\r\n                    searchable: false,\r\n                    render: function (data, type, row) {\r\n                        return `\r\n                            <div class=\"dropdown\">\r\n                                <button class=\"btn btn-secondary btn-sm dropdown-toggle\" type=\"button\"\r\n                                        data-bs-toggle=\"dropdown\"\r\n                                        data-bs-display=\"static\"\r\n                                        data-bs-boundary=\"viewport\"\r\n                                        data-bs-auto-close=\"outside\"\r\n                                        aria-expanded=\"false\">\r\n                                    –î–µ–π—Å—Ç–≤–∏–µ\r\n                                </button>\r\n                                <ul class=\"dropdown-menu\">\r\n                                    <li><a class=\"dropdown-item btn-view-assignment\" href=\"#\" data-assignment-id=\"${data}\">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å</a></li>\r\n                                    <li><a class=\"dropdown-item btn-edit-assignment\" href=\"#\" data-assignment-id=\"${data}\">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a></li>\r\n                                    <li><a class=\"dropdown-item btn-delete-assignment\" href=\"#\" data-assignment-id=\"${data}\">–£–¥–∞–ª–∏—Ç—å</a></li>\r\n                                </ul>\r\n                            </div>\r\n                        `;\r\n                    }\r\n                },\r\n\r\n                // –°—Ç–æ–ª–±—Ü—ã –ø–æ –í–∞—à–∏–º –∑–∞–≥–æ–ª–æ–≤–∫–∞–º\r\n                { data: COLUMNS_MAP.id, title: 'ID', visible: false, searchable: false },\r\n\r\n                { data: COLUMNS_MAP.acceptDate, title: '–î–∞—Ç–∞ –ø—Ä–∏–µ–º–∞ –∑–∞—è–≤–∫–∏ –æ—Ç –æ—Ç–¥–µ–ª–µ–Ω–∏—è', className: 'text-center',\r\n                    render: function (d) { return formatDate(d); } },\r\n\r\n                { data: COLUMNS_MAP.departmentNumber, title: '–ù–æ–º–µ—Ä –æ—Ç–¥–µ–ª–µ–Ω–∏—è', className: 'text-center' },\r\n\r\n                { data: COLUMNS_MAP.description, title: '–û–ø–∏—Å–∞–Ω–∏–µ', className: 'fw-medium' },\r\n\r\n                { data: COLUMNS_MAP.forwardDate, title: '–î–∞—Ç–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è', className: 'text-center',\r\n                    render: function (d) { return formatDate(d); } },\r\n\r\n                { data: COLUMNS_MAP.forwardDepartment, title: '–ö—É–¥–∞ –Ω–∞–ø—Ä–∞–≤–∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã', className: 'text-center' },\r\n\r\n                { data: COLUMNS_MAP.name, title: '–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ', className: 'fw-medium' },\r\n\r\n                { data: COLUMNS_MAP.departmentForwardDate, title: '–î–∞—Ç–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ', className: 'text-center',\r\n                    render: function (d) { return formatDate(d); } },\r\n\r\n                { data: COLUMNS_MAP.assignee, title: '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å', className: 'text-center' },\r\n\r\n                { data: COLUMNS_MAP.note, title: '–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ', className: 'fw-medium' },\r\n\r\n                { data: COLUMNS_MAP.createdDate, title: '–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏', className: 'text-center',\r\n                    render: function (d) { return formatDate(d); } },\r\n\r\n                { data: COLUMNS_MAP.patient, title: '–ü–∞—Ü–∏–µ–Ω—Ç', className: 'fw-medium' }\r\n            ],\r\n            order: [[11, 'desc']], // —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ \"–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏\" (–∏–Ω–¥–µ–∫—Å –∫–æ–ª–æ–Ω–∫–∏ –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ)\r\n            pageLength: 100,\r\n            lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, '–í—Å–µ']],\r\n            language: {\r\n                url: '/lib/datatables.net-bs5/language/ru.json'\r\n            },\r\n            dom: '<\"row\"<\"col-sm-12 col-md-6\"l><\"col-sm-12 col-md-6\"f>>' +\r\n                '<\"row\"<\"col-sm-12\"tr>>' +\r\n                '<\"row\"<\"col-sm-12 col-md-5\"i><\"col-sm-12 col-md-7\"p>>',\r\n            responsive: true,\r\n            initComplete: function () {\r\n                console.log('DataTable (assignments) –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');\r\n                this.api().on('search.dt', function () {\r\n                    console.log('–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–∏—Å–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ –∑–∞–¥–∞—á');\r\n                });\r\n                this.api().on('xhr.dt', function () {\r\n                    console.log('XHR –∑–∞–ø—Ä–æ—Å –¥–ª—è –∑–∞–¥–∞—á –∑–∞–≤–µ—Ä—à–µ–Ω');\r\n                });\r\n            }\r\n        });\r\n\r\n        window.assignmentDataTable = dataTable;\r\n        console.log('DataTable —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ window.assignmentDataTable');\r\n\r\n        // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–µ–∑–∞–Ω–∏—è –≤—ã–ø–∞–¥–∞—é—â–∏—Ö –º–µ–Ω—é –≤ –æ–±–µ—Ä—Ç–∫–∞—Ö DataTables\r\n        try {\r\n            const $wrapper = $('#table').closest('.dataTables_wrapper');\r\n            $wrapper.css('overflow', 'visible');\r\n            $wrapper.find('.dataTables_scroll, .dataTables_scrollBody').css('overflow', 'visible');\r\n            $('.modern-datatable-container').css('overflow', 'visible');\r\n        } catch (e) {\r\n            console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å overflow fix –∫ –æ–±–µ—Ä—Ç–∫–∞–º DataTables:', e);\r\n        }\r\n\r\n        return dataTable;\r\n    } catch (error) {\r\n        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ DataTable (assignments):', error);\r\n        showMessage('error', '–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –¥–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á.');\r\n        return null;\r\n    }\r\n}\r\n\r\n// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã dd.MM.yyyy\r\nfunction formatDate(date) {\r\n    if (!date) return '';\r\n    const d = new Date(date);\r\n    if (isNaN(d.getTime())) return '';\r\n    const day = String(d.getDate()).padStart(2, '0');\r\n    const month = String(d.getMonth() + 1).padStart(2, '0');\r\n    const year = d.getFullYear();\r\n    return `${day}.${month}.${year}`;\r\n}\r\n\r\n// –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏–∑ dd.MM.yyyy –≤ ISO (–µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è)\r\nfunction formatDateForInput(dateString) {\r\n    if (!dateString) return '';\r\n    const parts = dateString.split('.');\r\n    if (parts.length !== 3) return '';\r\n    const day = parts[0];\r\n    const month = parts[1];\r\n    const year = parts[2];\r\n    return `${year}-${month}-${day}`;\r\n}\r\n\r\n// CSS-—Ñ–∏–∫—Å –¥–ª—è dropdown –≤–Ω—É—Ç—Ä–∏ —Ç–∞–±–ª–∏—Ü—ã (DataTables + Bootstrap)\r\nfunction injectAssignmentDropdownFixStyles() {\r\n    if (document.getElementById('assignment-dropdown-fix')) return;\r\n    const style = document.createElement('style');\r\n    style.id = 'assignment-dropdown-fix';\r\n    style.textContent = `\r\n/* –†–∞–∑—Ä–µ—à–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–º –º–µ–Ω—é –≤—ã—Ö–æ–¥–∏—Ç—å –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –æ–±–µ—Ä—Ç–æ–∫ */\r\n.modern-datatable-container,\r\n.dataTables_wrapper,\r\n.table-responsive {\r\n    overflow: visible !important;\r\n}\r\n\r\n/* –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ DataTables */\r\n.dataTables_wrapper .dataTables_scroll,\r\n.dataTables_wrapper .dataTables_scrollBody {\r\n    overflow: visible !important;\r\n}\r\n\r\n/* –ü–æ–¥–Ω–∏–º–∞–µ–º –º–µ–Ω—é –Ω–∞–¥ —Å—Ç—Ä–æ–∫–∞–º–∏ —Ç–∞–±–ª–∏—Ü—ã */\r\ntable.dataTable td .dropdown-menu {\r\n    z-index: 1061; /* –≤—ã—à–µ, —á–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π 1000 */\r\n}\r\n    `;\r\n    document.head.appendChild(style);\r\n}\r\n\r\n// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π\r\n$(document).ready(function () {\r\n    console.log('Document ready: assignment.js');\r\n\r\n    if (typeof $ === 'undefined') {\r\n        console.error('jQuery –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');\r\n        return;\r\n    }\r\n    if (typeof $.fn.DataTable === 'undefined') {\r\n        console.error('DataTables –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');\r\n        return;\r\n    }\r\n\r\n    // –ò–Ω–∂–µ–∫—Ç–∏–º CSS-—Ñ–∏–∫—Å –¥–ª—è dropdown –≤–Ω—É—Ç—Ä–∏ —Ç–∞–±–ª–∏—Ü—ã\r\n    injectAssignmentDropdownFixStyles();\r\n\r\n    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è\r\n    loadAssignmentSettings();\r\n    updateConnectionStatus();\r\n    updateLastUpdateTime();\r\n\r\n    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DataTable (–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)\r\n    ensureAssignmentTableInitialized();\r\n\r\n    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø–æ–∫–∞–∑–µ –≤–∫–ª–∞–¥–æ–∫ (–µ—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)\r\n    $(document).off('shown.assignment.tab', 'a[data-bs-toggle=\"tab\"]').on('shown.assignment.tab', 'a[data-bs-toggle=\"tab\"]', function () {\r\n        ensureAssignmentTableInitialized();\r\n    });\r\n\r\n    // –ö–Ω–æ–ø–∫–∞ \"–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É\" ‚Äî –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è –ø—Ä–∏–≤—è–∑–∫–∞\r\n    $(document).off('click.assignment', '#add-assignment').on('click.assignment', '#add-assignment', function (e) {\r\n        e.preventDefault();\r\n        openCreateAssignment();\r\n    });\r\n\r\n    // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞: –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É (–æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ —Å namespace)\r\n    $(document).off('submit.assignment', '#create-assignment-form').on('submit.assignment', '#create-assignment-form', function (e) {\r\n        e.preventDefault();\r\n\r\n        const $form = $(this);\r\n        const url = $form.attr('action');\r\n\r\n        if (window.AddAssignmentFormValidation) {\r\n            AddAssignmentFormValidation.clearValidationErrors();\r\n        }\r\n\r\n        const formData = new FormData($form[0]);\r\n        const data = new URLSearchParams();\r\n        for (const pair of formData.entries()) {\r\n            data.append(pair[0], pair[1]);\r\n        }\r\n\r\n        const headers = {\r\n            \"CSRF-TOKEN\": $form.find('input[name=\"__RequestVerificationToken\"]').val()\r\n        };\r\n\r\n        $.ajax({\r\n            url: url,\r\n            type: 'POST',\r\n            data: data.toString(),\r\n            contentType: 'application/x-www-form-urlencoded',\r\n            headers: headers,\r\n            beforeSend: function () {\r\n                $(\"#form-modal\").find(':submit').attr('disabled', true).html('<div class=\"spinner-border spinner-border-sm\" role=\"status\"></div>');\r\n            },\r\n            success: function () {\r\n                $('#form-modal').modal('hide');\r\n                showMessage('success', '–£—Å–ø–µ—à–Ω–æ', '–ó–∞–¥–∞—á–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞');\r\n\r\n                // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∏ –º—è–≥–∫—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É\r\n                ensureAssignmentTableInitialized(true);\r\n                if (window.assignmentDataTable) {\r\n                    window.assignmentDataTable.ajax.reload(null, false);\r\n                }\r\n            },\r\n            error: function (xhr) {\r\n                $(\"#form-modal\").find(':submit').html('–°–æ—Ö—Ä–∞–Ω–∏—Ç—å').attr('disabled', false);\r\n\r\n                if (xhr.status === 400) {\r\n                    try {\r\n                        const response = JSON.parse(xhr.responseText);\r\n                        console.log('–û—Ç–≤–µ—Ç —Å –æ—à–∏–±–∫–∞–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:', response);\r\n\r\n                        if (Array.isArray(response)) {\r\n                            AddAssignmentFormValidation.showValidationErrors(response);\r\n                            return;\r\n                        }\r\n                        if (response && response.Data && Array.isArray(response.Data.Errors)) {\r\n                            AddAssignmentFormValidation.showValidationErrors(response.Data.Errors);\r\n                            return;\r\n                        }\r\n                        if (response && typeof response === 'object') {\r\n                            const collected = [];\r\n                            Object.keys(response).forEach(k => {\r\n                                const messages = response[k];\r\n                                if (Array.isArray(messages)) {\r\n                                    messages.forEach(m => collected.push(m));\r\n                                } else if (messages && typeof messages === 'object' && messages.errors) {\r\n                                    messages.errors.forEach(e => collected.push(e.errorMessage || e));\r\n                                }\r\n                            });\r\n                            if (collected.length) {\r\n                                AddAssignmentFormValidation.showValidationErrors(collected);\r\n                                return;\r\n                            }\r\n                        }\r\n                    } catch (parseError) {\r\n                        console.log('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç —Å –æ—à–∏–±–∫–∞–º–∏:', parseError);\r\n                    }\r\n                }\r\n\r\n                const errorMessage = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏';\r\n                showMessage('error', '–û—à–∏–±–∫–∞', errorMessage);\r\n            }\r\n        });\r\n    });\r\n\r\n    // –û—á–∏—Å—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ\r\n    $(document).on('input focus', '.form-control.is-invalid, .form-select.is-invalid', function () {\r\n        $(this).removeClass('is-invalid');\r\n        $(this).siblings('.invalid-feedback, .text-danger.field-validation-error').remove();\r\n    });\r\n    $(document).on('change', '.form-select.is-invalid', function () {\r\n        $(this).removeClass('is-invalid');\r\n        $(this).siblings('.invalid-feedback, .text-danger.field-validation-error').remove();\r\n    });\r\n\r\n    // –ö–Ω–æ–ø–∫–∞ \"–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ\"\r\n    $(document).on('click', '#reload-data', function (e) {\r\n        e.preventDefault();\r\n        if (window.assignmentDataTable) {\r\n            window.assignmentDataTable.ajax.reload(function () {\r\n                updateLastUpdateTime();\r\n            }, false);\r\n        }\r\n    });\r\n\r\n    // –ö–Ω–æ–ø–∫–∞ \"–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º\"\r\n    $(document).on('click', '#fullscreen-toggle', function (e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        const $container = $('.modern-datatable-container');\r\n        const $icon = $(this).find('i');\r\n\r\n        if (!$container.hasClass('fullscreen-mode')) {\r\n            $container.addClass('fullscreen-mode');\r\n            $('body').addClass('datatable-fullscreen');\r\n            $icon.removeClass('fa-expand').addClass('fa-compress');\r\n\r\n            $container.css({\r\n                'position': 'fixed',\r\n                'top': '0',\r\n                'left': '0',\r\n                'right': '0',\r\n                'bottom': '0',\r\n                'z-index': '1040',\r\n                'background': '#fff'\r\n            });\r\n\r\n            if (window.assignmentDataTable) {\r\n                setTimeout(function () {\r\n                    window.assignmentDataTable.columns.adjust().draw();\r\n                }, 200);\r\n            }\r\n        } else {\r\n            $container.removeClass('fullscreen-mode');\r\n            $('body').removeClass('datatable-fullscreen');\r\n            $icon.removeClass('fa-compress').addClass('fa-expand');\r\n\r\n            $container.css({\r\n                'position': '',\r\n                'top': '',\r\n                'left': '',\r\n                'right': '',\r\n                'bottom': '',\r\n                'z-index': '',\r\n                'background': ''\r\n            });\r\n\r\n            if (window.assignmentDataTable) {\r\n                setTimeout(function () {\r\n                    window.assignmentDataTable.columns.adjust();\r\n                    window.assignmentDataTable.draw();\r\n                }, 300);\r\n            }\r\n        }\r\n    });\r\n\r\n    // –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π –≤ —Å—Ç—Ä–æ–∫–µ\r\n    $(document).on('click', '.btn-view-assignment', function (e) {\r\n        e.preventDefault();\r\n        const assignmentId = $(this).data('assignment-id');\r\n        // –ï—Å–ª–∏ –µ—Å—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ ‚Äî —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ:\r\n        // window.location.href = `/Assignment/Card/${assignmentId}`;\r\n        showMessage('info', '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', '–ü–µ—Ä–µ—Ö–æ–¥ –∫ –∫–∞—Ä—Ç–æ—á–∫–µ –∑–∞–¥–∞—á–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω');\r\n    });\r\n\r\n    $(document).on('click', '.btn-edit-assignment', function (e) {\r\n        e.preventDefault();\r\n        const assignmentId = $(this).data('assignment-id');\r\n        openEditAssignment(assignmentId);\r\n    });\r\n\r\n    $(document).on('click', '.btn-delete-assignment', function (e) {\r\n        e.preventDefault();\r\n        const assignmentId = $(this).data('assignment-id');\r\n        deleteAssignment(assignmentId);\r\n    });\r\n\r\n    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞–±–ª–∏—Ü—ã\r\n    $('#apply-settings').on('click', function () {\r\n        const pageLength = $('#page-length-setting').val();\r\n        const autoRefresh = $('#auto-refresh-setting').is(':checked');\r\n        const compactMode = $('#compact-mode-setting').is(':checked');\r\n\r\n        if (window.assignmentDataTable) {\r\n            $('#table').toggleClass('table-sm', compactMode);\r\n\r\n            const settings = {\r\n                pageLength: pageLength,\r\n                autoRefresh: autoRefresh,\r\n                compactMode: compactMode\r\n            };\r\n            localStorage.setItem('assignmentTableSettings', JSON.stringify(settings));\r\n\r\n            window.assignmentDataTable.page.len(pageLength === '-1' ? -1 : parseInt(pageLength)).draw();\r\n\r\n            if (autoRefresh) {\r\n                startAssignmentAutoRefresh();\r\n            } else {\r\n                stopAssignmentAutoRefresh();\r\n            }\r\n        }\r\n\r\n        $('#table-settings-modal').modal('hide');\r\n    });\r\n\r\n    // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏\r\n    $(document).on('keydown', function (e) {\r\n        if (!$(e.target).is('input, textarea, select')) {\r\n            if (e.ctrlKey && e.key === 'n') {\r\n                e.preventDefault();\r\n                $('#add-assignment').click();\r\n            } else if (e.key === 'F5') {\r\n                e.preventDefault();\r\n                $('#reload-data').click();\r\n            } else if (e.key === 'F11') {\r\n                e.preventDefault();\r\n                $('#fullscreen-toggle').click();\r\n            } else if (e.key === 'Escape' && $('.modern-datatable-container').hasClass('fullscreen-mode')) {\r\n                e.preventDefault();\r\n                $('#fullscreen-toggle').click();\r\n            }\r\n        }\r\n    });\r\n\r\n    console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');\r\n    console.log('DataTable instance:', window.assignmentDataTable);\r\n    console.log('AJAX URL:', window.assignmentDataTable?.ajax?.url());\r\n});\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/wwwroot/js/assignment.js b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/wwwroot/js/assignment.js
--- a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/wwwroot/js/assignment.js	(revision 1f8fee95001fe8134ec947ef163da438a8a34e5a)
+++ b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/wwwroot/js/assignment.js	(date 1756985461991)
@@ -3,7 +3,6 @@
     –í–µ—Ä—Å–∏—è: 1.0.0
 */
 
-// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫
 console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫:');
 console.log('jQuery:', typeof $ !== 'undefined' ? '–ó–∞–≥—Ä—É–∂–µ–Ω' : '–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
 console.log('DataTables:', typeof $.fn.DataTable !== 'undefined' ? '–ó–∞–≥—Ä—É–∂–µ–Ω' : '–ù–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
@@ -11,7 +10,6 @@
     console.log('DataTables –≤–µ—Ä—Å–∏—è:', $.fn.dataTable.version);
 }
 
-// –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
 function showMessage(type, title, message) {
     if (window.malomalsky?.message?.[type] && typeof window.malomalsky.message[type] === 'function') {
         try {
@@ -42,7 +40,6 @@
     }
 }
 
-// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API –∏ –º–∞–ø–ø–∏–Ω–≥ –∫–æ–ª–æ–Ω–æ–∫ DataTables
 const ASSIGNMENT_API = {
     listActive: '/api/assignments/active',   // POST
     createOrUpdate: '/api/assignments',      // POST (Create/Update)
@@ -51,23 +48,7 @@
     modalEdit: (id) => `/Assignment/modal/edit?id=${id}` // GET (PartialView)
 };
 
-// –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –ø–æ–ª–µ–π –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∫ —Å—Ç–æ–ª–±—Ü–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –≤–∏–¥–∏—Ç–µ –≤ Razor-—Ä–∞–∑–º–µ—Ç–∫–µ
-// –ó–∞–≥–æ–ª–æ–≤–∫–∏ (–ø–æ –ø–æ—Ä—è–¥–∫—É):
-//  0: ID
-//  1: –î–∞—Ç–∞ –ø—Ä–∏–µ–º–∞ –∑–∞—è–≤–∫–∏ –æ—Ç –æ—Ç–¥–µ–ª–µ–Ω–∏—è
-//  2: –ù–æ–º–µ—Ä –æ—Ç–¥–µ–ª–µ–Ω–∏—è
-//  3: –û–ø–∏—Å–∞–Ω–∏–µ
-//  4: –î–∞—Ç–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
-//  5: –ö—É–¥–∞ –Ω–∞–ø—Ä–∞–≤–∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã
-//  6: –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ
-//  7: –î–∞—Ç–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ
-//  8: –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å
-//  9: –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ
-// 10: –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
-// 11: –ü–∞—Ü–∏–µ–Ω—Ç
-//
-// –ù–∏–∂–µ —É–∫–∞–∂–∏—Ç–µ –∏–º–µ–Ω–∞ –ø–æ–ª–µ–π –∏–∑ JSON, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä.
-// –ü—Ä–∏–º–µ—Ä —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –±–∞–∑–µ —Ä–∞–Ω–µ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ (+ –≤–µ—Ä–æ—è—Ç–Ω—ã–µ –ø–æ–ª—è –¥–æ–º–µ–Ω–∞):
+
 const COLUMNS_MAP = {
     id: 'id',
     acceptDate: 'acceptDate',                     // –î–∞—Ç–∞ –ø—Ä–∏–µ–º–∞ –∑–∞—è–≤–∫–∏ –æ—Ç –æ—Ç–¥–µ–ª–µ–Ω–∏—è
@@ -107,7 +88,6 @@
     $('#records-badge').text(count || 0);
 }
 
-// –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö
 let assignmentAutoRefreshInterval;
 let assignmentSubmitInProgress = false;
 function startAssignmentAutoRefresh() {
@@ -127,11 +107,9 @@
     }
 }
 
-// –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã –∑–∞–¥–∞—á (–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ, —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –≤–∫–ª–∞–¥–æ–∫)
 function ensureAssignmentTableInitialized(forceReload = false) {
     const tableExistsInDom = $('#table').length > 0;
 
-    // –£–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ ‚Äî –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º—è–≥–∫–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–º
     if (window.assignmentDataTable && $.fn.DataTable.isDataTable('#table')) {
         if (forceReload) {
             window.assignmentDataTable.ajax.reload(null, false);
@@ -139,7 +117,6 @@
         return;
     }
 
-    // –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü—ã –µ—â—ë –Ω–µ—Ç –≤ DOM ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏ –ø–æ–∫–∞–∑–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –≤–∫–ª–∞–¥–∫–∏
     if (!tableExistsInDom) {
         $(document)
             .off('shown.bs.tab.assignment', 'a[data-bs-toggle="tab"]')
@@ -152,12 +129,10 @@
         return;
     }
 
-    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å
     const dt = initializeAssignmentDataTable();
     if (dt) startAssignmentAutoRefresh();
 }
 
-// –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã –∑–∞–¥–∞—á (–æ–¥–∏–Ω —Ä–∞–∑)
 function ensureAssignmentTableInitialized(forceReload = false) {
     const tableExistsInDom = $('#table').length > 0;
 
@@ -169,9 +144,7 @@
         return;
     }
 
-    // –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü—ã –µ—â—ë –Ω–µ—Ç –≤ DOM ‚Äî –ø–æ–¥–æ–∂–¥—ë–º —Å–æ–±—ã—Ç–∏—è –ø–æ–∫–∞–∑–∞ —Ç–∞–±–∞
     if (!tableExistsInDom) {
-        // –ü–æ–¥—Ü–µ–ø–∏–º—Å—è –∫ —Å–æ–±—ã—Ç–∏—é Bootstrap —Ç–∞–±–æ–≤ ‚Äî –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ–∫–∞–∑–µ –ø–æ–ø—Ä–æ–±—É–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å
         $(document).off('shown.assignment.tab', 'a[data-bs-toggle="tab"]').on('shown.assignment.tab', 'a[data-bs-toggle="tab"]', function () {
             if ($('#table').length > 0 && !$.fn.DataTable.isDataTable('#table')) {
                 const dt = initializeAssignmentDataTable();
@@ -181,12 +154,10 @@
         return;
     }
 
-    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å
     const dt = initializeAssignmentDataTable();
     if (dt) startAssignmentAutoRefresh();
 }
 
-// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
 function loadAssignmentSettings() {
     const savedSettings = localStorage.getItem('assignmentTableSettings');
     if (savedSettings) {
@@ -202,7 +173,6 @@
     }
 }
 
-// –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
 function openCreateAssignment(patientId) {
     const url = patientId ? (ASSIGNMENT_API.modalCreate + '?patientId=' + encodeURIComponent(patientId))
         : ASSIGNMENT_API.modalCreate;
@@ -256,7 +226,17 @@
                     window.assignmentDataTable.ajax.reload();
                 }
             }).fail(function (xhr) {
-                showMessage('error', '–û—à–∏–±–∫–∞', '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏.');
+                let msg = '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏.';
+                try {
+                    // –ü—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ JSON-–æ—Ç–≤–µ—Ç–∞ API
+                    const json = xhr.responseJSON || JSON.parse(xhr.responseText);
+                    msg = json?.message || json?.Message || json?.error || msg;
+                    // –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ ApiResponse<T>
+                    if (json && json.Success === false && json.Message) {
+                        msg = json.Message;
+                    }
+                } catch (_) { /* ignore parse errors */ }
+                showMessage('error', '–û—à–∏–±–∫–∞', msg);
             });
         }
     });
@@ -477,10 +457,86 @@
 table.dataTable td .dropdown-menu {
     z-index: 1061; /* –≤—ã—à–µ, —á–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π 1000 */
 }
+
+/* –ö–ª–∞—Å—Å –¥–ª—è –º–µ–Ω—é, –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤ body */
+.assignment-portalized-menu {
+    display: block !important;
+}
     `;
     document.head.appendChild(style);
 }
 
+// –ü–µ—Ä–µ–Ω–æ—Å dropdown-–º–µ–Ω—é –≤ body –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∏ –≤–æ–∑–≤—Ä–∞—Ç –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
+function setupAssignmentDropdownPortal() {
+    // –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –¥—Ä–æ–ø–¥–∞—É–Ω–∞ –≤–Ω—É—Ç—Ä–∏ #table
+    $(document)
+        .off('show.bs.dropdown.assignmentPortal', '#table .dropdown-toggle')
+        .on('show.bs.dropdown.assignmentPortal', '#table .dropdown-toggle', function () {
+            const $toggle = $(this);
+            const $menu = $toggle.siblings('.dropdown-menu');
+            if (!$menu.length) return;
+
+            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ä–æ–¥–∏—Ç–µ–ª—è –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –º–µ–Ω—é
+            const $originalParent = $menu.parent();
+            $menu.data('assignment-original-parent', $originalParent);
+            $toggle.data('assignment-portal-menu', $menu);
+
+            // –ü–µ—Ä–µ–Ω–æ—Å–∏–º –º–µ–Ω—é –≤ body
+            $('body').append($menu.detach());
+            $menu.addClass('assignment-portalized-menu');
+
+            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –º–µ–Ω—é —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø–æ –∫–Ω–æ–ø–∫–µ
+            function reposition() {
+                const rect = $toggle[0].getBoundingClientRect();
+                const menuWidth = $menu.outerWidth();
+                const viewportWidth = window.innerWidth || document.documentElement.clientWidth;
+
+                let left = rect.left;
+                if (left + menuWidth > viewportWidth - 8) {
+                    left = Math.max(8, viewportWidth - menuWidth - 8);
+                }
+                const top = rect.bottom; // –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤–Ω–∏–∑
+
+                $menu.css({
+                    position: 'fixed',
+                    top: Math.round(top) + 'px',
+                    left: Math.round(left) + 'px',
+                    transform: 'none',
+                    zIndex: 1080
+                });
+            }
+
+            $menu.data('assignment-reposition', reposition);
+            reposition();
+
+            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ –∏ —Ä–µ—Å–∞–π–∑–µ
+            $(window).on('scroll.assignmentPortal resize.assignmentPortal', reposition);
+        })
+        .off('hidden.bs.dropdown.assignmentPortal', '#table .dropdown-toggle')
+        .on('hidden.bs.dropdown.assignmentPortal', '#table .dropdown-toggle', function () {
+            const $toggle = $(this);
+            const $menu = $toggle.data('assignment-portal-menu');
+            $(window).off('scroll.assignmentPortal resize.assignmentPortal');
+
+            if ($menu && $menu.length) {
+                const $originalParent = $menu.data('assignment-original-parent');
+                $menu.removeAttr('style')
+                     .removeClass('assignment-portalized-menu')
+                     .removeData('assignment-original-parent')
+                     .removeData('assignment-reposition');
+
+                if ($originalParent && $originalParent.length) {
+                    $originalParent.append($menu.detach());
+                } else {
+                    // Fallback ‚Äî –≤–µ—Ä–Ω—É—Ç—å —Ä—è–¥–æ–º —Å –∫–Ω–æ–ø–∫–æ–π
+                    $toggle.parent().append($menu.detach());
+                }
+
+                $toggle.removeData('assignment-portal-menu');
+            }
+        });
+}
+
 // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
 $(document).ready(function () {
     console.log('Document ready: assignment.js');
@@ -497,6 +553,9 @@
     // –ò–Ω–∂–µ–∫—Ç–∏–º CSS-—Ñ–∏–∫—Å –¥–ª—è dropdown –≤–Ω—É—Ç—Ä–∏ —Ç–∞–±–ª–∏—Ü—ã
     injectAssignmentDropdownFixStyles();
 
+    // –í–∫–ª—é—á–∞–µ–º –ø–æ—Ä—Ç–∞–ª–∏–∑–∞—Ü–∏—é dropdown-–º–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π
+    setupAssignmentDropdownPortal();
+
     // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
     loadAssignmentSettings();
     updateConnectionStatus();
@@ -597,6 +656,71 @@
             }
         });
     });
+
+    // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É (PATCH)
+    $(document).off('submit.assignment', '#edit-assignment-form').on('submit.assignment', '#edit-assignment-form', function (e) {
+        e.preventDefault();
+
+        const $form = $(this);
+        const url = $form.attr('action'); // /api/assignments/{id}
+
+        if (window.AddAssignmentFormValidation) {
+            AddAssignmentFormValidation.clearValidationErrors();
+        }
+
+        const formData = new FormData($form[0]);
+        const data = new URLSearchParams();
+        for (const pair of formData.entries()) {
+            data.append(pair[0], pair[1]);
+        }
+
+        const headers = {
+            "CSRF-TOKEN": $form.find('input[name="__RequestVerificationToken"]').val()
+        };
+
+        $.ajax({
+            url: url,
+            type: 'PATCH',
+            data: data.toString(),
+            contentType: 'application/x-www-form-urlencoded',
+            headers: headers,
+            beforeSend: function () {
+                $("#form-modal").find(':submit').attr('disabled', true).html('<div class="spinner-border spinner-border-sm" role="status"></div>');
+            },
+            success: function () {
+                $('#form-modal').modal('hide');
+                showMessage('success', '–£—Å–ø–µ—à–Ω–æ', '–ó–∞–¥–∞—á–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
+
+                ensureAssignmentTableInitialized(true);
+                if (window.assignmentDataTable) {
+                    window.assignmentDataTable.ajax.reload(null, false);
+                }
+            },
+            error: function (xhr) {
+                $("#form-modal").find(':submit').html('–°–æ—Ö—Ä–∞–Ω–∏—Ç—å').attr('disabled', false);
+
+                if (xhr.status === 400) {
+                    try {
+                        const response = JSON.parse(xhr.responseText);
+
+                        if (Array.isArray(response)) {
+                            AddAssignmentFormValidation.showValidationErrors(response);
+                            return;
+                        }
+                        if (response && response.Data && Array.isArray(response.Data.Errors)) {
+                            AddAssignmentFormValidation.showValidationErrors(response.Data.Errors);
+                            return;
+                        }
+                    } catch (parseError) {
+                        console.log('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç —Å –æ—à–∏–±–∫–∞–º–∏:', parseError);
+                    }
+                }
+
+                const errorMessage = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏';
+                showMessage('error', '–û—à–∏–±–∫–∞', errorMessage);
+            }
+        });
+    });
 
     // –û—á–∏—Å—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ
     $(document).on('input focus', '.form-control.is-invalid, .form-select.is-invalid', function () {
Index: src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/ViewModels/Assignment/CreateAssignmentViewModel.cs
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>namespace CRM.SocialDepartment.Site.ViewModels.Assignment;\r\n\r\nusing System.ComponentModel;\r\nusing System.ComponentModel.DataAnnotations;\r\n\r\npublic class CreateAssignmentViewModel : IValidatableObject\r\n{\r\n    public Guid Id { get; set; }\r\n\r\n    public int DepartmentNumber { get; set; }\r\n\r\n    [Required(ErrorMessage = \"–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è\")]\r\n    [DisplayName(\"–ù–∞–∑–≤–∞–Ω–∏–µ\")]\r\n    public string Name { get; set; } = string.Empty;\r\n\r\n    [Required(ErrorMessage = \"–î–∞—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è\")]\r\n    [DisplayName(\"–î–∞—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∏—è –∑–∞–¥–∞–Ω–∏—è\")]\r\n    [DisplayFormat(DataFormatString = \"{0:dd.MM.yyyy}\", ApplyFormatInEditMode = true)]\r\n    public DateTime AcceptDate { get; set; }\r\n\r\n    [Required(ErrorMessage = \"–û–ø–∏—Å–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è\")]\r\n    [DisplayName(\"–û–ø–∏—Å–∞–Ω–∏–µ\")]\r\n    public string Description { get; set; } = string.Empty;\r\n\r\n    [Required(ErrorMessage = \"–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è\")]\r\n    [DisplayName(\"–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å\")]\r\n    public string Assignee { get; set; } = string.Empty;\r\n\r\n    [Required(ErrorMessage = \"–ü–∞—Ü–∏–µ–Ω—Ç –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è\")]\r\n    [DisplayName(\"–ü–∞—Ü–∏–µ–Ω—Ç\")]\r\n    public Guid PatientId { get; set; }\r\n\r\n    public string? Note { get; set; }\r\n\r\n    public IEnumerable<ValidationResult> Validate(ValidationContext validationContext)\r\n    {\r\n        var resultList = new List<ValidationResult>();\r\n\r\n        if (string.IsNullOrEmpty(Name))\r\n            resultList.Add(new(\"–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º\", [nameof(Name)]));\r\n        if (string.IsNullOrEmpty(Description))\r\n            resultList.Add(new(\"–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º\", [nameof(Description)]));\r\n        if (string.IsNullOrEmpty(Assignee))\r\n            resultList.Add(new(\"–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å\", [nameof(Assignee)]));\r\n        if (PatientId == Guid.Empty)\r\n            resultList.Add(new(\"–ü–∞—Ü–∏–µ–Ω—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω\", [nameof(PatientId)]));\r\n\r\n        return resultList;\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/ViewModels/Assignment/CreateAssignmentViewModel.cs b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/ViewModels/Assignment/CreateAssignmentViewModel.cs
--- a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/ViewModels/Assignment/CreateAssignmentViewModel.cs	(revision 1f8fee95001fe8134ec947ef163da438a8a34e5a)
+++ b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/ViewModels/Assignment/CreateAssignmentViewModel.cs	(date 1756982227192)
@@ -18,6 +18,17 @@
     [DisplayFormat(DataFormatString = "{0:dd.MM.yyyy}", ApplyFormatInEditMode = true)]
     public DateTime AcceptDate { get; set; }
 
+    [DisplayName("–î–∞—Ç–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è")]
+    [DisplayFormat(DataFormatString = "{0:dd.MM.yyyy}", ApplyFormatInEditMode = true)]
+    public DateTime? ForwardDate { get; set; }
+
+    [DisplayName("–ö—É–¥–∞ –Ω–∞–ø—Ä–∞–≤–∏–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã")]
+    public string? ForwardDepartment { get; set; } = string.Empty;
+
+    [DisplayName("–î–∞—Ç–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ")]
+    [DisplayFormat(DataFormatString = "{0:dd.MM.yyyy}", ApplyFormatInEditMode = true)]
+    public DateTime? DepartmentForwardDate { get; set; }
+
     [Required(ErrorMessage = "–û–ø–∏—Å–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è")]
     [DisplayName("–û–ø–∏—Å–∞–Ω–∏–µ")]
     public string Description { get; set; } = string.Empty;
Index: src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/MappingProfile/ProjectMappingProfile.cs
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>using AutoMapper;\r\nusing CRM.SocialDepartment.Application.DTOs;\r\nusing CRM.SocialDepartment.Domain.Entities;\r\nusing CRM.SocialDepartment.Domain.Entities.Patients;\r\nusing CRM.SocialDepartment.Domain.Entities.Patients.Documents;\r\nusing CRM.SocialDepartment.Infrastructure.DataAccess.MongoDb.Data;\r\nusing CRM.SocialDepartment.Site.Models.Patient;\r\nusing CRM.SocialDepartment.Site.ViewModels.Assignment;\r\nusing CRM.SocialDepartment.Site.ViewModels.Patient;\r\nusing CRM.SocialDepartment.Site.ViewModels.User;\r\nusing CRM.SocialDepartment.Site.ViewModels.Role;\r\nusing CRM.SocialDepartment.Site.ViewModels.UserActivityLog;\r\n\r\nnamespace CRM.SocialDepartment.Site.MappingProfile\r\n{\r\n    public class ProjectMappingProfile : Profile\r\n    {\r\n        public ProjectMappingProfile()\r\n        {\r\n            // Patient //////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<CreatePatientViewModel, CreatePatientDTO>()\r\n                .ForMember(dest => dest.Birthday, opt => opt.MapFrom(src => \r\n                    DateTime.SpecifyKind(src.Birthday, DateTimeKind.Utc)))\r\n                .ForMember(dest => dest.Documents, opt => opt.MapFrom(src =>\r\n                    src.Documents.ToDictionary(\r\n                        kvp => kvp.Key,\r\n                        kvp => new DocumentDTO\r\n                        {\r\n                            Type = kvp.Key,\r\n                            // –°–µ–ª–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤\r\n                            Number = FormatDocumentNumber(kvp.Key, kvp.Value.Number)\r\n                        }\r\n                    )))\r\n                // –í–ê–ñ–ù–û: –ï—Å–ª–∏ –ø–∞—Ü–∏–µ–Ω—Ç –ù–ï –ø–æ–ª—É—á–∞–µ—Ç –ø–µ–Ω—Å–∏—é, —Ç–æ –¥–∞–Ω–Ω—ã–µ –æ –ø–µ–Ω—Å–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å null\r\n                .ForMember(dest => dest.Pension, opt => opt.MapFrom(src => \r\n                    src.ReceivesPension ? src.Pension : null))\r\n                // –í–ê–ñ–ù–û: –ï—Å–ª–∏ –ø–∞—Ü–∏–µ–Ω—Ç –¥–µ–µ—Å–ø–æ—Å–æ–±–µ–Ω, —Ç–æ Capable –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å null\r\n                .ForMember(dest => dest.Capable, opt => opt.MapFrom(src => \r\n                    src.IsCapable ? null : src.Capable))\r\n                // –í–ê–ñ–ù–û: –ü–µ—Ä–µ–¥–∞–µ–º ReceivesPension –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏\r\n                .ForMember(dest => dest.ReceivesPension, opt => opt.MapFrom(src => src.ReceivesPension));\r\n\r\n            CreateMap<EditPatientViewModel, EditPatientDTO>()\r\n                //.ForMember(dest => dest.Birthday, opt => opt.MapFrom(src => \r\n                //    DateTime.SpecifyKind(src.Birthday, DateTimeKind.Utc)))\r\n                .ForMember(dest => dest.Documents, opt => opt.MapFrom(src =>\r\n                    src.Documents.ToDictionary(\r\n                        kvp => kvp.Key,\r\n                        kvp => new DocumentDTO\r\n                        {\r\n                            Type = kvp.Key,\r\n                            // –°–µ–ª–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤\r\n                            Number = FormatDocumentNumber(kvp.Key, kvp.Value.Number)\r\n                        }\r\n                    )));\r\n\r\n            CreateMap<Patient, EditPatientDTO>()\r\n                .ForMember(dest => dest.FullName, opt => opt.MapFrom(src => src.FullName))\r\n                //.ForMember(dest => dest.Birthday, opt => opt.MapFrom(src => \r\n                //    DateTime.SpecifyKind(src.Birthday, DateTimeKind.Utc)))\r\n                .ForMember(dest => dest.ActiveMedicalHistory, opt => opt.MapFrom(src => new MedicalHistoryDTO\r\n                {\r\n                    NumberDepartment = (sbyte)(src.ActiveHistory != null ? src.ActiveHistory.NumberDepartment : 0),\r\n                    HospitalizationType = new HospitalizationTypeDTO\r\n                    {\r\n                        Value = (byte)(src.ActiveHistory != null && src.ActiveHistory.HospitalizationType != null ? src.ActiveHistory.HospitalizationType.Value : 0),\r\n                        DisplayName = src.ActiveHistory != null && src.ActiveHistory.HospitalizationType != null ? src.ActiveHistory.HospitalizationType.DisplayName : string.Empty\r\n                    },\r\n                    Resolution = src.ActiveHistory != null ? src.ActiveHistory.Resolution : string.Empty,\r\n                    NumberDocument = src.ActiveHistory != null ? src.ActiveHistory.NumberDocument : string.Empty,\r\n                    DateOfReceipt = src.ActiveHistory != null ? DateTime.SpecifyKind(src.ActiveHistory.DateOfReceipt, DateTimeKind.Utc) : DateTime.MinValue,\r\n                    DateOfDischarge = src.ActiveHistory != null && src.ActiveHistory.DateOfDischarge.HasValue ? DateTime.SpecifyKind(src.ActiveHistory.DateOfDischarge.Value, DateTimeKind.Utc) : null,\r\n                    Note = src.ActiveHistory != null ? src.ActiveHistory.Note : null\r\n                }))\r\n                .ForMember(dest => dest.CitizenshipInfo, opt => opt.MapFrom(src => new CitizenshipInfoDTO\r\n                {\r\n                    Citizenship = src.CitizenshipInfo != null ? src.CitizenshipInfo.Citizenship : CitizenshipType.RussianFederation,\r\n                    Country = src.CitizenshipInfo != null ? src.CitizenshipInfo.Country : string.Empty,\r\n                    Registration = src.CitizenshipInfo != null ? src.CitizenshipInfo.Registration : string.Empty,\r\n                    EarlyRegistration = src.CitizenshipInfo != null ? src.CitizenshipInfo.EarlyRegistration : null,\r\n                    PlaceOfBirth = src.CitizenshipInfo != null ? src.CitizenshipInfo.PlaceOfBirth : null,\r\n                    DocumentAttached = src.CitizenshipInfo != null ? src.CitizenshipInfo.DocumentAttached : null\r\n                }))\r\n                .ForMember(dest => dest.Documents, opt => opt.MapFrom(src => \r\n                    src.Documents.ToDictionary(\r\n                        kvp => kvp.Key,\r\n                        kvp => new DocumentDTO\r\n                        {\r\n                            Type = kvp.Key,\r\n                            Number = ExtractDocumentNumber(kvp.Value)\r\n                        }\r\n                    )))\r\n                .ForMember(dest => dest.Capable, opt => opt.MapFrom(src => src.Capable != null ? new EditCapableDTO\r\n                {\r\n                    Guardian = src.Capable.Guardian != null ? src.Capable.Guardian : string.Empty,\r\n                    GuardianOrderAppointment = src.Capable.GuardianOrderAppointment != null ? src.Capable.GuardianOrderAppointment : string.Empty\r\n                } : null))\r\n                .ForMember(dest => dest.Pension, opt => opt.MapFrom(src => src.Pension != null ? new PensionDTO\r\n                {\r\n                    DisabilityGroup = src.Pension.DisabilityGroup,\r\n                    PensionStartDateTime = src.Pension.PensionStartDateTime.HasValue ? DateTime.SpecifyKind(src.Pension.PensionStartDateTime.Value, DateTimeKind.Utc) : null,\r\n                    PensionAddress = src.Pension.PensionAddress,\r\n                    SfrBranch = src.Pension.SfrBranch,\r\n                    SfrDepartment = src.Pension.SfrDepartment,\r\n                    Rsd = src.Pension.Rsd\r\n                } : null))\r\n                .ForMember(dest => dest.Note, opt => opt.MapFrom(src => src.Note));\r\n\r\n            CreateMap<Patient, CreatePatientDTO>()\r\n                .ForMember(dest => dest.FullName, opt => opt.MapFrom(src => src.FullName))\r\n                .ForMember(dest => dest.Birthday, opt => opt.MapFrom(src => \r\n                    DateTime.SpecifyKind(src.Birthday, DateTimeKind.Utc)))\r\n                .ForMember(dest => dest.MedicalHistory, opt => opt.MapFrom(src => new MedicalHistoryDTO\r\n                {\r\n                    NumberDepartment = (sbyte)(src.ActiveHistory != null ? src.ActiveHistory.NumberDepartment : 0),\r\n                    HospitalizationType = new HospitalizationTypeDTO\r\n                    {\r\n                        Value = (byte)(src.ActiveHistory != null && src.ActiveHistory.HospitalizationType != null ? src.ActiveHistory.HospitalizationType.Value : 0),\r\n                        DisplayName = src.ActiveHistory != null && src.ActiveHistory.HospitalizationType != null ? src.ActiveHistory.HospitalizationType.DisplayName : string.Empty\r\n                    },\r\n                    Resolution = src.ActiveHistory != null ? src.ActiveHistory.Resolution : string.Empty,\r\n                    NumberDocument = src.ActiveHistory != null ? src.ActiveHistory.NumberDocument : string.Empty,\r\n                    DateOfReceipt = src.ActiveHistory != null ? DateTime.SpecifyKind(src.ActiveHistory.DateOfReceipt, DateTimeKind.Utc) : DateTime.MinValue,\r\n                    DateOfDischarge = src.ActiveHistory != null && src.ActiveHistory.DateOfDischarge.HasValue ? DateTime.SpecifyKind(src.ActiveHistory.DateOfDischarge.Value, DateTimeKind.Utc) : null,\r\n                    Note = src.ActiveHistory != null ? src.ActiveHistory.Note : null\r\n                }))\r\n                .ForMember(dest => dest.CitizenshipInfo, opt => opt.MapFrom(src => new CitizenshipInfoDTO\r\n                {\r\n                    Citizenship = src.CitizenshipInfo != null ? src.CitizenshipInfo.Citizenship : CitizenshipType.RussianFederation,\r\n                    Country = src.CitizenshipInfo != null ? src.CitizenshipInfo.Country : string.Empty,\r\n                    Registration = src.CitizenshipInfo != null ? src.CitizenshipInfo.Registration : string.Empty,\r\n                    EarlyRegistration = src.CitizenshipInfo != null ? src.CitizenshipInfo.EarlyRegistration : null,\r\n                    PlaceOfBirth = src.CitizenshipInfo != null ? src.CitizenshipInfo.PlaceOfBirth : null,\r\n                    DocumentAttached = src.CitizenshipInfo != null ? src.CitizenshipInfo.DocumentAttached : null\r\n                }))\r\n                .ForMember(dest => dest.Documents, opt => opt.MapFrom(src => \r\n                    src.Documents.ToDictionary(\r\n                        kvp => kvp.Key,\r\n                        kvp => new DocumentDTO\r\n                        {\r\n                            Type = kvp.Key,\r\n                            Number = ExtractDocumentNumber(kvp.Value)\r\n                        }\r\n                    )))\r\n                .ForMember(dest => dest.IsCapable, opt => opt.MapFrom(src => src.IsCapable))\r\n                .ForMember(dest => dest.Capable, opt => opt.MapFrom(src => src.Capable != null ? new CreateCapableDTO\r\n                {\r\n                    CourtDecision = src.Capable.CourtDecision != null ? src.Capable.CourtDecision : string.Empty,\r\n                    TrialDate = src.Capable.TrialDate.HasValue ? DateTime.SpecifyKind(src.Capable.TrialDate.Value, DateTimeKind.Utc) : null,\r\n                    Guardian = src.Capable.Guardian != null ? src.Capable.Guardian : string.Empty,\r\n                    GuardianOrderAppointment = src.Capable.GuardianOrderAppointment != null ? src.Capable.GuardianOrderAppointment : string.Empty\r\n                } : null))\r\n                .ForMember(dest => dest.ReceivesPension, opt => opt.MapFrom(src => src.ReceivesPension))\r\n                .ForMember(dest => dest.Pension, opt => opt.MapFrom(src => src.Pension != null ? new PensionDTO\r\n                {\r\n                    DisabilityGroup = src.Pension.DisabilityGroup,\r\n                    PensionStartDateTime = src.Pension.PensionStartDateTime.HasValue ? DateTime.SpecifyKind(src.Pension.PensionStartDateTime.Value, DateTimeKind.Utc) : null,\r\n                    PensionAddress = src.Pension.PensionAddress,\r\n                    SfrBranch = src.Pension.SfrBranch,\r\n                    SfrDepartment = src.Pension.SfrDepartment,\r\n                    Rsd = src.Pension.Rsd\r\n                } : null))\r\n                .ForMember(dest => dest.Note, opt => opt.MapFrom(src => src.Note));\r\n\r\n            //–ü–æ –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º, –ø—Ä–æ—Ü–µ—Å—Å –º–∞–ø–ø–∏–Ω–≥–∞ –∏–∑ DTO -> Entity, –¥–æ–ª–∂–µ–Ω –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å—Å—è –≤ —Ä—É—á–Ω—É—é.\r\n            //CreateMap<EditPatientDTO, Patient>()\r\n            //.ForMember(dest => dest.Documents, opt => opt.MapFrom(src => \r\n            //    src.Documents.ToDictionary(\r\n            //        kvp => kvp.Key,\r\n            //        kvp => DocumentFactory.Create(\r\n            //            kvp.Value.Type,\r\n            //            kvp.Value.Number\r\n            //        )\r\n            //    )));\r\n\r\n            CreateMap<EditPatientViewModel, EditPatientDTO>();\r\n            CreateMap<CreateUserViewModel, CreateUserDTO>();\r\n            CreateMap<EditUserViewModel, CreateUserDTO>();\r\n            CreateMap<IUser, UserDTO>();\r\n            CreateMap<ApplicationUser, UserDTO>();\r\n            CreateMap<CreateAssignmentViewModel, CreateOrEditAssignmentDto>();\r\n            \r\n            // –ú–∞–ø–ø–∏–Ω–≥ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\r\n            CreateMap<ApplicationUser, EditUserViewModel>()\r\n                .ForMember(dest => dest.UserName, opt => opt.MapFrom(src => src.UserName))\r\n                .ForMember(dest => dest.FirstName, opt => opt.MapFrom(src => src.FirstName))\r\n                .ForMember(dest => dest.LastName, opt => opt.MapFrom(src => src.LastName))\r\n                .ForMember(dest => dest.Email, opt => opt.MapFrom(src => src.Email))\r\n                .ForMember(dest => dest.Role, opt => opt.MapFrom(src => src.Role))\r\n                .ForMember(dest => dest.Position, opt => opt.MapFrom(src => src.Position))\r\n                .ForMember(dest => dest.DepartmentNumber, opt => opt.MapFrom(src => src.DepartmentNumber))\r\n                .ForMember(dest => dest.Password, opt => opt.Ignore()) // –ü–∞—Ä–æ–ª—å –Ω–µ –º–∞–ø–ø–∏–º –∏–∑ –±–∞–∑—ã\r\n                .ForMember(dest => dest.ConfirmPassword, opt => opt.Ignore()); // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –Ω–µ –º–∞–ø–ø–∏–º –∏–∑ –±–∞–∑—ã\r\n                \r\n            CreateMap<UserDTO, EditUserViewModel>()\r\n                .ForMember(dest => dest.UserName, opt => opt.MapFrom(src => src.UserName))\r\n                .ForMember(dest => dest.FirstName, opt => opt.MapFrom(src => src.FirstName))\r\n                .ForMember(dest => dest.LastName, opt => opt.MapFrom(src => src.LastName))\r\n                .ForMember(dest => dest.Email, opt => opt.MapFrom(src => src.Email))\r\n                .ForMember(dest => dest.Role, opt => opt.MapFrom(src => src.Role))\r\n                .ForMember(dest => dest.Position, opt => opt.MapFrom(src => src.Position))\r\n                .ForMember(dest => dest.DepartmentNumber, opt => opt.MapFrom(src => src.DepartmentNumber))\r\n                .ForMember(dest => dest.Password, opt => opt.Ignore()) // –ü–∞—Ä–æ–ª—å –Ω–µ –º–∞–ø–ø–∏–º –∏–∑ DTO\r\n                .ForMember(dest => dest.ConfirmPassword, opt => opt.Ignore()); // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –Ω–µ –º–∞–ø–ø–∏–º –∏–∑ DTO\r\n\r\n            // –ú–∞–ø–ø–∏–Ω–≥ –¥–ª—è —Ä–æ–ª–µ–π\r\n            CreateMap<CreateRoleViewModel, CreateRoleDTO>()\r\n                .ForMember(dest => dest.Name, opt => opt.MapFrom(src => src.Name));\r\n            CreateMap<EditRoleViewModel, CreateRoleDTO>()\r\n                .ForMember(dest => dest.Name, opt => opt.MapFrom(src => src.Name));\r\n            CreateMap<IRole, RoleDTO>()\r\n                .ForMember(dest => dest.Id, opt => opt.MapFrom(src => Guid.Empty))\r\n                .ForMember(dest => dest.Name, opt => opt.MapFrom(src => src.Name))\r\n                .ForMember(dest => dest.NormalizedName, opt => opt.MapFrom(src => src.Name.ToUpperInvariant()))\r\n                .ForMember(dest => dest.CreatedOn, opt => opt.MapFrom(src => DateTime.UtcNow));\r\n            CreateMap<ApplicationRole, RoleDTO>()\r\n                .ForMember(dest => dest.Id, opt => opt.MapFrom(src => src.Id))\r\n                .ForMember(dest => dest.Name, opt => opt.MapFrom(src => src.Name))\r\n                .ForMember(dest => dest.NormalizedName, opt => opt.MapFrom(src => src.NormalizedName))\r\n                .ForMember(dest => dest.CreatedOn, opt => opt.MapFrom(src => src.CreatedOn));\r\n            CreateMap<RoleDTO, EditRoleViewModel>()\r\n                .ForMember(dest => dest.Id, opt => opt.MapFrom(src => src.Id))\r\n                .ForMember(dest => dest.Name, opt => opt.MapFrom(src => src.Name));\r\n\r\n            // –ú–∞–ø–ø–∏–Ω–≥ DTO –≤ ViewModels —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –¥–∞—Ç\r\n            CreateMap<CreatePatientDTO, CreatePatientViewModel>()\r\n                .ForMember(dest => dest.Birthday, opt => opt.MapFrom(src => \r\n                    DateTime.SpecifyKind(src.Birthday, DateTimeKind.Utc)));\r\n\r\n            CreateMap<EditPatientDTO, EditPatientViewModel>();\r\n                //.ForMember(dest => dest.Birthday, opt => opt.MapFrom(src => \r\n                //    DateTime.SpecifyKind(src.Birthday, DateTimeKind.Utc)));\r\n\r\n            // ‚ùó –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–´–ï –ú–ê–ü–ü–ò–ù–ì–ò –î–õ–Ø ViewModel -> DTO ‚ùó //\r\n            \r\n            // MedicalHistory (ViewModel) -> MedicalHistoryDTO\r\n            CreateMap<MedicalHistoryModel, MedicalHistoryDTO>()\r\n                .ForMember(dest => dest.DateOfReceipt, opt => opt.MapFrom(src => \r\n                    DateTime.SpecifyKind(src.DateOfReceipt, DateTimeKind.Utc)))\r\n                .ForMember(dest => dest.DateOfDischarge, opt => opt.MapFrom(src => \r\n                    src.DateOfDischarge.HasValue ? DateTime.SpecifyKind(src.DateOfDischarge.Value, DateTimeKind.Utc) : (DateTime?)null))\r\n                .ForMember(dest => dest.HospitalizationType, opt => opt.MapFrom(src => \r\n                    src.HospitalizationType != null \r\n                        ? new HospitalizationTypeDTO\r\n                        {\r\n                            Value = src.HospitalizationType.Value,\r\n                            DisplayName = src.HospitalizationType.DisplayName\r\n                        }\r\n                        : new HospitalizationTypeDTO  // –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\r\n                        {\r\n                            Value = 1,  // Force\r\n                            DisplayName = \"–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ\"\r\n                        }));\r\n\r\n            // CitizenshipInfo (ViewModel) -> CitizenshipInfoDTO\r\n            CreateMap<CitizenshipInfoModel, CitizenshipInfoDTO>()\r\n                .ForMember(dest => dest.Citizenship, opt => opt.MapFrom(src => \r\n                    src.Citizenship != null ? src.Citizenship : CitizenshipType.RussianFederation)) // –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é\r\n                .ForMember(dest => dest.Country, opt => opt.MapFrom(src => src.Country))\r\n                .ForMember(dest => dest.Registration, opt => opt.MapFrom(src => src.Registration))\r\n                .ForMember(dest => dest.EarlyRegistration, opt => opt.MapFrom(src => src.EarlyRegistration))\r\n                .ForMember(dest => dest.PlaceOfBirth, opt => opt.MapFrom(src => src.PlaceOfBirth))\r\n                .ForMember(dest => dest.DocumentAttached, opt => opt.MapFrom(src => src.DocumentAttached));\r\n\r\n            // Capable (ViewModel) -> CreateCapableDTO/EditCapableDTO\r\n            CreateMap<CapableModel, CreateCapableDTO>()\r\n                .ForMember(dest => dest.TrialDate, opt => opt.MapFrom(src => \r\n                    src.TrialDate.HasValue ? DateTime.SpecifyKind(src.TrialDate.Value, DateTimeKind.Utc) : (DateTime?)null));\r\n            CreateMap<CapableModel, EditCapableDTO>()\r\n                .ForMember(dest => dest.TrialDate, opt => opt.MapFrom(src => \r\n                    src.TrialDate.HasValue ? DateTime.SpecifyKind(src.TrialDate.Value, DateTimeKind.Utc) : (DateTime?)null));\r\n\r\n            // Pension (ViewModel) -> PensionDTO\r\n            CreateMap<PensionModel, PensionDTO>()\r\n                .ForMember(dest => dest.PensionStartDateTime, opt => opt.MapFrom(src => \r\n                    src.PensionStartDateTime.HasValue ? DateTime.SpecifyKind(src.PensionStartDateTime.Value, DateTimeKind.Utc) : (DateTime?)null));\r\n\r\n            // HospitalizationType //////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<byte, HospitalizationType>().ConvertUsing(value => HospitalizationType.FromValue(value));\r\n            CreateMap<HospitalizationType, byte>().ConvertUsing(hospitalizationType => hospitalizationType.Value);\r\n\r\n            // CitizenshipInfo ///////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<CitizenshipInfoDTO, CitizenshipInfo>().ReverseMap();\r\n\r\n            // CitizenshipType ///////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<byte, CitizenshipType>().ConvertUsing(value => CitizenshipType.FromValue(value));\r\n            CreateMap<CitizenshipType, byte>().ConvertUsing(citizenshipType => citizenshipType.Value);\r\n\r\n            // Capable //////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<CreateCapableDTO, Capable>()\r\n                .ConstructUsing(src => new Capable(\r\n                    src.CourtDecision,\r\n                    src.TrialDate.HasValue ? DateTime.SpecifyKind(src.TrialDate.Value, DateTimeKind.Utc) : null,\r\n                    src.Guardian,\r\n                    src.GuardianOrderAppointment));\r\n\r\n            CreateMap<EditCapableDTO, Capable>()\r\n                .ForMember(dest => dest.CourtDecision, opt => opt.Ignore())\r\n                .ForMember(dest => dest.TrialDate, opt => opt.Ignore())\r\n                .ConstructUsing((src, ctx) =>\r\n                {\r\n                    var existingCapable = ctx.Items[\"ExistingCapable\"] as Capable;\r\n                    return new Capable(\r\n                        existingCapable!.CourtDecision,\r\n                        existingCapable!.TrialDate.HasValue ? DateTime.SpecifyKind(existingCapable.TrialDate.Value, DateTimeKind.Utc) : null,\r\n                        src.Guardian,\r\n                        src.GuardianOrderAppointment);\r\n                });\r\n\r\n            // City //////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<byte, CityType>().ConvertUsing(value => CityType.FromValue(value));\r\n            CreateMap<CityType, byte>().ConvertUsing(city => city.Value);\r\n\r\n            // DisabilityGroup ///////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<byte, DisabilityGroupType>().ConvertUsing(value => DisabilityGroupType.FromValue(value));\r\n            CreateMap<DisabilityGroupType, byte>().ConvertUsing(disabilityGroup => disabilityGroup.Value);\r\n\r\n            // Pension ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<PensionDTO, Pension>()\r\n                .ForMember(dest => dest.PensionStartDateTime, opt => opt.MapFrom(src => \r\n                    src.PensionStartDateTime.HasValue ? DateTime.SpecifyKind(src.PensionStartDateTime.Value, DateTimeKind.Utc) : (DateTime?)null));\r\n\r\n            // PensionAddress ////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<byte, PensionAddressType>().ConvertUsing(value => PensionAddressType.FromValue(value));\r\n            CreateMap<PensionAddressType, byte>().ConvertUsing(pensionAddress => pensionAddress.Value);\r\n\r\n            // Assignment ////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<Assignment, CreateOrEditAssignmentDto>();\r\n\r\n            CreateMap<Patient, ActivePatientDTO>()\r\n                .ForMember(dest => dest.HospitalizationType, opt => opt.MapFrom(src =>\r\n                    src.ActiveHistory != null && src.ActiveHistory.HospitalizationType != null\r\n                        ? src.ActiveHistory.HospitalizationType.DisplayName\r\n                        : \"‚Äî\"))\r\n                .ForMember(dest => dest.CourtDecision, opt => opt.MapFrom(src =>\r\n                    src.Capable != null && !string.IsNullOrEmpty(src.Capable.CourtDecision)\r\n                        ? src.Capable.CourtDecision\r\n                        : \"‚Äî\"))\r\n                .ForMember(dest => dest.NumberDocument, opt => opt.MapFrom(src =>\r\n                    src.ActiveHistory != null && !string.IsNullOrEmpty(src.ActiveHistory.NumberDocument)\r\n                        ? src.ActiveHistory.NumberDocument\r\n                        : \"‚Äî\"))\r\n                .ForMember(dest => dest.DateOfReceipt, opt => opt.MapFrom(src =>\r\n                    src.ActiveHistory != null ? DateTime.SpecifyKind(src.ActiveHistory.DateOfReceipt, DateTimeKind.Utc) : DateTime.MinValue))\r\n                .ForMember(dest => dest.Department, opt => opt.MapFrom(src =>\r\n                    src.ActiveHistory != null && src.ActiveHistory.NumberDepartment.HasValue\r\n                        ? src.ActiveHistory.NumberDepartment.Value.ToString()\r\n                        : \"‚Äî\"))\r\n                .ForMember(dest => dest.IsChildren, opt => opt.MapFrom(src => src.IsChildren))\r\n                .ForMember(dest => dest.Citizenship, opt => opt.MapFrom(src =>\r\n                    src.CitizenshipInfo != null && src.CitizenshipInfo.Citizenship != null\r\n                        ? src.CitizenshipInfo.Citizenship.DisplayName\r\n                        : \"‚Äî\"))\r\n                .ForMember(dest => dest.Country, opt => opt.MapFrom(src =>\r\n                    src.CitizenshipInfo != null && !string.IsNullOrEmpty(src.CitizenshipInfo.Country)\r\n                        ? src.CitizenshipInfo.Country\r\n                        : \"‚Äî\"))\r\n                .ForMember(dest => dest.Registration, opt => opt.MapFrom(src =>\r\n                    src.CitizenshipInfo != null && !string.IsNullOrEmpty(src.CitizenshipInfo.Registration)\r\n                        ? src.CitizenshipInfo.Registration\r\n                        : \"‚Äî\"))\r\n                .ForMember(dest => dest.IsHomeless, opt => opt.MapFrom(src =>\r\n                    src.CitizenshipInfo != null && src.CitizenshipInfo.NotRegistered\r\n                        ? true\r\n                        : false))\r\n                .ForMember(dest => dest.EarlyRegistration, opt => opt.MapFrom(src =>\r\n                    src.CitizenshipInfo != null && src.CitizenshipInfo.EarlyRegistration != null\r\n                        ? src.CitizenshipInfo.EarlyRegistration.DisplayName\r\n                        : \"‚Äî\"))\r\n                .ForMember(dest => dest.PlaceOfBirth, opt => opt.MapFrom(src =>\r\n                    src.CitizenshipInfo != null && !string.IsNullOrEmpty(src.CitizenshipInfo.PlaceOfBirth)\r\n                        ? src.CitizenshipInfo.PlaceOfBirth\r\n                        : \"‚Äî\"))\r\n                .ForMember(dest => dest.IsCapable, opt => opt.MapFrom(src => src.IsCapable))\r\n                .ForMember(dest => dest.ReceivesPension, opt => opt.MapFrom(src => src.ReceivesPension))\r\n                .ForMember(dest => dest.DisabilityGroup, opt => opt.MapFrom(src =>\r\n                    src.Pension != null && src.Pension.DisabilityGroup != null && src.Pension.DisabilityGroup.Value > 0\r\n                        ? src.Pension.DisabilityGroup.Value.ToString()\r\n                        : \"‚Äî\"))\r\n                .ForMember(dest => dest.Note, opt => opt.MapFrom(src =>\r\n                    !string.IsNullOrEmpty(src.Note)\r\n                        ? src.Note\r\n                        : \"‚Äî\"));\r\n\r\n            // UserActivityLog ///////////////////////////////////////////////////////////////////////////////////////////////////////////\r\n            CreateMap<UserActivityLog, UserActivityLogDTO>()\r\n                .ForMember(dest => dest.ActivityTypeName, opt => opt.MapFrom(src => \r\n                    GetActivityTypeName(src.ActivityType)))\r\n                .ForMember(dest => dest.FormattedTimestamp, opt => opt.MapFrom(src => \r\n                    src.Timestamp.ToString(\"dd.MM.yyyy HH:mm:ss\")));\r\n\r\n            CreateMap<UserActivityLogFilterViewModel, UserActivityLogFilterDTO>().ReverseMap();\r\n        }\r\n\r\n        /// <summary>\r\n        /// –ü–æ–ª—É—á–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–ø–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏\r\n        /// </summary>\r\n        /// <param name=\"activityType\">–¢–∏–ø –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</param>\r\n        /// <returns>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∏–ø–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</returns>\r\n        private static string GetActivityTypeName(UserActivityType activityType)\r\n        {\r\n            return activityType switch\r\n            {\r\n                UserActivityType.Login => \"–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è\",\r\n                UserActivityType.Logout => \"–í—ã—Ö–æ–¥\",\r\n                UserActivityType.DataRequest => \"–ó–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö\",\r\n                UserActivityType.Create => \"–°–æ–∑–¥–∞–Ω–∏–µ\",\r\n                UserActivityType.Update => \"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\",\r\n                UserActivityType.Delete => \"–£–¥–∞–ª–µ–Ω–∏–µ\",\r\n                _ => activityType.ToString()\r\n            };\r\n        }\r\n\r\n        /// <summary>\r\n        /// –ò–∑–≤–ª–µ–∫–∞–µ—Ç –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏–∑ object –≤ Dictionary\r\n        /// </summary>\r\n        /// <param name=\"document\">–î–æ–∫—É–º–µ–Ω—Ç –∫–∞–∫ object</param>\r\n        /// <returns>–ù–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞</returns>\r\n        private static string ExtractDocumentNumber(object document)\r\n        {\r\n            if (document == null) return string.Empty;\r\n            \r\n            if (document is PassportDocument passport)\r\n                return passport.Number != null ? passport.Number : string.Empty;\r\n            if (document is MedicalPolicyDocument policy)\r\n                return policy.Number != null ? policy.Number : string.Empty;\r\n            if (document is SnilsDocument snils)\r\n                return snils.Number != null ? snils.Number : string.Empty;\r\n            \r\n            return string.Empty;\r\n        }\r\n\r\n        /// <summary>\r\n        /// –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –Ω–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –µ–≥–æ —Ç–∏–ø–∞\r\n        /// </summary>\r\n        /// <param name=\"documentType\">–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞</param>\r\n        /// <param name=\"number\">–ù–æ–º–µ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</param>\r\n        /// <returns>–û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ</returns>\r\n        private static string FormatDocumentNumber(DocumentType documentType, string? number)\r\n        {\r\n            if (string.IsNullOrEmpty(number))\r\n                return string.Empty;\r\n\r\n            return documentType switch\r\n            {\r\n                var dt when dt == DocumentType.Passport => number,\r\n                var dt when dt == DocumentType.MedicalPolicy => number.Replace(\" \", \"\"),\r\n                var dt when dt == DocumentType.Snils => number,\r\n                _ => number\r\n            };\r\n        }\r\n    }\r\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/MappingProfile/ProjectMappingProfile.cs b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/MappingProfile/ProjectMappingProfile.cs
--- a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/MappingProfile/ProjectMappingProfile.cs	(revision 1f8fee95001fe8134ec947ef163da438a8a34e5a)
+++ b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/MappingProfile/ProjectMappingProfile.cs	(date 1756983352370)
@@ -179,6 +179,7 @@
             CreateMap<IUser, UserDTO>();
             CreateMap<ApplicationUser, UserDTO>();
             CreateMap<CreateAssignmentViewModel, CreateOrEditAssignmentDto>();
+            CreateMap<EditAssignmentViewModel, CreateOrEditAssignmentDto>();
             
             // –ú–∞–ø–ø–∏–Ω–≥ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
             CreateMap<ApplicationUser, EditUserViewModel>()
Index: src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/ViewModels/Assignment/EditAssignmentViewModel.cs
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>using System.ComponentModel.DataAnnotations;\r\n\r\nnamespace CRM.SocialDepartment.Site.ViewModels.Assignment\r\n{\r\n    public class EditAssignmentViewModel\r\n    {\r\n        [Required]\r\n        public Guid Id { get; set; }\r\n\r\n        [Required, StringLength(256)]\r\n        public string Name { get; set; } = string.Empty;\r\n\r\n        [StringLength(4000)]\r\n        public string? Description { get; set; }\r\n\r\n        [Display(Name = \"–°–æ–∑–¥–∞–Ω–æ\")]\r\n        public DateTime CreatedDate { get; set; }\r\n\r\n        [Display(Name = \"–ö–æ–º—É –ø–µ—Ä–µ–¥–∞–Ω–æ\")]\r\n        public string? ForwardDepartment { get; set; }\r\n\r\n        [Display(Name = \"–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å\")]\r\n        public string? Assignee { get; set; }\r\n\r\n        [Display(Name = \"–î–∞—Ç–∞ –ø—Ä–∏–Ω—è—Ç–∏—è\")]\r\n        public DateTime AcceptDate { get; set; }\r\n\r\n        [Display(Name = \"–î–∞—Ç–∞ –ø–µ—Ä–µ–¥–∞—á–∏\")]\r\n        public DateTime ForwardDate { get; set; }\r\n\r\n        [Display(Name = \"–ù–æ–º–µ—Ä –æ—Ç–¥–µ–ª–µ–Ω–∏—è\")]\r\n        public int DepartmentNumber { get; set; }\r\n\r\n        [Display(Name = \"–î–∞—Ç–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ\")]\r\n        public DateTime DepartmentForwardDate { get; set; }\r\n\r\n        [Display(Name = \"–ó–∞–º–µ—Ç–∫–∞\")]\r\n        public string? Note { get; set; }\r\n\r\n        [Required]\r\n        public Guid PatientId { get; set; }\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/ViewModels/Assignment/EditAssignmentViewModel.cs b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/ViewModels/Assignment/EditAssignmentViewModel.cs
--- a/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/ViewModels/Assignment/EditAssignmentViewModel.cs	(revision 1f8fee95001fe8134ec947ef163da438a8a34e5a)
+++ b/src/CRM.SocialDepartment.Presentation/CRM.SocialDepartment.Site/ViewModels/Assignment/EditAssignmentViewModel.cs	(date 1756983959363)
@@ -1,17 +1,22 @@
+using System.ComponentModel;
 using System.ComponentModel.DataAnnotations;
 
 namespace CRM.SocialDepartment.Site.ViewModels.Assignment
 {
-    public class EditAssignmentViewModel
+    public partial class EditAssignmentViewModel : IValidatableObject
     {
         [Required]
         public Guid Id { get; set; }
 
-        [Required, StringLength(256)]
+        [Required(ErrorMessage = "–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è")]
+        [DisplayName("–ù–∞–∑–≤–∞–Ω–∏–µ")]
+        [StringLength(256)]
         public string Name { get; set; } = string.Empty;
 
+        [Required(ErrorMessage = "–û–ø–∏—Å–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è")]
+        [DisplayName("–û–ø–∏—Å–∞–Ω–∏–µ")]
         [StringLength(4000)]
-        public string? Description { get; set; }
+        public string Description { get; set; } = string.Empty;
 
         [Display(Name = "–°–æ–∑–¥–∞–Ω–æ")]
         public DateTime CreatedDate { get; set; }
